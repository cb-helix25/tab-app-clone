"use strict";(self.webpackChunkteamhub=self.webpackChunkteamhub||[]).push([[728],{8728:(e,o,t)=>{t.r(o),t.d(o,{default:()=>b});var n=t(65043),r=t(48330),i=t(11638),s=t(40488),a=t(57433),l=t(20751),d=t(10615),c=t(60886),g=t(30800),u=t(29760),p=t(11622),h=t(70579);const f={root:{padding:"16px 28px",borderRadius:"10px",backgroundColor:g.M.grey,border:"none",height:"70px",minWidth:"220px",fontWeight:"600",fontSize:"18px",color:g.M.greyText,transition:"background 0.3s ease, color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",display:"flex",justifyContent:"center",alignItems:"center"},rootHovered:{backgroundColor:g.M.highlight,color:"#ffffff",boxShadow:"0 8px 20px rgba(0,0,0,0.2)",transform:"translateY(-3px)"},rootPressed:{backgroundColor:`${g.M.highlight}cc`,color:"#ffffff",boxShadow:"0 4px 10px rgba(0,0,0,0.25)",transform:"translateY(2px)"},icon:{marginRight:"12px",fontSize:"22px"},flexContainer:{display:"flex",alignItems:"center",justifyContent:"center"}},b=e=>{let{onCancel:o,feeEarner:t,futureBookings:b}=e;const{isDarkMode:x}=(0,u.DP)(),[m,k]=(0,n.useState)(!1),[y,S]=(0,n.useState)(!1),[D,_]=(0,n.useState)(null),[T,C]=(0,n.useState)(!1),[B,E]=(0,n.useState)(""),[w,j]=(0,n.useState)({}),[A,v]=(0,n.useState)([]),[P,M]=(0,n.useState)({}),[$,O]=(0,n.useState)(null),[I,R]=(0,n.useState)(2);function H(e){const{bookingDate:o,bookingTime:t,duration:n}=e,r=$;if(!o||!t||!r||!n)return{hasConflict:!1};let i=o;if(i.includes("/")){const e=i.split("/");3===e.length&&(i=`${e[2]}-${e[1]}-${e[0]}`)}let s=t;5===s.length&&(s=`${s}:00`);const a=s.split(":"),l=new Date(i);l.setHours(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]||"0"),0);const d=new Date(l.getTime()+36e5*Number(n));let c=[];b&&(c="Boardroom"===r?b.boardroomBookings:b.soundproofBookings);const g=c.filter(e=>e.booking_date===i);let u;for(const p of g){const e=p.booking_time.split(":").map(e=>e.split(".")[0]),o=new Date(p.booking_date);o.setHours(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]||"0"),0);const t=new Date(o.getTime()+36e5*p.duration);l<t&&d>o&&(!u||t>u)&&(u=t)}if(u){const e=function(e,o,t,n){const r=new Date(`${n}T23:59:59`);let i=new Date(o);for(;i<=r;){const o=new Date(i.getTime()+36e5*t);let n=!0;for(const t of e){const e=t.booking_time.split(":").map(e=>e.split(".")[0]),r=new Date(t.booking_date);r.setHours(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]||"0"),0);const s=new Date(r.getTime()+36e5*t.duration);if(i<s&&o>r){n=!1,i=new Date(s);break}}if(n&&o<=r)return i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return}(g,u,Number(n),i);return{hasConflict:!0,conflictEnd:u,nextAvailable:e}}return{hasConflict:!1}}(0,n.useEffect)(()=>{const{bookingDate:e}=w;if(!e||!$)return void v([]);let o=e;if(o.includes("/")){const e=o.split("/");3===e.length&&(o=`${e[2]}-${e[1]}-${e[0]}`)}let t=[];b&&(t="Boardroom"===$?b.boardroomBookings:b.soundproofBookings);const n=t.filter(e=>e.booking_date===o);v(n)},[w.bookingDate,$,b]),(0,n.useEffect)(()=>{const{hasConflict:e,conflictEnd:o,nextAvailable:t}=H(w);if(C(e),e&&o){let e=`Conflict until ${o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}.`;e+=t?` Your ${w.duration}-hour booking fits at ${t}.`:` No ${w.duration}-hour slot available today.`,E(e)}else E("")},[w.bookingTime,w.bookingDate,w.duration,$]),(0,n.useEffect)(()=>{if(!b)return void M({});const e=new Date;e.setHours(0,0,0,0);const o=new Date(e);o.setFullYear(e.getFullYear()+1);const t={};let n=new Date(e);for(;n<=o;){const e=n.getDay();if(0!==e&&6!==e){const e=n.toISOString().split("T")[0];t[e]=[]}n.setDate(n.getDate()+1)}($?"Boardroom"===$?b.boardroomBookings:b.soundproofBookings:[...b.boardroomBookings,...b.soundproofBookings]).forEach(e=>{const o=e.booking_date;t[o]&&t[o].push(e)}),M(t)},[b,$]);const L=e=>{const o=e.booking_time.split(":").map(e=>e.split(".")[0]),t=new Date(e.booking_date);t.setHours(parseInt(o[0]),parseInt(o[1]),parseInt(o[2]||"0"),0);const n=new Date(t.getTime()+36e5*e.duration);return`${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} - ${n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`},W=e=>{O(e),j({...w,spaceType:e})};return(0,h.jsx)(r.B,{tokens:{childrenGap:20},styles:{root:{padding:"20px",position:"relative"}},children:$?(0,h.jsxs)(h.Fragment,{children:[m&&(0,h.jsx)(r.B,{horizontalAlign:"center",styles:{root:{position:"absolute",width:"100%",zIndex:1}},children:(0,h.jsx)(s.y,{size:a.H.large,label:"Booking in progress..."})}),y&&(0,h.jsx)(r.B,{horizontalAlign:"center",styles:{root:{position:"absolute",width:"100%",zIndex:1,backgroundColor:"#fff",padding:"10px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}},children:(0,h.jsxs)(r.B,{horizontal:!0,tokens:{childrenGap:8},verticalAlign:"center",children:[(0,h.jsx)(l.I,{iconName:"CheckMark",styles:{root:{color:"green",fontSize:"24px"}}}),(0,h.jsx)(d.E,{variant:"xLarge",styles:{root:{color:"green",fontWeight:600}},children:"Booking confirmed!"})]})}),D&&(0,h.jsx)(r.B,{horizontalAlign:"center",styles:{root:{position:"absolute",width:"100%",zIndex:1}},children:(0,h.jsx)(d.E,{variant:"large",styles:{root:{color:"red"}},children:D})}),T&&(0,h.jsx)(r.B,{horizontalAlign:"center",styles:{root:{marginBottom:"10px"}},children:(0,h.jsx)(d.E,{variant:"large",styles:{root:{color:g.M.cta,fontWeight:600}},children:B})}),(0,h.jsx)(p.Ay,{fields:[{label:"Booking Date",name:"bookingDate",type:"date",required:!0,placeholder:"YYYY-MM-DD"},{label:"Start Time",name:"bookingTime",type:"time",required:!0,placeholder:"HH:MM"},{label:"Duration (hours)",name:"duration",type:"number",required:!0,placeholder:"Enter duration in hours"},{label:"Additional Notes",name:"reason",type:"textarea",required:!0,placeholder:"Any special requirements..."}],onSubmit:async function(e){if(T||!$)return;k(!0),_(null);let n=e.bookingTime;5===n.length&&(n+=":00");const r=n,i={fee_earner:t,booking_date:e.bookingDate,booking_time:r,duration:Number(e.duration),reason:e.reason,spaceType:$};try{await async function(e){const o=`${(0,c.T)()}/${{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_USE_LOCAL_DATA:"true"}.REACT_APP_INSERT_BOOK_SPACE_PATH}?code=${{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_USE_LOCAL_DATA:"true"}.REACT_APP_INSERT_BOOK_SPACE_CODE}`;let t=e.booking_time;if(t.includes(".")){const[e,o=""]=t.split(".");t=`${e}.${(o+"0000000").slice(0,7)}`}else t+=".0000000";const n={...e,booking_time:t},r=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok)throw new Error(`Booking failed with status ${r.status}`);return r.json()}(i),S(!0),setTimeout(()=>{o()},2e3)}catch(s){_(s.message||"Booking failed.")}finally{k(!1)}},onCancel:o,onChange:e=>{j(e)},matters:[],submitDisabled:T||m,conflict:T}),A.length>0&&(0,h.jsxs)(r.B,{styles:{root:{backgroundColor:g.M.grey,borderRadius:"8px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:`1px solid ${x?g.M.dark.border:g.M.light.border}`}},children:[(0,h.jsxs)(d.E,{variant:"mediumPlus",styles:{root:{fontWeight:600,color:x?"#ddd":g.M.darkBlue,marginBottom:"12px"}},children:[$," on ",new Date(w.bookingDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),(0,h.jsx)(r.B,{tokens:{childrenGap:8},children:A.map(e=>(0,h.jsxs)(r.B,{horizontal:!0,tokens:{childrenGap:12},styles:{root:{padding:"8px 12px",backgroundColor:x?g.M.dark.grey:"#fff",borderRadius:"6px",border:`1px solid ${x?g.M.dark.border:"#e8e8e8"}`,transition:"background 0.2s ease",":hover":{backgroundColor:x?"#444":"#f9f9f9"}}},children:[(0,h.jsx)(d.E,{variant:"medium",styles:{root:{fontWeight:500,width:"90px",color:g.M.blue}},children:L(e)}),(0,h.jsxs)(d.E,{variant:"medium",styles:{root:{color:x?"#bbb":g.M.greyText}},children:[e.reason," ",(0,h.jsxs)("span",{style:{fontWeight:300},children:["(by ",e.fee_earner,")"]})]})]},e.id))})]}),(0,h.jsxs)(r.B,{styles:{root:{backgroundColor:g.M.grey,borderRadius:"8px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:`1px solid ${x?g.M.dark.border:g.M.light.border}`}},children:[(0,h.jsx)(d.E,{variant:"mediumPlus",styles:{root:{fontWeight:600,color:x?"#ddd":g.M.darkBlue,marginBottom:"12px"}},children:$?`${$} Availability`:"Space Availability"}),(0,h.jsxs)(r.B,{tokens:{childrenGap:16},children:[(()=>{const e=new Date;e.setHours(0,0,0,0);const o=new Date(e);return o.setDate(e.getDate()+7*I),Object.entries(P).filter(t=>{let[n]=t;const r=new Date(n);return r>=e&&r<=o}).sort((e,o)=>{let[t]=e,[n]=o;return new Date(t).getTime()-new Date(n).getTime()})})().map(e=>{let[o,t]=e;return(0,h.jsxs)(r.B,{children:[(0,h.jsx)(d.E,{variant:"medium",styles:{root:{fontWeight:500,color:x?"#ccc":g.M.websiteBlue,marginBottom:"6px"}},children:new Date(o).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),t.length>0?(0,h.jsx)(r.B,{tokens:{childrenGap:6},children:t.map(e=>(0,h.jsxs)(r.B,{horizontal:!0,tokens:{childrenGap:12},styles:{root:{padding:"6px 10px",backgroundColor:x?g.M.dark.grey:"#fff",borderRadius:"6px",border:`1px solid ${x?g.M.dark.border:"#e8e8e8"}`,transition:"background 0.2s ease",":hover":{backgroundColor:x?"#444":"#f9f9f9"}}},children:[(0,h.jsx)(d.E,{variant:"smallPlus",styles:{root:{fontWeight:500,width:"90px",color:g.M.blue}},children:L(e)}),(0,h.jsxs)(d.E,{variant:"smallPlus",styles:{root:{color:x?"#bbb":g.M.greyText}},children:[e.reason," ",(0,h.jsxs)("span",{style:{fontWeight:300},children:["(by ",e.fee_earner,")"]})]})]},e.id))}):(0,h.jsx)(d.E,{variant:"smallPlus",styles:{root:{color:x?"#888":"#999",marginLeft:"10px",fontStyle:"italic"}},children:"No bookings scheduled"})]},o)}),(0,h.jsx)(i.Y,{text:"Load More",onClick:()=>{R(e=>e+2)},styles:{root:{marginTop:"16px",alignSelf:"center"}}})]})]})]}):(0,h.jsxs)(r.B,{horizontal:!0,tokens:{childrenGap:24},horizontalAlign:"center",children:[(0,h.jsx)(i.Y,{onClick:()=>W("Boardroom"),styles:f,iconProps:{iconName:"OfficeChat"},text:"Boardroom"}),(0,h.jsx)(i.Y,{onClick:()=>W("Soundproof Pod"),styles:f,iconProps:{iconName:"Phone"},text:"Soundproof Pod"})]})})}}}]);
//# sourceMappingURL=728.7366e53a.chunk.js.map