"use strict";(self.webpackChunkteamhub=self.webpackChunkteamhub||[]).push([[279],{51010:(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});var a=r(16260),o=r(43666);function n(e,t){var r;(0,o.A)(1,arguments);var n=e||{},i=(0,a.A)(n.start),d=(0,a.A)(n.end).getTime();if(!(i.getTime()<=d))throw new RangeError("Invalid interval");var s=[],l=i;l.setHours(0,0,0,0);var c=Number(null!==(r=null===t||void 0===t?void 0:t.step)&&void 0!==r?r:1);if(c<1||isNaN(c))throw new RangeError("`options.step` must be a number greater than 1");for(;l.getTime()<=d;)s.push((0,a.A)(l)),l.setDate(l.getDate()+c),l.setHours(0,0,0,0);return s}},73279:(e,t,r)=>{r.r(t),r.d(t,{default:()=>$});var a=r(65043),o=r(97950),n=r(93989),i=r(72721),d=r(11638),s=r(94028),l=r(48330),c=r(1870),p=r(51010),x=r(81786),g=r(39993),u=r(30800),f=r(29760),m=r(84259),h=r(60184),b=r(70579);function v(e,t){const r=new Date(t,3,1),a=new Date(t+1,2,31,23,59);return e>=r&&e<=a}const y=(0,c.Zq)({position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.6)",zIndex:2147483e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",overflow:"auto"}),M=e=>(0,c.Zq)({background:e?`linear-gradient(135deg, ${u.M.dark.sectionBackground} 0%, ${u.M.dark.cardBackground} 100%)`:"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",borderRadius:"16px",boxShadow:e?"0 12px 40px rgba(0, 0, 0, 0.8)":"0 12px 40px rgba(0, 0, 0, 0.5)",width:"min(1200px, 96%)",maxHeight:"90vh",overflow:"auto",padding:"32px",position:"relative",border:e?`1px solid ${u.M.dark.border}`:"none","@media (max-width: 768px)":{padding:"20px",borderRadius:"12px",width:"98%",maxHeight:"95vh"}}),k=e=>(0,c.Zq)({position:"absolute",top:"16px",right:"16px",backgroundColor:"transparent",border:"none",fontSize:"24px",cursor:"pointer",color:e?u.M.dark.text:u.M.greyText,padding:"8px",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",":hover":{backgroundColor:e?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",color:e?u.M.dark.text:u.M.light.text}}),j=e=>(0,c.Zq)({background:e?`linear-gradient(135deg, ${u.M.dark.cardBackground} 0%, ${u.M.dark.sectionBackground} 100%)`:"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",border:`1px solid ${e?u.M.dark.border:u.M.light.border}`,borderRadius:"16px",padding:"32px",marginBottom:"24px",boxShadow:e?"0 8px 32px rgba(0, 0, 0, 0.4)":"0 8px 32px rgba(0, 0, 0, 0.12)",maxWidth:"100%",overflow:"hidden","@media (max-width: 768px)":{padding:"20px",borderRadius:"12px"}}),w=(0,c.Zq)({borderBottom:`2px solid ${u.M.light.border}`,paddingBottom:"20px",marginBottom:"24px"}),C=(0,c.Zq)({display:"flex",alignItems:"center",gap:"16px"}),N=(0,c.Zq)({fontSize:"16px",fontWeight:700,color:u.M.light.text,marginBottom:"12px",letterSpacing:"0.5px",textTransform:"uppercase",borderLeft:`4px solid ${u.M.cta}`,paddingLeft:"12px"}),T=e=>(0,c.Zq)({backgroundColor:e?u.M.dark.inputBackground:u.M.light.inputBackground,border:`1px solid ${e?u.M.dark.border:u.M.light.border}`,borderRadius:"8px",padding:"16px",fontSize:"14px",fontStyle:"italic",color:e?u.M.dark.text:u.M.light.text,marginBottom:"20px",lineHeight:"1.5"}),S=(0,c.Zq)({display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",marginBottom:"20px","@media (max-width: 768px)":{gridTemplateColumns:"1fr"}}),q=e=>(0,c.Zq)({backgroundColor:e?u.M.dark.cardBackground:u.M.light.sectionBackground,border:`1px solid ${e?u.M.dark.border:u.M.light.border}`,borderRadius:"8px",padding:"16px",textAlign:"center",boxShadow:e?"0 2px 4px rgba(0, 0, 0, 0.3)":"0 2px 4px rgba(0, 0, 0, 0.05)",transition:"transform 0.2s ease",":hover":{transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"}}),B=(0,c.Zq)({display:"flex",gap:"16px",marginBottom:"16px",justifyContent:"center",alignItems:"center","@media (max-width: 768px)":{flexDirection:"column",gap:"12px"}}),F=(e,t)=>(0,c.Zq)({padding:"6px 12px",borderRadius:"20px",fontSize:"12px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",backgroundColor:"approved"===e?t?"rgba(34, 197, 94, 0.2)":"#e8f5e8":"rejected"===e?t?"rgba(239, 68, 68, 0.2)":"#fdf2f2":t?"rgba(251, 191, 36, 0.2)":"#fff3cd",color:"approved"===e?t?"#86efac":"#2d5a2d":"rejected"===e?t?"#fca5a5":"#721c24":t?"#fcd34d":"#856404",border:"1px solid "+("approved"===e?t?"rgba(34, 197, 94, 0.4)":"#a3d977":"rejected"===e?t?"rgba(239, 68, 68, 0.4)":"#f5c6cb":t?"rgba(251, 191, 36, 0.4)":"#ffeaa7")}),A=(0,c.Zq)({display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"20px","@media (max-width: 768px)":{gridTemplateColumns:"1fr",gap:"12px"}}),R=e=>(0,c.Zq)({backgroundColor:e?u.M.dark.cardBackground:u.M.light.sectionBackground,border:`1px solid ${e?u.M.dark.border:u.M.light.border}`,borderRadius:"8px",padding:"16px",textAlign:"center",transition:"all 0.2s ease",":hover":{backgroundColor:e?u.M.dark.cardHover:u.M.light.cardHover}}),D=e=>(0,c.Zq)({fontSize:"12px",fontWeight:600,color:e?u.M.dark.subText:u.M.greyText,textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"6px"}),E=e=>(0,c.Zq)({fontSize:"16px",fontWeight:700,color:e?u.M.dark.text:u.M.light.text}),_=e=>(0,c.Zq)({backgroundColor:u.M.green,borderColor:u.M.green,color:"#fff",fontWeight:600,padding:"12px 24px",borderRadius:"8px",transition:"all 0.2s ease",":hover":{backgroundColor:"#16a34a",borderColor:"#16a34a",transform:"translateY(-1px)",boxShadow:e?"0 4px 12px rgba(34, 197, 94, 0.3)":"0 4px 12px rgba(34, 197, 94, 0.2)"}}),z=e=>(0,c.Zq)({backgroundColor:u.M.red,borderColor:u.M.red,color:"#fff",fontWeight:600,padding:"12px 24px",borderRadius:"8px",transition:"all 0.2s ease",":hover":{backgroundColor:"#dc2626",borderColor:"#dc2626",transform:"translateY(-1px)",boxShadow:e?"0 4px 12px rgba(239, 68, 68, 0.3)":"0 4px 12px rgba(239, 68, 68, 0.2)"}}),L=e=>(0,c.Zq)({marginTop:"12px","& .ms-TextField-fieldGroup":{borderRadius:"8px",border:`2px solid ${e?u.M.dark.border:u.M.light.border}`,backgroundColor:e?u.M.dark.inputBackground:u.M.light.inputBackground,":focus-within":{borderColor:u.M.highlight}},"& .ms-TextField-field":{color:e?u.M.dark.text:u.M.light.text}}),$=e=>{let{approvals:t,futureLeave:r,onClose:c,team:$,totals:Z,allLeaveEntries:W,onApprovalUpdate:H}=e;const{isDarkMode:P}=(0,f.DP)(),[I,Y]=(0,a.useState)(t);(0,a.useEffect)(()=>{Y(t)},[t]);const[U,G]=(0,a.useState)(null);(0,a.useEffect)(()=>{if("undefined"===typeof document)return;const e=document.createElement("div");return e.setAttribute("data-annual-leave-modal",""),document.body.appendChild(e),G(e),()=>{e.parentNode&&e.parentNode.removeChild(e)}},[]),(0,a.useEffect)(()=>{if("undefined"===typeof document)return;const e=document.body.style.overflow;document.body.style.overflow="hidden";const t=e=>{"Escape"===e.key&&c()};return window.addEventListener("keydown",t),()=>{document.body.style.overflow=e,window.removeEventListener("keydown",t)}},[c]);const[O,J]=(0,a.useState)({}),[K,Q]=(0,a.useState)({});function V(e){const t=$.find(t=>t.Initials.toLowerCase()===e.toLowerCase());return(null===t||void 0===t?void 0:t.Nickname)||e}function X(e,t){const r=new Date(e),a=new Date(t);return r.getTime()===a.getTime()?(0,g.default)(r,"EEEE, d MMMM yyyy"):`${(0,g.default)(r,"EEEE, d MMMM yyyy")} - ${(0,g.default)(a,"EEEE, d MMMM yyyy")}`}const ee=e=>{var t;let{entry:o}=e;const[l,g]=(0,a.useState)(""),[f,h]=(0,a.useState)(O[o.id]||""),y=function(e,t){const r=new Date(e),a=new Date(t);return(0,p.default)({start:r,end:a}).filter(e=>!(0,x.default)(e)).length}(o.start_date,o.end_date),M=function(e){var t;const r=e.trim().toLowerCase(),a=$.find(e=>e.Initials&&e.Initials.trim().toLowerCase()===r);return null!==(t=null===a||void 0===a?void 0:a.holiday_entitlement)&&void 0!==t?t:20}(o.person),k=function(e){const t=e.getFullYear();return e>=new Date(t,3,1)?t:t-1}(new Date),Z=function(e,t,r){let a=0;return e.filter(e=>e.person===t).filter(e=>e.status&&("booked"===e.status.toLowerCase()||"requested"===e.status.toLowerCase()||"approved"===e.status.toLowerCase())).forEach(e=>{const t=new Date(e.start_date),o=new Date(e.end_date);if(v(t,r)||v(o,r)){const e=(0,p.default)({start:t,end:o}).filter(e=>!(0,x.default)(e)).length;a+=e}}),a}(W,o.person,k),U=M-Z,G=(Math.max(0,U-5),function(e){const t=new Date(e.start_date),a=new Date(e.end_date);return[...I.filter(r=>r.id!==e.id&&r.person!==e.person&&new Date(r.end_date)>=t&&new Date(r.start_date)<=a),...r.filter(r=>r.person!==e.person&&new Date(r.end_date)>=t&&new Date(r.start_date)<=a)]}(o)),J=K[o.id]||!1,ee=async e=>{if(!J){Q(e=>({...e,[o.id]:!0}));try{const t="approve"===e?"approved":"rejected",r="reject"===e?f:null;await(async(e,t,r)=>{const a={id:e,newStatus:t,rejection_notes:r||""},o=await fetch("/api/attendance/updateAnnualLeave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!o.ok)throw new Error(`Update failed with status ${o.status}: ${o.statusText}`)})(o.id,t,r),H&&H(o.id,t),Y(e=>e.map(e=>e.id===o.id?{...e,status:t}:e)),g("approve"===e?`\u2713 Approved leave for ${V(o.person)}`:`\u2717 Rejected leave for ${V(o.person)}`),setTimeout(()=>g(""),3e3),setTimeout(()=>{c()},800)}catch(t){console.error(`Failed to ${e} leave:`,t),g(`\u274c Failed to ${e} leave request`),setTimeout(()=>g(""),5e3)}finally{Q(e=>({...e,[o.id]:!1}))}}};return(0,b.jsxs)("div",{className:j(P),children:[(0,b.jsx)("div",{className:w,children:(0,b.jsxs)("div",{className:C,children:[(0,b.jsx)(n.F,{imageUrl:m,text:V(o.person),size:i.WH.size48,styles:{primaryText:{fontWeight:700,fontSize:"18px",color:u.M.light.text}}}),(0,b.jsxs)("div",{style:{marginLeft:"auto"},children:["approved"===o.status.toLowerCase()&&(0,b.jsx)("div",{className:F("approved",P),children:"Approved"}),"rejected"===o.status.toLowerCase()&&(0,b.jsx)("div",{className:F("rejected",P),children:"Rejected"}),"requested"===o.status.toLowerCase()&&(0,b.jsx)("div",{className:F("requested",P),children:"Pending Review"})]})]})}),(0,b.jsxs)("div",{className:A,children:[(0,b.jsxs)("div",{className:R(P),children:[(0,b.jsx)("div",{className:D(P),children:"Request Period"}),(0,b.jsx)("div",{className:E(P),children:X(o.start_date,o.end_date)})]}),(0,b.jsxs)("div",{className:R(P),children:[(0,b.jsx)("div",{className:D(P),children:"Business Days"}),(0,b.jsxs)("div",{className:E(P),children:[y," days"]})]}),(0,b.jsxs)("div",{className:R(P),children:[(0,b.jsx)("div",{className:D(P),children:"FY Days Taken"}),(0,b.jsxs)("div",{className:E(P),children:[Z," / ",M]})]}),(0,b.jsxs)("div",{className:R(P),children:[(0,b.jsx)("div",{className:D(P),children:"Remaining After"}),(0,b.jsxs)("div",{className:E(P),style:{color:U<0?u.M.red:P?u.M.dark.text:u.M.light.text},children:[U," days"]})]})]}),(null===(t=o.reason)||void 0===t?void 0:t.trim())&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:N,children:"Request Notes"}),(0,b.jsxs)("div",{className:T(P),children:['"',o.reason,'"']})]}),void 0!==o.hearing_confirmation&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:N,children:"Hearing Confirmation"}),(0,b.jsxs)("div",{className:T(P),children:[(0,b.jsx)("strong",{children:(()=>{const e=o.hearing_confirmation;if("boolean"===typeof e)return e?"\u2713 No hearings during absence":"\u26a0 Hearings may be affected";if("string"===typeof e){const t=e.trim(),r=t.toLowerCase();return"yes"===r?"\u2713 No hearings during absence":"no"===r?"\u26a0 Hearings may be affected":t}return""})()}),(()=>{const e=o.hearing_confirmation,t=!!o.hearing_details,r="string"===typeof e?e.trim().toLowerCase():"";return t&&(!1===e||null===e||"no"===r||"string"===typeof e&&"yes"!==r&&"no"!==r)?(0,b.jsxs)("div",{style:{marginTop:"8px",fontStyle:"normal"},children:[(0,b.jsx)("strong",{children:"Details:"})," ",o.hearing_details]}):null})()]})]}),(0,b.jsx)("div",{className:N,children:"Team Coverage Analysis"}),G.length>0?(0,b.jsx)("div",{className:S,children:G.map((e,t)=>(0,b.jsxs)("div",{className:q(P),children:[(0,b.jsx)(n.F,{imageUrl:m,text:V(e.person),size:i.WH.size32,styles:{primaryText:{fontWeight:600,fontSize:"14px",color:P?u.M.dark.text:u.M.light.text}}}),(0,b.jsx)("div",{style:{marginTop:"8px",fontSize:"12px",color:P?u.M.dark.subText:u.M.greyText},children:X(e.start_date,e.end_date)}),(0,b.jsx)("div",{style:{marginTop:"4px",fontSize:"11px",fontWeight:600,textTransform:"uppercase",color:"booked"===e.status?u.M.green:u.M.orange},children:e.status})]},t))}):(0,b.jsx)("div",{className:T(P),style:{color:u.M.green,fontStyle:"normal"},children:"\u2713 No team conflicts identified"}),"requested"===o.status.toLowerCase()&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:B,children:[(0,b.jsx)(d.Y,{text:J?"Processing...":"Approve Request",onClick:()=>ee("approve"),disabled:J,className:_(P),iconProps:{iconName:"CheckMark",styles:{root:{color:"#fff",fontSize:"14px"}}}}),(0,b.jsx)(d.Y,{text:J?"Processing...":"Reject Request",onClick:()=>ee("reject"),disabled:J,className:z(P),iconProps:{iconName:"Cancel",styles:{root:{color:"#fff",fontSize:"14px"}}}})]}),(0,b.jsx)("div",{className:L(P),children:(0,b.jsx)(s.A,{label:"Rejection Reason (required for rejections)",placeholder:"Provide clear reasoning for rejection...",value:f,onChange:(e,t)=>h(t||""),multiline:!0,rows:3,styles:{fieldGroup:{borderRadius:"8px",border:`2px solid ${P?u.M.dark.border:u.M.light.border}`,backgroundColor:P?u.M.dark.inputBackground:u.M.light.inputBackground},field:{color:P?u.M.dark.text:u.M.light.text}}})})]}),l&&(0,b.jsx)("div",{style:{marginTop:"16px",padding:"12px",borderRadius:"8px",backgroundColor:l.includes("\u2713")?"#f0f9ff":l.includes("\u274c")?"#fef2f2":"#fffbeb",border:"1px solid "+(l.includes("\u2713")?"#0ea5e9":l.includes("\u274c")?"#ef4444":"#f59e0b"),color:l.includes("\u2713")?"#0c4a6e":l.includes("\u274c")?"#7f1d1d":"#92400e",fontWeight:600,textAlign:"center"},children:l})]})},te=(0,b.jsx)("div",{className:y,onClick:e=>{e.target===e.currentTarget&&c()},children:(0,b.jsxs)("div",{className:M(P),onClick:e=>e.stopPropagation(),children:[(0,b.jsx)("button",{className:k(P),onClick:c,"aria-label":"Close",children:"\u2715"}),0===I.length?(0,b.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",fontSize:"18px",color:P?u.M.dark.text:u.M.greyText},children:[(0,b.jsx)(h.PAB,{style:{fontSize:"48px",marginBottom:"16px",color:u.M.green}}),(0,b.jsx)("div",{children:"No leave requests to review"}),(0,b.jsx)("div",{style:{fontSize:"14px",marginTop:"8px"},children:"All annual leave requests have been processed."})]}):(0,b.jsxs)(l.B,{tokens:{childrenGap:24},children:[(0,b.jsx)("div",{style:{fontSize:"24px",fontWeight:700,color:P?u.M.dark.text:u.M.light.text,textAlign:"center",marginBottom:"8px"},children:"Annual Leave Approvals"}),(0,b.jsxs)("div",{style:{fontSize:"14px",color:P?u.M.dark.subText:u.M.greyText,textAlign:"center",marginBottom:"16px"},children:[t.length," request",1!==t.length?"s":""," require",1===t.length?"s":""," your review"]}),I.map(e=>(0,b.jsx)(ee,{entry:e},e.request_id?String(e.request_id):e.id))]})]})});return U?(0,o.createPortal)(te,U):te}},81786:(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});var a=r(16260),o=r(43666);function n(e){(0,o.A)(1,arguments);var t=(0,a.A)(e).getDay();return 0===t||6===t}},84259:(e,t,r)=>{e.exports=r.p+"static/media/helix avatar.8814699fd8c505fb4389.png"}}]);
//# sourceMappingURL=279.353f06a6.chunk.js.map