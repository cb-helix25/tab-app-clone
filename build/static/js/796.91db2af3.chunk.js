"use strict";(self.webpackChunkteamhub=self.webpackChunkteamhub||[]).push([[796],{14099:(e,t,a)=>{a.d(t,{UT:()=>i,cY:()=>r});const n=()=>"true"==={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_USE_LOCAL_DATA:"true"}.REACT_APP_DEBUG_LOGS,r=function(){n()&&console.log(...arguments)},i=function(){n()&&console.warn(...arguments)}},19796:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Wa});var n=a(65043),r=a(11638),i=a(63485),s=a(40488),o=a(57433),l=a(72955),d=a(30800),c=a(29760),g=a(85612),u=a(93197),p=a(50289),h=a(20751),x=a(14099),f=a(70579);const m=[{key:"today",label:"Today"},{key:"yesterday",label:"Yesterday"},{key:"week",label:"This Week"},{key:"lastWeek",label:"Last Week"},{key:"month",label:"This Month"},{key:"lastMonth",label:"Last Month"},{key:"last90Days",label:"Last 90 Days"},{key:"quarter",label:"This Quarter"},{key:"yearToDate",label:"Year To Date"},{key:"year",label:"Current Year"}],y=e=>{const t=e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.18)";return{root:{maxWidth:220,".ms-DatePicker":{fontFamily:"Raleway, sans-serif !important"}},textField:{root:{fontFamily:"Raleway, sans-serif !important",width:"100% !important"},fieldGroup:{height:"36px !important",borderRadius:"8px !important",border:`1px solid ${t} !important`,background:`${e?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.95)"} !important`,padding:"0 14px !important",boxShadow:e?"0 2px 4px rgba(0, 0, 0, 0.2) !important":"0 1px 3px rgba(15, 23, 42, 0.08) !important",transition:"all 0.2s ease !important",selectors:{":hover":{border:`1px solid ${e?"rgba(135, 206, 255, 0.5)":"rgba(54, 144, 206, 0.4)"} !important`,background:`${e?"rgba(15, 23, 42, 0.95)":"rgba(248, 250, 252, 1)"} !important`,boxShadow:e?"0 4px 8px rgba(0, 0, 0, 0.25) !important":"0 2px 6px rgba(15, 23, 42, 0.12) !important",transform:"translateY(-1px) !important"},":focus-within":{border:`1px solid ${e?"#87ceeb":d.M.highlight} !important`,background:`${e?"rgba(15, 23, 42, 1)":"rgba(255, 255, 255, 1)"} !important`,boxShadow:e?"0 0 0 3px rgba(135, 206, 235, 0.1), 0 4px 12px rgba(0, 0, 0, 0.25) !important":"0 0 0 3px rgba(54, 144, 206, 0.1), 0 2px 8px rgba(15, 23, 42, 0.15) !important",transform:"translateY(-1px) !important"}}},field:{fontSize:"14px !important",color:`${e?d.M.dark.text:d.M.light.text} !important`,fontFamily:"Raleway, sans-serif !important",fontWeight:"500 !important",background:"transparent !important",lineHeight:"20px !important",border:"none !important",outline:"none !important"}},icon:{color:`${e?d.M.highlight:d.M.missedBlue} !important`,fontSize:"16px !important",fontWeight:"bold !important"},callout:{fontSize:"14px !important",borderRadius:"12px !important",border:`1px solid ${t} !important`,boxShadow:e?"0 8px 24px rgba(0, 0, 0, 0.4) !important":"0 6px 20px rgba(15, 23, 42, 0.15) !important"},wrapper:{borderRadius:"12px !important"}}},b=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=d.M.highlight,r=a?e?"rgba(15, 23, 42, 0.8)":"transparent":t?n:e?"rgba(148, 163, 184, 0.16)":"transparent";return{root:{display:"inline-flex",alignItems:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderRadius:999,border:t?"1px solid "+(e?"rgba(135, 176, 255, 0.5)":"rgba(13, 47, 96, 0.32)"):"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),padding:"0 12px",minHeight:32,height:32,fontWeight:600,fontSize:13,color:a?e?"#E2E8F0":d.M.missedBlue:t?"#ffffff":e?"#E2E8F0":d.M.missedBlue,background:r,boxShadow:t&&!a?"0 2px 8px rgba(54, 144, 206, 0.25)":"none",fontFamily:"Raleway, sans-serif",cursor:a?"default":"pointer"},rootHovered:{background:a?r:t?"#2f7cb3":e?"rgba(148, 163, 184, 0.24)":"rgba(54, 144, 206, 0.12)"},rootPressed:{background:a?r:t?"#266795":e?"rgba(148, 163, 184, 0.3)":"rgba(54, 144, 206, 0.16)"}}},v=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=t?`linear-gradient(135deg, ${d.M.highlight} 0%, #2f7cb3 100%)`:e?"rgba(15, 23, 42, 0.8)":"transparent",r=!a,i=r?.4:1;return{root:{borderRadius:999,minHeight:32,height:32,padding:"0 8px",fontWeight:t?700:600,fontSize:12,border:t?`2px solid ${e?"#87ceeb":d.M.highlight}`:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:n,color:t?"#ffffff":r?e?"#64748B":"#94A3B8":e?"#E2E8F0":d.M.missedBlue,opacity:i,boxShadow:t?e?"0 2px 8px rgba(54, 144, 206, 0.3)":"0 2px 8px rgba(54, 144, 206, 0.25)":"none",fontFamily:"Raleway, sans-serif",transform:t?"translateY(-1px)":"none",transition:"all 0.2s ease"},rootHovered:{background:t?"linear-gradient(135deg, #2f7cb3 0%, #266795 100%)":e?"rgba(15, 23, 42, 0.86)":"rgba(54, 144, 206, 0.1)",transform:"translateY(-1px)",boxShadow:t?e?"0 4px 12px rgba(54, 144, 206, 0.4)":"0 4px 12px rgba(54, 144, 206, 0.35)":e?"0 2px 4px rgba(0, 0, 0, 0.1)":"0 2px 4px rgba(15, 23, 42, 0.05)"},rootPressed:{background:t?"linear-gradient(135deg, #266795 0%, #1e5a7a 100%)":e?"rgba(15, 23, 42, 0.9)":"rgba(54, 144, 206, 0.14)",transform:"translateY(0)"}}},j=(e,t)=>{const a=t?`linear-gradient(135deg, ${d.M.highlight} 0%, #2f7cb3 100%)`:e?"rgba(15, 23, 42, 0.8)":"transparent";return{root:{borderRadius:999,minHeight:32,height:32,padding:"0 12px",fontWeight:t?700:600,fontSize:12,border:t?`2px solid ${e?"#87ceeb":d.M.highlight}`:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:a,color:t?"#ffffff":e?"#E2E8F0":d.M.missedBlue,boxShadow:t?e?"0 2px 8px rgba(54, 144, 206, 0.3)":"0 2px 8px rgba(54, 144, 206, 0.25)":"none",fontFamily:"Raleway, sans-serif",transform:t?"translateY(-1px)":"none",transition:"all 0.2s ease"},rootHovered:{background:t?"linear-gradient(135deg, #2f7cb3 0%, #266795 100%)":e?"rgba(15, 23, 42, 0.86)":"rgba(54, 144, 206, 0.1)",transform:"translateY(-1px)",boxShadow:t?e?"0 4px 12px rgba(54, 144, 206, 0.4)":"0 4px 12px rgba(54, 144, 206, 0.35)":e?"0 2px 4px rgba(0, 0, 0, 0.1)":"0 2px 4px rgba(15, 23, 42, 0.05)"},rootPressed:{background:t?"linear-gradient(135deg, #266795 0%, #1e5a7a 100%)":e?"rgba(15, 23, 42, 0.9)":"rgba(54, 144, 206, 0.14)",transform:"translateY(0)"}}},k=e=>({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"12px 16px",borderRadius:10,background:e?"rgba(15, 23, 42, 0.72)":"#ffffff",border:"1px solid "+(e?"rgba(148, 163, 184, 0.25)":"#e2e8f0"),boxShadow:e?"0 4px 6px rgba(0, 0, 0, 0.3)":"0 4px 6px rgba(0, 0, 0, 0.07)",textAlign:"center",rowGap:6,width:"100%"}),w=e=>({display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"center",padding:"6px 12px",borderRadius:10,border:"1px solid "+(e?"rgba(148, 163, 184, 0.28)":"rgba(13, 47, 96, 0.14)"),background:e?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",color:e?"#e2e8f0":"#0d2f60",minWidth:132,gap:2,cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Raleway, sans-serif",whiteSpace:"nowrap",lineHeight:1.3}),M=e=>({display:"flex",alignItems:"center",justifyContent:"center",padding:"0 12px",height:32,borderRadius:8,border:"1px solid "+(e?"rgba(239, 68, 68, 0.35)":"rgba(239, 68, 68, 0.25)"),background:e?"rgba(239, 68, 68, 0.12)":"rgba(254, 242, 242, 0.85)",color:e?"#fca5a5":"#dc2626",gap:6,cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Raleway, sans-serif",fontWeight:600,fontSize:13,whiteSpace:"nowrap"}),S=e=>{const t=new Date,a=new Date(t),n=new Date(t);switch(e){case"today":n.setHours(0,0,0,0);break;case"yesterday":{const e=new Date(t);e.setDate(e.getDate()-1),n.setTime(e.getTime()),n.setHours(0,0,0,0),a.setTime(e.getTime()),a.setHours(23,59,59,999);break}case"week":{const e=(t.getDay()+6)%7;n.setDate(t.getDate()-e),n.setHours(0,0,0,0);break}case"lastWeek":{const e=(t.getDay()+6)%7,r=new Date(t);r.setDate(t.getDate()-e),r.setHours(0,0,0,0),n.setTime(r.getTime()),n.setDate(n.getDate()-7),n.setHours(0,0,0,0),a.setTime(n.getTime()),a.setDate(a.getDate()+6),a.setHours(23,59,59,999);break}case"month":n.setDate(1),n.setHours(0,0,0,0);break;case"lastMonth":n.setMonth(t.getMonth()-1,1),n.setHours(0,0,0,0),a.setDate(0),a.setHours(23,59,59,999);break;case"last90Days":n.setDate(t.getDate()-89),n.setHours(0,0,0,0);break;case"quarter":{const e=3*Math.floor(t.getMonth()/3);n.setMonth(e,1),n.setHours(0,0,0,0);break}case"yearToDate":{const e=t.getFullYear();t.getMonth()>=3?n.setFullYear(e,3,1):n.setFullYear(e-1,3,1),n.setHours(0,0,0,0);break}case"year":{const e=t.getFullYear();n.setFullYear(e,0,1),n.setHours(0,0,0,0),a.setFullYear(e,11,31),a.setHours(23,59,59,999);break}case"custom":return{start:new Date(t),end:new Date(t)};default:return{start:new Date(0),end:a}}return{start:n,end:a}},C=(e,t)=>{const a={day:"2-digit",month:"short",year:e.getFullYear()!==t.getFullYear()?"numeric":void 0},n=e.toLocaleDateString("en-GB",a),r=t.toLocaleDateString("en-GB",a);return n===r?n:`${n} - ${r}`},D=e=>{switch(e){case"today":return"Today";case"yesterday":return"Yesterday";case"week":return"This Week";case"lastWeek":return"Last Week";case"month":return"This Month";case"lastMonth":return"Last Month";case"last90Days":return"Last 90 Days";case"quarter":return"This Quarter";case"yearToDate":return"Year To Date";case"year":return"Current Year";case"all":return"All Time";default:return"Custom"}},T=e=>{switch(e){case"today":return"Previous Working Day";case"yesterday":return"Day Before Yesterday";case"week":return"Previous Week";case"lastWeek":return"Week Before Last";case"lastMonth":return"Two Months Ago";case"last90Days":return"Prior 90 Days";case"month":return"Previous Month";case"quarter":return"Previous Quarter";case"yearToDate":return"Previous Financial Year";case"year":return"Previous Year";default:return"Previous Period"}},_=e=>{if("string"!==typeof e||0===e.trim().length)return null;const t=e.trim(),a=t.includes("/")&&!t.includes("T")?(()=>{const e=t.split("/");if(3!==e.length)return t;const[a,n,r]=e;return`${2===r.length?`20${r}`:r}-${n.padStart(2,"0")}-${a.padStart(2,"0")}`})():t,n=new Date(a);return Number.isNaN(n.getTime())?null:n},R=e=>{if("number"===typeof e&&Number.isFinite(e))return e;if("string"===typeof e){const t=Number(e);return Number.isFinite(t)?t:0}return 0},W=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",F=e=>e?_(e):null,z=(e,t)=>!(!t||"string"!==typeof e)&&e.toLowerCase().includes(t.toLowerCase()),I=e=>"string"===typeof e?e.replace(/[^a-zA-Z]/g,"").toLowerCase():"",$={"Samuel Packwood":"Sam Packwood","Bianca ODonnell":"Bianca O'Donnell"},L=e=>{var t;return e?null!==(t=$[e])&&void 0!==t?t:e:""},A=e=>e&&(e.Nickname||e["Full Name"]||e.First||e.Last||e.Initials)||"Unknown",B=e=>{if(e<=0)return"0h";const t=Math.floor(e),a=Math.round(60*(e-t));return a>0?`${t}h ${a}m`:`${t}h`},E=(e,t)=>{const a=new Date(e),n=new Date(t);let r=0;const i=new Set(["2024-01-01","2024-03-29","2024-04-01","2024-05-06","2024-05-27","2024-08-26","2024-12-25","2024-12-26","2025-01-01","2025-04-18","2025-04-21","2025-05-05","2025-05-26","2025-08-25","2025-12-25","2025-12-26"]);for(let s=new Date(a);s<=n;s.setDate(s.getDate()+1)){const e=s.getDay(),t=s.toISOString().split("T")[0];0===e||6===e||i.has(t)||r++}return r},N=e=>{switch(e){case"up":return"\u2197";case"down":return"\u2198";case"away":return"\u2708";default:return""}},H=(e,t)=>{switch(e){case"up":return"#10B981";case"down":return"#EF4444";case"away":return t?"#94A3B8":"#64748B";default:return t?"#9CA3AF":"#6B7280"}},P=e=>0===e?"\xa30":Math.abs(e)<1e3?`\xa3${e.toLocaleString("en-GB",{minimumFractionDigits:0,maximumFractionDigits:0})}`:Math.abs(e)<1e6?`\xa3${(e/1e3).toFixed(1)}k`:`\xa3${(e/1e6).toFixed(2)}m`,q=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"n/a",O=e=>{var t,a,i,o,l;let{enquiries:g,allMatters:$,wip:O,recoveredFees:Y,teamData:G,userData:U,annualLeave:V,triggerRefresh:K,lastRefreshTimestamp:J,isFetching:X=!1}=e;(0,n.useEffect)(()=>{if("undefined"!==typeof document&&!document.getElementById("refreshSpinAnimation")){const e=document.createElement("style");e.id="refreshSpinAnimation",e.textContent="\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      ",document.head.appendChild(e)}},[]);const{isDarkMode:Q}=(0,c.DP)(),[{start:Z,end:ee},te]=(0,n.useState)(()=>S("all")),[ae,ne]=(0,n.useState)("all"),[re,ie]=(0,n.useState)(void 0),[se,oe]=(0,n.useState)(void 0),[le,de]=(0,n.useState)(null),[ce,ge]=(0,n.useState)(null),[ue,pe]=(0,n.useState)(!1),[he,xe]=(0,n.useState)(!1),[fe,me]=(0,n.useState)(0);(0,n.useEffect)(()=>{if(!K)return;const e=setInterval(()=>{me(e=>e+1)},1e3),t=setInterval(()=>{(0,x.cY)("\ud83d\udd04 Auto-refresh triggered after 15 minutes"),K(),me(0)},9e5);return()=>{clearInterval(e),clearInterval(t)}},[K]),(0,n.useEffect)(()=>{J&&me(0)},[J]);const ye=()=>{const e=Math.min(fe/900,1);return`rgb(${Math.round(34+25*e)}, ${Math.round(197+-67*e)}, ${Math.round(94+152*e)})`},be=(e,t,a)=>{if(!V)return!1;const n=E(e,t);if(0===n)return!1;const r=V.filter(e=>e.fe===a&&(e.status.toLowerCase().includes("approved")||e.status.toLowerCase().includes("confirmed")));let i=0;for(const s of r){const a=new Date(s.start_date),n=new Date(s.end_date),r=a>e?a:e,o=n<t?n:t;if(r<=o){i+=E(r,o)}}return i>=n},ve=(e,t,a)=>{const n=E(e,t),r=((e,t,a,n)=>{if(!V)return 0;if(("today"===n||"week"===n)&&be(e,t,a))return 0;const r=V.filter(e=>e.fe===a&&(e.status.toLowerCase().includes("approved")||e.status.toLowerCase().includes("confirmed")));let i=0;for(const s of r){const a=new Date(s.start_date),n=new Date(s.end_date),r=a>e?a:e,o=n<t?n:t;r<=o&&(i+=E(r,o))}return i})(e,t,a,ae);return 6*Math.max(0,n-r)},je=[{key:"Partner",label:"Partner"},{key:"Associate Solicitor",label:"Associate"},{key:"Solicitor",label:"Solicitor"},{key:"Paralegal",label:"Paralegal"},{key:"Ops",label:"Ops"},{key:"Inactive",label:"Inactive"}],[ke,we]=(0,n.useState)([]),[Me,Se]=(0,n.useState)([]),[Ce,De]=(0,n.useState)(!1),[Te,_e]=(0,n.useState)("displayName"),[Re,We]=(0,n.useState)("asc"),Fe=null!==g&&void 0!==g?g:[],ze=null!==$&&void 0!==$?$:[],Ie=null!==O&&void 0!==O?O:[],$e=null!==Y&&void 0!==Y?Y:[],Le=null!==G&&void 0!==G?G:[],Ae=(0,n.useMemo)(()=>null!==re&&void 0!==re?re:Z,[re,Z]),Be=(0,n.useMemo)(()=>null!==se&&void 0!==se?se:ee,[se,ee]),Ee=e=>{if(!e)return!1;const t=new Date(Be);return t.setHours(23,59,59,999),e>=Ae&&e<=t},Ne=(0,n.useMemo)(()=>Fe.filter(e=>Ee(_(e.Touchpoint_Date))),[Fe,Ae,Be]),He=(0,n.useMemo)(()=>ze.filter(e=>{var t,a,n;const r=null!==(t=e["Open Date"])&&void 0!==t?t:e.OpenDate,i=null!==(a=e["Close Date"])&&void 0!==a?a:e.CloseDate,s=null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:"",o=_(s);return Ee(o)}),[ze,Ae,Be]),Pe=(0,n.useMemo)(()=>{const e=new Date(Ae.getFullYear(),Ae.getMonth(),Ae.getDate()).getTime(),t=new Date(Be);t.setHours(23,59,59,999);const a=t.getTime(),n=Ie.filter(t=>{const n=(e=>{if("string"!==typeof e){const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?null:new Date(t.getFullYear(),t.getMonth(),t.getDate())}const t=e.trim(),a=t.match(/^(\d{4})-(\d{2})-(\d{2})/);if(a){const e=Number(a[1]),t=Number(a[2])-1,n=Number(a[3]);return new Date(e,t,n)}const n=new Date(t);return Number.isNaN(n.getTime())?null:new Date(n.getFullYear(),n.getMonth(),n.getDate())})(t.date||t.created_at||t.updated_at);if(!n)return!1;const r=n.getTime();return r>=e&&r<=a});if("week"===ae&&(console.log("[ManagementDashboard] Filtered WIP for This Week:",n.map(e=>({date:e.date,created_at:e.created_at,hours:e.quantity_in_hours,value:e.total}))),0===n.length&&Ie.length>0)){const e=Ie.slice(0,5).map(e=>({rawDate:e.date,rawCreated:e.created_at}));console.log("[ManagementDashboard] WIP sample (first 5) with dates:",e,"Range:",{start:Ae,end:Be})}return n},[Ie,Ae,Be,ae]),qe=(0,n.useMemo)(()=>$e.filter(e=>"Expense"!==e.kind&&"Product"!==e.kind&&Ee(_(e.payment_date))),[$e,Ae,Be]),Oe=(0,n.useMemo)(()=>Le.filter(e=>Boolean(e.Initials)).map(e=>{var t;const a="string"===typeof e.status?e.status:"string"===typeof e.Status?String(e.Status):void 0,n=!!a&&"active"===a.toLowerCase(),r=e.Role?String(e.Role):void 0;var i;if(!n)return{initials:null!==(i=e.Initials)&&void 0!==i?i:"",record:e,display:A(e),clioId:e["Clio ID"]?String(e["Clio ID"]):void 0,role:"Inactive",isActive:!1};let s=r;return"Non-solicitor"!==r&&"Operations 1"!==r||(s="Ops"),{initials:null!==(t=e.Initials)&&void 0!==t?t:"",record:e,display:A(e),clioId:e["Clio ID"]?String(e["Clio ID"]):void 0,role:s,isActive:!0}}).sort((e,t)=>e.display.localeCompare(t.display)),[Le]),Ye=(0,n.useMemo)(()=>{const e=Me.includes("Ops"),t=Me.includes("Inactive");return Oe.filter(a=>"Ops"!==a.role&&"Inactive"!==a.role||(!("Ops"!==a.role||!e)||!("Inactive"!==a.role||!t)))},[Oe,Me]),Ge=(0,n.useMemo)(()=>{let e=Ye;return ke.length>0&&(e=e.filter(e=>ke.includes(e.initials))),Me.length>0&&(e=e.filter(e=>{var t;return Me.includes(null!==(t=e.role)&&void 0!==t?t:"")})),e},[Ye,ke,Me]),Ue=(0,n.useMemo)(()=>{const e=new Map;return Pe.forEach(t=>{var a;const n=null!=t.user_id?String(t.user_id):null!=(null===(a=t.user)||void 0===a?void 0:a.id)?String(t.user.id):null;n&&(e.has(n)||e.set(n,[]),e.get(n).push(t))}),e},[Pe]),Ve=(0,n.useMemo)(()=>{const e=new Map;return qe.forEach(t=>{var a;const n=String(null!==(a=t.user_id)&&void 0!==a?a:"");n&&(e.has(n)||e.set(n,[]),e.get(n).push(t))}),e},[qe]),Ke=(0,n.useMemo)(()=>{const e=new Map,t=new Map;return Ne.forEach(a=>{if("string"===typeof a.Point_of_Contact){const t=a.Point_of_Contact.toLowerCase();e.has(t)||e.set(t,[]),e.get(t).push(a)}const n=String(a.Point_of_Contact||"").toUpperCase();n&&n.length<=4&&(t.has(n)||t.set(n,[]),t.get(n).push(a))}),{byEmail:e,byInitials:t}},[Ne]),Je=(0,n.useMemo)(()=>{const e=new Map;He.forEach(t=>{var a,n;const r=L(null!==(a=t["Originating Solicitor"])&&void 0!==a?a:t.OriginatingSolicitor),i=L(null!==(n=t["Responsible Solicitor"])&&void 0!==n?n:t.ResponsibleSolicitor),s=I(r),o=I(i),l=t.matterId||t["Unique ID"]||t.UniqueID||JSON.stringify(t);s&&(e.has(s)||e.set(s,new Map),e.get(s).set(l,t)),o&&(e.has(o)||e.set(o,new Map),e.get(o).set(l,t))});const t=new Map;return e.forEach((e,a)=>{t.set(a,Array.from(e.values()))}),t},[He]),Xe=(0,n.useMemo)(()=>Ge.map(e=>{const t=e.record.Email?String(e.record.Email).toLowerCase():void 0,a=e.record["Full Name"]?String(e.record["Full Name"]):e.display;let n=[];n=t?Ke.byEmail.get(t)||[]:Ke.byInitials.get(e.initials.toUpperCase())||[];const r=I(a),i=r&&Je.get(r)||[],s=e.clioId&&Ue.get(e.clioId)||[],o=e.clioId&&Ve.get(e.clioId)||[],l=s.reduce((e,t)=>e+R(t.quantity_in_hours),0),d=re&&se?ve(re,se,e.initials):0,c=re&&se&&("today"===ae||"week"===ae)&&be(re,se,e.initials),g=0===l&&re&&se&&V&&V.some(t=>{if(t.fe!==e.initials)return!1;if(!t.status.toLowerCase().includes("approved")&&!t.status.toLowerCase().includes("confirmed"))return!1;const a=new Date(t.start_date),n=new Date(t.end_date);return a<=se&&n>=re});let u;return u=c?"away":g?"neutral":0===d&&l>0?"up":((e,t)=>{if(0===t)return"neutral";const a=e/t;return a>1?"up":a<1?"down":"neutral"})(l,d),{initials:e.initials,displayName:e.display,enquiries:n.length,matters:i.length,wipHours:l,wipValue:s.reduce((e,t)=>e+R(t.total),0),collected:o.reduce((e,t)=>e+R(t.payment_allocated),0),targetHours:d,trendDirection:u}}),[Ge,Ke,Je,Ue,Ve]),Qe=(0,n.useMemo)(()=>[...Xe].sort((e,t)=>{const a=e.wipHours>0,n=t.wipHours>0;if(a&&!n)return-1;if(!a&&n)return 1;let r=e[Te],i=t[Te];if("string"===typeof r&&"string"===typeof i){const e=r.localeCompare(i);return"asc"===Re?e:-e}if("number"===typeof r&&"number"===typeof i){const e=r-i;return"asc"===Re?e:-e}return 0}),[Xe,Te,Re]),Ze=(0,n.useMemo)(()=>Qe.reduce((e,t)=>({enquiries:e.enquiries+t.enquiries,matters:e.matters+t.matters,wipHours:e.wipHours+t.wipHours,wipValue:e.wipValue+t.wipValue,collected:e.collected+t.collected}),{enquiries:0,matters:0,wipHours:0,wipValue:0,collected:0}),[Qe]),et=(0,n.useMemo)(()=>{const e=Pe.reduce((e,t)=>({hours:e.hours+R(t.quantity_in_hours),value:e.value+R(t.total)}),{hours:0,value:0}),t=qe.reduce((e,t)=>e+R(t.payment_allocated),0);return{enquiries:Ne.length,matters:He.length,wipHours:e.hours,wipValue:e.value,collected:t}},[Ne,He,Pe,qe]),tt=n.useMemo(()=>((e,t,a)=>{if("all"===e||"custom"===e)return null;const n=new Date,r=new Date;switch(e){case"today":{const e=new Date(t);for(e.setDate(e.getDate()-1);0===e.getDay()||6===e.getDay();)e.setDate(e.getDate()-1);n.setTime(e.getTime()),n.setHours(0,0,0,0),r.setTime(e.getTime()),r.setHours(23,59,59,999);break}case"yesterday":{const e=new Date(t);e.setDate(e.getDate()-1),n.setTime(e.getTime()),n.setHours(0,0,0,0),r.setTime(e.getTime()),r.setHours(23,59,59,999);break}case"week":{const e=Math.ceil((a.getTime()-t.getTime())/864e5)+1,i=new Date(t);i.setDate(i.getDate()-7),n.setTime(i.getTime()),r.setTime(i.getTime()),r.setDate(r.getDate()+e-1),r.setHours(23,59,59,999);break}case"lastWeek":{const e=new Date(t);e.setDate(e.getDate()-7),e.setHours(0,0,0,0);const a=new Date(e);a.setDate(a.getDate()+6),a.setHours(23,59,59,999),n.setTime(e.getTime()),r.setTime(a.getTime());break}case"month":{const e=new Date(t);e.setMonth(e.getMonth()-1,1),n.setTime(e.getTime()),n.setHours(0,0,0,0),r.setTime(e.getTime()),r.setMonth(r.getMonth()+1,0),r.setHours(23,59,59,999);break}case"lastMonth":{const e=new Date(t);e.setMonth(e.getMonth()-1,1),n.setTime(e.getTime()),n.setHours(0,0,0,0),r.setTime(e.getTime()),r.setMonth(r.getMonth()+1,0),r.setHours(23,59,59,999);break}case"last90Days":{const e=864e5,i=Math.max(1,Math.round((a.getTime()-t.getTime())/e)+1),s=new Date(t);s.setDate(s.getDate()-1),s.setHours(23,59,59,999);const o=new Date(s);o.setDate(o.getDate()-(i-1)),o.setHours(0,0,0,0),n.setTime(o.getTime()),r.setTime(s.getTime());break}case"quarter":{const e=new Date(t);e.setMonth(e.getMonth()-3,1),n.setTime(e.getTime()),n.setHours(0,0,0,0),r.setTime(e.getTime()),r.setMonth(r.getMonth()+3,0),r.setHours(23,59,59,999);break}case"yearToDate":{const e=new Date(t);e.setFullYear(e.getFullYear()-1),n.setTime(e.getTime()),n.setHours(0,0,0,0),r.setTime(t.getTime()),r.setDate(r.getDate()-1),r.setHours(23,59,59,999);break}case"year":{const e=new Date(t);e.setFullYear(e.getFullYear()-1),e.setHours(0,0,0,0);const i=new Date(a);i.setFullYear(i.getFullYear()-1),i.setHours(23,59,59,999),n.setTime(e.getTime()),r.setTime(i.getTime());break}default:return null}return{start:n,end:r}})(ae,re||Z,se||ee),[ae,re,se,Z,ee]);(0,x.cY)("\ud83d\udd0d Previous Range Debug:",{rangeKey:ae,currentStart:re||Z,currentEnd:se||ee,previousRange:tt,hasPreviousRange:!!tt});const at=(0,n.useMemo)(()=>{if(!tt)return(0,x.cY)("\u274c No previous range calculated"),null;(0,x.cY)("\ud83d\udcca Calculating previous metrics for range:",tt);const e=(null===g||void 0===g?void 0:g.filter(e=>{const t=_(e.Touchpoint_Date);return t&&t>=tt.start&&t<=tt.end}))||[],t=(null===$||void 0===$?void 0:$.filter(e=>{var t,a,n;const r=null!==(t=e["Open Date"])&&void 0!==t?t:e.OpenDate,i=null!==(a=e["Close Date"])&&void 0!==a?a:e.CloseDate,s=null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:"",o=_(s);return o&&o>=tt.start&&o<=tt.end}))||[],a=(null===O||void 0===O?void 0:O.filter(e=>{const t=_(e.created_at);return t&&t>=tt.start&&t<=tt.end}))||[],n=(null===Y||void 0===Y?void 0:Y.filter(e=>{const t=_(e.payment_date);return t&&t>=tt.start&&t<=tt.end}))||[];return{enquiries:e.length,matters:t.length,wipHours:a.reduce((e,t)=>e+R(t.quantity_in_hours),0),wipValue:a.reduce((e,t)=>e+R(t.total),0),collected:n.reduce((e,t)=>e+R(t.payment_allocated),0)}},[tt,g,$,O,Y]),nt=(0,n.useMemo)(()=>{if(!tt||!Oe.length)return new Map;const e=(null===g||void 0===g?void 0:g.filter(e=>{const t=_(e.Touchpoint_Date);return t&&t>=tt.start&&t<=tt.end}))||[],t=(null===$||void 0===$?void 0:$.filter(e=>{var t,a,n;const r=null!==(t=e["Open Date"])&&void 0!==t?t:e.OpenDate,i=null!==(a=e["Close Date"])&&void 0!==a?a:e.CloseDate,s=null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:"",o=_(s);return o&&o>=tt.start&&o<=tt.end}))||[],a=(null===O||void 0===O?void 0:O.filter(e=>{const t=_(e.created_at);return t&&t>=tt.start&&t<=tt.end}))||[],n=(null===Y||void 0===Y?void 0:Y.filter(e=>{const t=_(e.payment_date);return t&&t>=tt.start&&t<=tt.end}))||[],r=new Map;return Oe.forEach(i=>{const s=e.filter(e=>{var t,a;const n=null===(t=i.record.Email)||void 0===t?void 0:t.toLowerCase();return!(!n||(null===(a=e.Point_of_Contact)||void 0===a?void 0:a.toLowerCase())!==n)||((e,t)=>z(e.Point_of_Contact,t)||z(e.Call_Taker,t))(e,i.initials)}),o=t.filter(e=>((e,t)=>z(e.ResponsibleSolicitor,t)||z(e.OriginatingSolicitor,t))(e,i.initials)),l=a.filter(e=>{var t;if(!i.clioId)return!1;const a=null!=e.user_id?String(e.user_id):void 0,n=null!=(null===(t=e.user)||void 0===t?void 0:t.id)?String(e.user.id):void 0;return a===i.clioId||n===i.clioId}),d=n.filter(e=>{var t;return!!i.clioId&&String(null!==(t=e.user_id)&&void 0!==t?t:"")===i.clioId}),c=l.reduce((e,t)=>e+R(t.quantity_in_hours),0),g=l.reduce((e,t)=>e+R(t.total),0),u=d.reduce((e,t)=>e+R(t.payment_allocated),0);r.set(i.initials,{enquiries:s.length,matters:o.length,wipHours:c,wipValue:g,collected:u}),"CH"===i.initials&&0===o.length&&(0,x.cY)("CH matters debug:",{totalPrevMatters:t.length,prevMattersForMember:o.length,memberInitials:i.initials,sampleMatters:t.slice(0,3).map(e=>({DateOpened:e.DateOpened,ResponsibleSolicitor:e.ResponsibleSolicitor,OriginatingSolicitor:e.OriginatingSolicitor}))})}),r},[tt,g,$,O,Y,Oe]),rt=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"count",n=arguments.length>3?arguments[3]:void 0;if(!at||void 0===t)return null;const r=((e,t)=>{if(0===e&&0===t)return{percentage:0,direction:"neutral"};if(0===t&&e>0)return{percentage:e,direction:"up"};if(0===e&&t>0)return{percentage:100,direction:"down"};const a=(e-t)/t*100;return{percentage:Math.abs(a),direction:a>0?"up":a<0?"down":"neutral"}})(e,t);if("neutral"===r.direction)return null;const i="up"===r.direction?Q?"#22c55e":"#16a34a":Q?"#ef4444":"#dc2626",s="up"===r.direction?"\u2197":"\u2198";let o;if("currency"===a){const a=e-t,n=Math.abs(a);o=n>=1e3?`\xa3${(n/1e3).toFixed(0)}k`:`\xa3${n.toFixed(0)}`}else if("hours"===a){const a=Math.abs(e-t);o=a<10?`${a.toFixed(1)}h`:`${r.percentage.toFixed(0)}%`}else{const a=Math.abs(e-t);o=0===t&&e>0?`+${e}`:0===e&&t>0||a<=5?`${a}`:`${r.percentage.toFixed(0)}%`}return(0,f.jsxs)("span",{style:{fontSize:10,fontWeight:600,color:i,display:"flex",alignItems:"center",gap:2,fontFamily:"Raleway, sans-serif",letterSpacing:"0.02em",cursor:"help",padding:"2px 4px",borderRadius:4,transition:"all 0.2s ease"},onMouseEnter:e=>{const t=e.currentTarget.getBoundingClientRect();de({type:n,x:t.left+t.width/2,y:t.top-10})},onMouseLeave:()=>de(null),title:`Compare ${D(ae)} vs ${T(ae)}`,children:[s," ",o]})},it=e=>{if(ne(e),"custom"===e)return;const t=S(e);te(t),"all"===e?(ie(void 0),oe(void 0)):(ie(t.start),oe(t.end))},st=()=>{pt||((()=>{const e=new Date,t=!Ae||"all"===ae||Ae.getFullYear()<1980?(()=>{const t=new Date(e);return t.setDate(e.getDate()-6),t.setHours(0,0,0,0),t})():new Date(Ae),a=Be&&"all"!==ae?new Date(Be):(()=>{const t=new Date(e);return t.setHours(23,59,59,999),t})();ie(t),oe(a)})(),ne("custom"))},ot=e=>{const t=Oe.find(t=>t.initials===e);if(!t||!t.clioId)return!1;return(Ue.get(t.clioId)||[]).reduce((e,t)=>e+R(t.quantity_in_hours),0)>0},lt=e=>{Te===e?We("asc"===Re?"desc":"asc"):(_e(e),We("asc"))},dt=e=>{const t=Te===e,a={marginLeft:"6px",fontSize:"10px",opacity:t?.9:.35,transition:"opacity 0.2s ease, transform 0.2s ease",fontWeight:"normal",color:"currentColor",display:"inline-block",lineHeight:1};return t?(0,f.jsx)("span",{style:a,children:"asc"===Re?"\u25b4":"\u25be"}):(0,f.jsx)("span",{style:a,children:"\u25b4"})},ct=Q?"dark-theme":"light-theme",gt=0===ke.length||ke.length===Ye.length,ut=0===Me.length||Me.length===je.length,pt="custom"===ae,ht=m.some(e=>e.key===ae)?ae:void 0,xt="all"===ae?"All Time":q(Ae),ft=q(Be);return(0,f.jsxs)("div",{className:`management-dashboard-container animate-dashboard ${ct}`,children:[(0,f.jsxs)("div",{className:"filter-toolbar",children:[(0,f.jsxs)("div",{className:"filter-toolbar__top",children:[(0,f.jsx)("div",{className:"filter-toolbar__date-inputs",children:pt?(0,f.jsxs)("div",{className:"date-pickers",children:[(0,f.jsx)(u.l,{label:"From",styles:y(Q),value:re,onSelectDate:e=>{ie(null!==e&&void 0!==e?e:void 0),ne("custom")},allowTextInput:!0,firstDayOfWeek:p.ob.Monday,formatDate:W,parseDateFromString:F}),(0,f.jsx)(u.l,{label:"To",styles:y(Q),value:se,onSelectDate:e=>{oe(null!==e&&void 0!==e?e:void 0),ne("custom")},allowTextInput:!0,firstDayOfWeek:p.ob.Monday,formatDate:W,parseDateFromString:F})]}):(0,f.jsxs)("div",{className:"date-stamp-group",children:[(0,f.jsxs)("button",{type:"button",className:"date-stamp-button",style:w(Q),onClick:st,title:"Click to customise the start date",onMouseEnter:e=>{e.currentTarget.style.background=Q?"rgba(30, 41, 59, 0.86)":"rgba(248, 250, 252, 1)",e.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.currentTarget.style.background=Q?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",e.currentTarget.style.transform="translateY(0)"},children:[(0,f.jsx)("span",{style:{fontSize:11,opacity:.7,fontWeight:600},children:"From"}),(0,f.jsx)("span",{style:{fontSize:16,fontWeight:700},children:xt})]}),(0,f.jsxs)("button",{type:"button",className:"date-stamp-button",style:w(Q),onClick:st,title:"Click to customise the end date",onMouseEnter:e=>{e.currentTarget.style.background=Q?"rgba(30, 41, 59, 0.86)":"rgba(248, 250, 252, 1)",e.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.currentTarget.style.background=Q?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",e.currentTarget.style.transform="translateY(0)"},children:[(0,f.jsx)("span",{style:{fontSize:11,opacity:.7,fontWeight:600},children:"To"}),(0,f.jsx)("span",{style:{fontSize:16,fontWeight:700},children:ft})]})]})}),(0,f.jsxs)("div",{className:"filter-toolbar__actions",children:[(0,f.jsx)("div",{className:"filter-status-chip",style:{borderColor:X?void 0:ye(),transition:"border-color 1s ease"},title:X?"Refreshing data...":`Next auto-refresh in ${Math.floor((900-fe)/60)}m ${(900-fe)%60}s`,children:X?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"filter-status-indicator"}),"Refreshing"]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"filter-status-indicator",style:{background:ye(),transition:"background 1s ease"}}),(e=>{if(!e)return"Pending";const t=Date.now(),a=Math.floor((t-e)/1e3);return a<60?"Just now":a<120?"1 min ago":a<3600?`${Math.floor(a/60)} mins ago`:a<7200?"1 hour ago":a<86400?`${Math.floor(a/3600)} hours ago`:a<172800?"1 day ago":`${Math.floor(a/86400)} days ago`})(J)]})}),K&&(0,f.jsx)("button",{type:"button",onClick:()=>{K(),me(0)},disabled:X,className:"filter-icon-button",title:X?"Refreshing data...":"Refresh datasets (auto-refreshes every 15 min)","aria-label":X?"Refreshing data":"Refresh datasets",children:(0,f.jsx)(h.I,{iconName:"Refresh",style:{fontSize:16,animation:X?"spin 1s linear infinite":"none"}})}),(0,f.jsx)("button",{type:"button",onClick:()=>De(!Ce),className:"filter-icon-button",style:{color:Ce?Q?"#60a5fa":d.M.highlight:Q?"rgba(148, 163, 184, 0.6)":"rgba(13, 47, 96, 0.5)",transform:Ce?"translateY(-1px)":"translateY(0)"},title:Ce?"Hide role filter":"Show role filter","aria-label":Ce?"Hide role filter":"Show role filter",children:(0,f.jsx)(h.I,{iconName:"People",style:{fontSize:16}})}),(0,f.jsxs)("div",{className:"filter-icon-button-wrapper",children:[(0,f.jsx)("button",{type:"button",onMouseEnter:()=>pe(!0),onMouseLeave:()=>pe(!1),className:"filter-icon-button",style:{color:Q?"#60a5fa":d.M.highlight,transform:ue?"translateY(-1px)":"translateY(0)"},title:"Dataset information","aria-label":"Dataset information",children:(0,f.jsx)(h.I,{iconName:"Info",style:{fontSize:16}})}),ue&&(0,f.jsxs)("div",{className:"filter-dataset-tooltip",children:[(0,f.jsx)("div",{style:{fontWeight:700,marginBottom:8,fontSize:13,color:Q?"#60a5fa":d.M.highlight},children:"Dataset Date Ranges"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,f.jsx)("span",{style:{opacity:.8},children:"Enquiries:"}),(0,f.jsx)("span",{style:{fontWeight:600},children:"Last 24 months"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,f.jsx)("span",{style:{opacity:.8},children:"Matters:"}),(0,f.jsx)("span",{style:{fontWeight:600},children:"Last 24 months"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,f.jsx)("span",{style:{opacity:.8},children:"WIP:"}),(0,f.jsx)("span",{style:{fontWeight:600},children:"Last 12 months"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,f.jsx)("span",{style:{opacity:.8},children:"Recovered Fees:"}),(0,f.jsx)("span",{style:{fontWeight:600},children:"Last 12 months"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,f.jsx)("span",{style:{opacity:.8},children:"Annual Leave:"}),(0,f.jsx)("span",{style:{fontWeight:600},children:"Current year"})]})]}),(0,f.jsx)("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid "+(Q?"rgba(148, 163, 184, 0.2)":"rgba(148, 163, 184, 0.3)"),fontSize:11,opacity:.7,fontStyle:"italic"},children:"Data outside these ranges won't appear in metrics"})]})]})]})]}),(0,f.jsx)("div",{className:"filter-toolbar__middle",children:(0,f.jsx)("div",{className:"filter-toolbar__presets",children:(0,f.jsxs)("div",{className:"filter-preset-group",children:[m.slice(0,2).map(e=>{let{key:t,label:a}=e;return(0,f.jsx)(r.Y,{text:a,onClick:()=>it(t),styles:b(Q,ht===t,!1)},t)}),(0,f.jsx)("div",{className:"preset-separator",children:"|"}),m.slice(2,4).map(e=>{let{key:t,label:a}=e;return(0,f.jsx)(r.Y,{text:a,onClick:()=>it(t),styles:b(Q,ht===t,!1)},t)}),(0,f.jsx)("div",{className:"preset-separator",children:"|"}),m.slice(4,6).map(e=>{let{key:t,label:a}=e;return(0,f.jsx)(r.Y,{text:a,onClick:()=>it(t),styles:b(Q,ht===t,!1)},t)}),(0,f.jsx)("div",{className:"preset-separator",children:"|"}),m.slice(6,8).map(e=>{let{key:t,label:a}=e;return(0,f.jsx)(r.Y,{text:a,onClick:()=>it(t),styles:b(Q,ht===t,!1)},t)}),(0,f.jsx)("div",{className:"preset-separator",children:"|"}),m.slice(8,10).map(e=>{let{key:t,label:a}=e;return(0,f.jsx)(r.Y,{text:a,onClick:()=>it(t),styles:b(Q,ht===t,!1)},t)}),ht&&"all"!==ht&&(0,f.jsxs)("button",{onClick:()=>{it("all")},style:M(Q),title:"Clear date range filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]})})}),(0,f.jsx)("div",{className:"filter-toolbar__bottom",children:(0,f.jsx)("div",{className:"filter-group-container team-filter-container",children:(0,f.jsxs)("div",{className:"team-slicer-buttons",children:[Ye.map(e=>(0,f.jsx)(r.Y,{text:e.initials,onClick:()=>{return t=e.initials,void we(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},title:ot(e.initials)?void 0:`${e.display||e.initials} has no WIP hours in this period`,styles:v(Q,ke.includes(e.initials),ot(e.initials))},e.initials)),!gt&&(0,f.jsxs)("button",{onClick:()=>{gt||we([])},style:M(Q),title:"Clear team filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]})})}),Ce&&(0,f.jsx)("div",{className:"filter-toolbar__roles",children:(0,f.jsx)("div",{className:"filter-group-container role-filter-container",children:(0,f.jsxs)("div",{className:"role-slicer-buttons",children:[je.map(e=>{let{key:t,label:a}=e;return(0,f.jsx)(r.Y,{text:a,onClick:()=>(e=>{const t=Me.includes(e);if(Se(a=>t?a.filter(t=>t!==e):[...a,e]),t){const t=Me.filter(t=>t!==e);if(t.length>0)we(e=>e.filter(e=>{var a;const n=Oe.find(t=>t.initials===e);return n&&t.includes(null!==(a=n.role)&&void 0!==a?a:"")}));else{const t=Oe.filter(t=>t.role===e).map(e=>e.initials);we(e=>e.filter(e=>!t.includes(e)))}}else{const t=Oe.filter(t=>t.role===e).map(e=>e.initials);we(e=>{const a=new Set([...e,...t]);return Array.from(a)})}})(t),styles:j(Q,Me.includes(t))},t)}),!ut&&(0,f.jsxs)("button",{onClick:()=>{ut||(Se([]),we([]))},style:M(Q),title:"Clear role filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]})})})]}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:12},children:[(0,f.jsxs)("div",{style:k(Q),children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%"},children:[(0,f.jsx)("span",{style:{fontSize:12,opacity:.65},children:"Enquiries"}),rt(et.enquiries,null===at||void 0===at?void 0:at.enquiries,"count","enquiries")]}),(0,f.jsx)("span",{style:{fontSize:20,fontWeight:700},children:et.enquiries.toLocaleString("en-GB")})]}),(0,f.jsxs)("div",{style:k(Q),children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%"},children:[(0,f.jsx)("span",{style:{fontSize:12,opacity:.65},children:"Matters"}),rt(et.matters,null===at||void 0===at?void 0:at.matters,"count","matters")]}),(0,f.jsx)("span",{style:{fontSize:20,fontWeight:700},children:et.matters.toLocaleString("en-GB")})]}),(0,f.jsxs)("div",{style:k(Q),children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%"},children:[(0,f.jsx)("span",{style:{fontSize:12,opacity:.65},children:"WIP Hours"}),rt(et.wipHours,null===at||void 0===at?void 0:at.wipHours,"hours","wipHours")]}),(0,f.jsx)("span",{style:{fontSize:20,fontWeight:700},children:B(et.wipHours)})]}),(0,f.jsxs)("div",{style:k(Q),children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%"},children:[(0,f.jsx)("span",{style:{fontSize:12,opacity:.65},children:"WIP (\xa3)"}),rt(et.wipValue,null===at||void 0===at?void 0:at.wipValue,"currency","wipValue")]}),(0,f.jsx)("span",{style:{fontSize:20,fontWeight:700},children:P(et.wipValue)})]}),(0,f.jsxs)("div",{style:{...k(Q),position:"relative"},onMouseEnter:()=>xe(!0),onMouseLeave:()=>xe(!1),children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%"},children:[(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,f.jsx)("span",{style:{fontSize:12,opacity:.65},children:"Collected"}),(0,f.jsx)(h.I,{iconName:"Info",style:{fontSize:10,opacity:.4,cursor:"help"}})]}),rt(et.collected,null===at||void 0===at?void 0:at.collected,"currency","collected")]}),(0,f.jsx)("span",{style:{fontSize:20,fontWeight:700},children:P(et.collected)}),he&&(0,f.jsxs)("div",{style:{position:"absolute",top:"100%",right:0,marginTop:8,padding:"10px 12px",background:Q?"rgba(15, 23, 42, 0.98)":"rgba(255, 255, 255, 0.98)",border:"1px solid "+(Q?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.25)"),borderRadius:8,boxShadow:Q?"0 8px 16px rgba(0, 0, 0, 0.4)":"0 4px 12px rgba(0, 0, 0, 0.15)",fontSize:11,lineHeight:1.5,width:240,zIndex:1e3,color:Q?"#e2e8f0":"#334155",textAlign:"left"},children:[(0,f.jsx)("div",{style:{fontWeight:700,marginBottom:6,fontSize:12,textAlign:"left"},children:"Total Fees Collected"}),(0,f.jsx)("div",{style:{opacity:.85,textAlign:"left"},children:"Includes all fee earners (active, Ops, and inactive)."}),(0,f.jsx)("div",{style:{marginTop:6,opacity:.85,textAlign:"left"},children:"Table below shows only active solicitors and selected filters."}),(0,f.jsx)("div",{style:{marginTop:8,paddingTop:6,borderTop:"1px solid "+(Q?"rgba(148, 163, 184, 0.2)":"rgba(148, 163, 184, 0.25)"),fontSize:10,opacity:.65,fontStyle:"italic",textAlign:"left"},children:"Excludes disbursements"})]})]})]}),X&&(0,f.jsx)("div",{style:{display:"flex",alignItems:"center",gap:6},children:(0,f.jsx)(s.y,{label:"Refreshing data"})}),(0,f.jsxs)("div",{className:"metrics-table",children:[(0,f.jsxs)("div",{className:"metrics-table-header",children:[(0,f.jsxs)("span",{onClick:()=>lt("displayName"),style:{cursor:"pointer",userSelect:"none"},title:"Click to sort by team member",children:["Team ",dt("displayName")]}),(0,f.jsxs)("span",{onClick:()=>lt("enquiries"),style:{cursor:"pointer",userSelect:"none"},title:"Click to sort by enquiries",children:["Enquiries ",dt("enquiries")]}),(0,f.jsxs)("span",{onClick:()=>lt("matters"),style:{cursor:"pointer",userSelect:"none"},title:"Click to sort by matters",children:["Matters ",dt("matters")]}),(0,f.jsxs)("span",{onClick:()=>lt("wipHours"),style:{cursor:"pointer",userSelect:"none"},title:"Click to sort by WIP hours",children:["WIP (h) ",dt("wipHours")]}),(0,f.jsxs)("span",{onClick:()=>lt("wipValue"),style:{cursor:"pointer",userSelect:"none"},title:"Click to sort by WIP value",children:["WIP (\xa3) ",dt("wipValue")]}),(0,f.jsxs)("span",{onClick:()=>lt("collected"),style:{cursor:"pointer",userSelect:"none"},title:"Click to sort by collected fees",children:["Collected ",dt("collected")]})]}),0===Qe.length&&(0,f.jsxs)("div",{className:"metrics-table-row animate-table-row",children:[(0,f.jsx)("span",{children:"No team members selected"}),(0,f.jsx)("span",{children:"0"}),(0,f.jsx)("span",{children:"0"}),(0,f.jsx)("span",{children:"0h"}),(0,f.jsx)("span",{children:"\xa30"}),(0,f.jsx)("span",{children:"\xa30"})]}),Qe.map((e,t)=>{const a=0===e.wipHours,r=t>0?Qe[t-1]:null,i=a&&((null===r||void 0===r?void 0:r.wipHours)||0)>0;return(0,f.jsxs)(n.Fragment,{children:[i&&(0,f.jsxs)("div",{className:"metrics-table-row",style:{opacity:.6,fontSize:"11px",fontStyle:"italic",background:Q?"rgba(71, 85, 105, 0.1)":"rgba(148, 163, 184, 0.08)",borderTop:"1px solid "+(Q?"#475569":"#94A3B8"),padding:"6px 12px"},children:[(0,f.jsx)("span",{children:"\u2014 Inactive in this period \u2014"}),(0,f.jsx)("span",{}),(0,f.jsx)("span",{}),(0,f.jsx)("span",{}),(0,f.jsx)("span",{}),(0,f.jsx)("span",{})]}),(0,f.jsxs)("div",{className:"metrics-table-row animate-table-row",style:{animationDelay:`${Math.min(.05*t,.5)}s`,opacity:a?.4:1,background:a?Q?"rgba(71, 85, 105, 0.15)":"rgba(148, 163, 184, 0.1)":"transparent",borderLeft:a?"3px solid "+(Q?"#475569":"#94A3B8"):"none",paddingLeft:a?"9px":"12px",filter:a?"grayscale(20%)":"none",color:a?Q?"#64748B":"#94A3B8":"inherit"},children:[(0,f.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,f.jsx)("span",{style:{cursor:"help",padding:"2px 4px",borderRadius:4,transition:"all 0.2s ease"},onMouseEnter:t=>{const a=t.currentTarget.getBoundingClientRect(),n=nt.get(e.initials);ge({member:e,previousData:n,x:a.left+a.width/2,y:a.top-10})},onMouseLeave:()=>ge(null),children:e.displayName}),e.trendDirection&&"neutral"!==e.trendDirection&&(0,f.jsxs)("span",{style:{color:H(e.trendDirection,Q),fontSize:"12px",fontWeight:600},title:"away"===e.trendDirection?"Away on leave":"up"===e.trendDirection&&0===(e.targetHours||0)?"Above target (calculation issue)":"up"===e.trendDirection||"down"===e.trendDirection?`Performance: ${e.wipHours.toFixed(1)}h / ${(e.targetHours||0).toFixed(1)}h target (${(e.wipHours/(e.targetHours||1)*100).toFixed(1)}% of target)`:`At target: ${e.wipHours.toFixed(1)}h / ${(e.targetHours||0).toFixed(1)}h`,children:[N(e.trendDirection),"away"!==e.trendDirection&&e.targetHours&&e.targetHours>0&&(0,f.jsxs)("span",{style:{fontSize:"9px",marginLeft:"2px",opacity:.7,fontWeight:500},children:[(e.wipHours/e.targetHours*100).toFixed(0),"%"]})]}),"neutral"===e.trendDirection&&0===e.wipHours&&(0,f.jsx)("span",{style:{color:H("neutral",Q),fontSize:"12px",fontWeight:600},title:"No work due to leave",children:"\u2014"})]}),(0,f.jsx)("span",{children:e.enquiries.toLocaleString("en-GB")}),(0,f.jsx)("span",{children:e.matters.toLocaleString("en-GB")}),(0,f.jsx)("span",{title:`WIP Hours: ${B(e.wipHours)}\nTarget: ${B(e.targetHours||0)}\nDate Range: ${null===re||void 0===re?void 0:re.toLocaleDateString("en-GB")} - ${null===se||void 0===se?void 0:se.toLocaleDateString("en-GB")}\nPerformance: ${e.targetHours?(e.wipHours/e.targetHours*100).toFixed(1):"N/A"}% of target`,children:B(e.wipHours)}),(0,f.jsx)("span",{children:P(e.wipValue)}),(0,f.jsx)("span",{children:P(e.collected)})]})]},`${e.initials}-${null===re||void 0===re?void 0:re.getTime()}-${null===se||void 0===se?void 0:se.getTime()}-${ae}`)}),(0,f.jsxs)("div",{className:"metrics-table-row animate-table-row",style:{animationDelay:.05*Qe.length+"s"},children:[(0,f.jsx)("span",{children:"Total"}),(0,f.jsx)("span",{children:Ze.enquiries.toLocaleString("en-GB")}),(0,f.jsx)("span",{children:Ze.matters.toLocaleString("en-GB")}),(0,f.jsx)("span",{children:B(Ze.wipHours)}),(0,f.jsx)("span",{children:P(Ze.wipValue)}),(0,f.jsx)("span",{children:P(Ze.collected)})]})]}),le&&tt&&(0,f.jsx)("div",{style:{position:"fixed",left:Math.max(20,Math.min(le.x,window.innerWidth-300)),top:le.y-20,transform:le.x>window.innerWidth-140?"translateX(-100%)":le.x<140?"translateX(0%)":"translateX(-50%)",zIndex:1e4,pointerEvents:"none",maxWidth:280},children:(0,f.jsxs)("div",{style:{background:Q?"linear-gradient(145deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 100%)":"linear-gradient(145deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)",border:"1px solid "+(Q?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.25)"),borderRadius:12,padding:"12px 16px",fontSize:12,fontFamily:"Raleway, sans-serif",boxShadow:Q?"0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.2)":"0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.08)",backdropFilter:"blur(20px)",color:Q?"#e2e8f0":"#475569"},children:[(0,f.jsx)("div",{style:{fontWeight:600,marginBottom:8,fontSize:13},children:"Period Comparison"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,f.jsxs)("span",{style:{opacity:.7,fontWeight:500},children:[D(ae),":"]}),(0,f.jsx)("span",{style:{fontWeight:600},children:"enquiries"===le.type?et.enquiries.toLocaleString("en-GB"):"matters"===le.type?et.matters.toLocaleString("en-GB"):"wipHours"===le.type?B(et.wipHours):"wipValue"===le.type?P(et.wipValue):"collected"===le.type?P(et.collected):""})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,f.jsxs)("span",{style:{opacity:.7,fontWeight:500},children:[T(ae),":"]}),(0,f.jsx)("span",{style:{fontWeight:600},children:"enquiries"===le.type?((null===at||void 0===at?void 0:at.enquiries)||0).toLocaleString("en-GB"):"matters"===le.type?((null===at||void 0===at?void 0:at.matters)||0).toLocaleString("en-GB"):"wipHours"===le.type?B((null===at||void 0===at?void 0:at.wipHours)||0):"wipValue"===le.type?P((null===at||void 0===at?void 0:at.wipValue)||0):"collected"===le.type?P((null===at||void 0===at?void 0:at.collected)||0):""})]}),(0,f.jsx)("div",{style:{height:1,background:Q?"rgba(148, 163, 184, 0.2)":"rgba(148, 163, 184, 0.25)",margin:"6px 0"}}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:11},children:[(0,f.jsx)("span",{style:{opacity:.6},children:C(re||Z,se||ee)}),(0,f.jsxs)("span",{style:{opacity:.6},children:["vs ",C(tt.start,tt.end)]})]})]})]})}),ce&&tt&&(0,f.jsx)("div",{style:{position:"fixed",left:Math.max(20,Math.min(ce.x,window.innerWidth-340)),top:ce.y-20,transform:ce.x>window.innerWidth-160?"translateX(-100%)":ce.x<160?"translateX(0%)":"translateX(-50%)",zIndex:1e4,pointerEvents:"none",maxWidth:320},children:(0,f.jsxs)("div",{style:{background:Q?"linear-gradient(145deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 100%)":"linear-gradient(145deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)",border:"1px solid "+(Q?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.25)"),borderRadius:12,padding:"16px 20px",fontSize:12,fontFamily:"Raleway, sans-serif",boxShadow:Q?"0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.2)":"0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.08)",backdropFilter:"blur(20px)",color:Q?"#e2e8f0":"#475569"},children:[(0,f.jsx)("div",{style:{fontWeight:700,marginBottom:12,fontSize:14,color:Q?"#f1f5f9":"#334155"},children:ce.member.displayName}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:"8px 16px",alignItems:"center"},children:[(0,f.jsx)("div",{style:{fontWeight:600,opacity:.8,fontSize:11,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Metric"}),(0,f.jsx)("div",{style:{fontWeight:600,opacity:.8,fontSize:11,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"right"},children:D(ae)}),(0,f.jsx)("div",{style:{fontWeight:600,opacity:.8,fontSize:11,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"right"},children:T(ae)}),(0,f.jsx)("div",{style:{gridColumn:"1 / -1",height:1,background:Q?"rgba(148, 163, 184, 0.2)":"rgba(148, 163, 184, 0.25)",margin:"4px 0"}}),(0,f.jsx)("div",{style:{fontWeight:500},children:"Enquiries"}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right"},children:ce.member.enquiries}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right",opacity:.7},children:(null===(t=ce.previousData)||void 0===t?void 0:t.enquiries)||0}),(0,f.jsx)("div",{style:{fontWeight:500},children:"Matters"}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right"},children:ce.member.matters}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right",opacity:.7},children:(null===(a=ce.previousData)||void 0===a?void 0:a.matters)||0}),(0,f.jsx)("div",{style:{fontWeight:500},children:"WIP Hours"}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right"},children:B(ce.member.wipHours)}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right",opacity:.7},children:B((null===(i=ce.previousData)||void 0===i?void 0:i.wipHours)||0)}),(0,f.jsx)("div",{style:{fontWeight:500},children:"WIP Value"}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right"},children:P(ce.member.wipValue)}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right",opacity:.7},children:P((null===(o=ce.previousData)||void 0===o?void 0:o.wipValue)||0)}),(0,f.jsx)("div",{style:{fontWeight:500},children:"Collected"}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right"},children:P(ce.member.collected)}),(0,f.jsx)("div",{style:{fontWeight:600,textAlign:"right",opacity:.7},children:P((null===(l=ce.previousData)||void 0===l?void 0:l.collected)||0)})]}),(0,f.jsxs)("div",{style:{marginTop:12,paddingTop:12,borderTop:"1px solid "+(Q?"rgba(148, 163, 184, 0.2)":"rgba(148, 163, 184, 0.25)"),display:"flex",justifyContent:"space-between",fontSize:10,opacity:.6},children:[(0,f.jsx)("span",{children:C(re||Z,se||ee)}),(0,f.jsx)("span",{children:C(tt.start,tt.end)})]})]})})]})},Y=[{key:"Partner",label:"Partner"},{key:"Associate Solicitor",label:"Associate"},{key:"Solicitor",label:"Solicitor"},{key:"Paralegal",label:"Paralegal"},{key:"Ops",label:"Ops"},{key:"Inactive",label:"Inactive"}],G={"Samuel Packwood":"Sam Packwood","Bianca ODonnell":"Bianca O'Donnell"},U=e=>{if(!e)return null;const t=new Date(String(e));return Number.isNaN(t.getTime())?null:t},V=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",K=e=>e?U(e):null,J=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"n/a",X=e=>{const t=e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.18)";return{root:{maxWidth:220,".ms-DatePicker":{fontFamily:"Raleway, sans-serif !important"}},textField:{root:{fontFamily:"Raleway, sans-serif !important",width:"100% !important"},fieldGroup:{height:"36px !important",borderRadius:"8px !important",border:`1px solid ${t} !important`,background:`${e?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.95)"} !important`,padding:"0 14px !important",boxShadow:e?"0 2px 4px rgba(0, 0, 0, 0.2) !important":"0 1px 3px rgba(15, 23, 42, 0.08) !important",transition:"all 0.2s ease !important",selectors:{":hover":{border:`1px solid ${e?"rgba(135, 206, 255, 0.5)":"rgba(54, 144, 206, 0.4)"} !important`,background:`${e?"rgba(15, 23, 42, 0.95)":"rgba(248, 250, 252, 1)"} !important`,boxShadow:e?"0 4px 8px rgba(0, 0, 0, 0.25) !important":"0 2px 6px rgba(15, 23, 42, 0.12) !important"},":focus-within":{border:`1px solid ${e?"#87ceeb":d.M.highlight} !important`,background:`${e?"rgba(15, 23, 42, 1)":"rgba(255, 255, 255, 1)"} !important`,boxShadow:e?"0 2px 4px rgba(135, 206, 255, 0.12) !important":"0 2px 6px rgba(54, 144, 206, 0.15) !important"}}},field:{fontSize:"14px !important",fontFamily:"Raleway, sans-serif !important",fontWeight:"500 !important",background:"transparent !important",lineHeight:"20px !important",border:"none !important",outline:"none !important"}},icon:{color:`${e?d.M.highlight:d.M.missedBlue} !important`,fontSize:"16px !important",fontWeight:"bold !important"},callout:{fontSize:"14px !important",borderRadius:"12px !important",border:`1px solid ${t} !important`,boxShadow:e?"0 8px 24px rgba(0, 0, 0, 0.4) !important":"0 6px 20px rgba(15, 23, 42, 0.15) !important"},wrapper:{borderRadius:"12px !important"}}},Q=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=a?t?`linear-gradient(135deg, ${d.M.highlight} 0%, #2f7cb3 100%)`:e?"rgba(15, 23, 42, 0.8)":"transparent":e?"rgba(100, 116, 139, 0.2)":"rgba(203, 213, 225, 0.35)",r=!a;return{root:{minWidth:48,height:32,fontSize:12,fontWeight:600,borderRadius:8,border:"1px solid",borderColor:t?"#2f7cb3":e?"rgba(148, 163, 184, 0.24)":"rgba(148, 163, 184, 0.4)",background:n,color:r?e?"rgba(148, 163, 184, 0.55)":"rgba(100, 116, 139, 0.8)":t?"#fff":e?"#e2e8f0":"#1e293b",cursor:r?"not-allowed":"pointer",opacity:r?.6:1,fontFamily:"Raleway, sans-serif",padding:"0 12px",transition:"all 0.2s ease"},rootHovered:{background:r?n:t?"#2f7cb3":e?"rgba(148, 163, 184, 0.24)":"rgba(54, 144, 206, 0.12)"},rootPressed:{background:r?n:t?"linear-gradient(135deg, #266795 0%, #1e5a7a 100%)":e?"rgba(15, 23, 42, 0.9)":"rgba(54, 144, 206, 0.14)"}}},Z=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=a?t?`linear-gradient(135deg, ${d.M.highlight} 0%, #2f7cb3 100%)`:e?"rgba(15, 23, 42, 0.8)":"transparent":e?"rgba(100, 116, 139, 0.4)":"rgba(203, 213, 225, 0.6)",r=!a;return{root:{minWidth:40,height:28,fontSize:11,fontWeight:600,border:"1px solid",borderColor:t?"#2f7cb3":e?"rgba(148, 163, 184, 0.3)":"rgba(203, 213, 225, 0.7)",borderRadius:4,color:r?e?"rgba(148, 163, 184, 0.6)":"rgba(100, 116, 139, 0.7)":t?"#fff":e?"#e2e8f0":"#475569",background:n,cursor:r?"not-allowed":"pointer",opacity:r?.6:1,padding:"0 10px",fontFamily:"Raleway, sans-serif"},rootHovered:{background:r?n:t?"#2f7cb3":e?"rgba(148, 163, 184, 0.24)":"rgba(54, 144, 206, 0.12)"},rootPressed:{background:r?n:t?"#266795":e?"rgba(148, 163, 184, 0.3)":"rgba(54, 144, 206, 0.16)"}}},ee=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=t?`linear-gradient(135deg, ${d.M.highlight} 0%, #2f7cb3 100%)`:e?"rgba(15, 23, 42, 0.8)":"transparent";return{root:{borderRadius:999,minHeight:32,height:32,padding:"0 12px",fontWeight:t?700:600,fontSize:12,border:t?`1px solid ${e?"#87ceeb":d.M.highlight}`:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:n,color:t?"#ffffff":e?"#E2E8F0":d.M.missedBlue,boxShadow:t?e?"0 2px 8px rgba(54, 144, 206, 0.3)":"0 2px 8px rgba(54, 144, 206, 0.25)":"none",fontFamily:"Raleway, sans-serif",transform:t?"translateY(-1px)":"none",transition:"all 0.2s ease",opacity:a?1:.55,cursor:a?"pointer":"default"},rootHovered:{background:t?"linear-gradient(135deg, #2f7cb3 0%, #266795 100%)":e?"rgba(15, 23, 42, 0.86)":"rgba(54, 144, 206, 0.1)",transform:a?"translateY(-1px)":"none",boxShadow:a?e?"0 4px 12px rgba(54, 144, 206, 0.4)":"0 4px 12px rgba(54, 144, 206, 0.35)":"none"},rootPressed:{background:t?"linear-gradient(135deg, #266795 0%, #1e5a7a 100%)":e?"rgba(15, 23, 42, 0.9)":"rgba(54, 144, 206, 0.14)",transform:a?"translateY(0)":"none"}}},te=e=>({display:"flex",alignItems:"center",justifyContent:"center",padding:"0 12px",height:32,borderRadius:8,border:"1px solid "+(e?"rgba(239, 68, 68, 0.35)":"rgba(239, 68, 68, 0.25)"),background:e?"rgba(239, 68, 68, 0.12)":"rgba(254, 242, 242, 0.85)",color:e?"#fca5a5":"#dc2626",gap:6,cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Raleway, sans-serif",fontWeight:600,fontSize:13,whiteSpace:"nowrap"}),ae=e=>({display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"center",gap:2,padding:"8px 12px",borderRadius:10,border:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:e?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",color:e?"#E2E8F0":d.M.missedBlue,minWidth:120,cursor:"pointer",transition:"all 0.2s ease"}),ne=e=>({display:"flex",flexDirection:"column",gap:16,background:e?d.M.dark.background:d.M.light.background,padding:"18px 22px",minHeight:"100%"}),re=function(e){return{background:e?"rgba(15, 23, 42, 0.88)":"#FFFFFF",borderRadius:12,border:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(15, 23, 42, 0.06)"),boxShadow:e?"0 2px 10px rgba(0, 0, 0, 0.22)":"0 2px 8px rgba(15, 23, 42, 0.06)",padding:16,...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}},ie=e=>{const t=new Date(e.start),a=new Date(e.end);return t.setHours(0,0,0,0),a.setHours(23,59,59,999),{start:t,end:a}},se=[{key:"all",label:"All",get:()=>null},...[{key:"today",label:"Today"},{key:"yesterday",label:"Yesterday"},{key:"week",label:"This Week"},{key:"lastWeek",label:"Last Week"},{key:"month",label:"This Month"},{key:"lastMonth",label:"Last Month"},{key:"last90Days",label:"Last 90 Days"},{key:"quarter",label:"This Quarter"},{key:"yearToDate",label:"Year To Date"},{key:"year",label:"Current Year"}].map(e=>{let{key:t,label:a}=e;return{key:t,label:a,get:()=>ie((e=>{const t=new Date,a=new Date(t),n=new Date(t);switch(e){case"today":a.setHours(0,0,0,0),n.setHours(23,59,59,999);break;case"yesterday":a.setDate(a.getDate()-1),n.setDate(a.getDate()),a.setHours(0,0,0,0),n.setHours(23,59,59,999);break;case"week":a.setDate(t.getDate()-t.getDay()+1),a.setHours(0,0,0,0);break;case"lastWeek":a.setDate(t.getDate()-t.getDay()-6),n.setDate(a.getDate()+6),a.setHours(0,0,0,0),n.setHours(23,59,59,999);break;case"month":a.setDate(1),a.setHours(0,0,0,0);break;case"lastMonth":a.setMonth(a.getMonth()-1,1),a.setHours(0,0,0,0),n.setMonth(a.getMonth()+1,0),n.setHours(23,59,59,999);break;case"last90Days":a.setDate(t.getDate()-89),a.setHours(0,0,0,0);break;case"quarter":{const e=3*Math.floor(t.getMonth()/3);a.setMonth(e,1),a.setHours(0,0,0,0);break}case"yearToDate":{const e=t.getFullYear();t.getMonth()>=3?a.setFullYear(e,3,1):a.setFullYear(e-1,3,1),a.setHours(0,0,0,0);break}case"year":a.setFullYear(t.getFullYear(),0,1),a.setHours(0,0,0,0),n.setFullYear(t.getFullYear(),11,31),n.setHours(23,59,59,999);break;case"custom":return{start:new Date(t),end:new Date(t)};default:return{start:new Date(0),end:n}}return{start:a,end:n}})(t))}})],oe=(e,t,a)=>{if(!e)return!1;const n=e.getTime();return n>=t.getTime()&&n<=a.getTime()};const le=e=>{var t,a,i,s,o,l,g;let{data:x,teamData:m,triggerRefresh:y,lastRefreshTimestamp:b,isFetching:v}=e;const{isDarkMode:j}=(0,c.DP)(),[k,w]=(0,n.useState)("yearToDate"),[M,S]=(0,n.useState)(null),[C,D]=(0,n.useState)(new Set),[T,_]=(0,n.useState)(new Set),[R,W]=(0,n.useState)(!1),[F,z]=(0,n.useState)(!1),[I,$]=(0,n.useState)(null),[L,A]=(0,n.useState)(0);(0,n.useEffect)(()=>{const e=setInterval(()=>{A(e=>e+1)},1e3);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{b&&A(0)},[b]);const B=(0,n.useCallback)(()=>{const e=Math.min(L/900,1);return`rgb(${Math.round(34+25*e)}, ${Math.round(197+-67*e)}, ${Math.round(94+152*e)})`},[L]),E=(0,n.useMemo)(()=>{var e;if("custom"===k)return M&&M.start&&M.end?ie({start:M.start,end:M.end}):null;const t=se.find(e=>e.key===k);return null!==(e=null===t||void 0===t?void 0:t.get())&&void 0!==e?e:null},[k,M]),N="custom"===k,H=null!==(t=null===M||void 0===M?void 0:M.start)&&void 0!==t?t:null,P=null!==(a=null===M||void 0===M?void 0:M.end)&&void 0!==a?a:null,q=null!==(i=null===E||void 0===E?void 0:E.start)&&void 0!==i?i:N?H:null,O=null!==(s=null===E||void 0===E?void 0:E.end)&&void 0!==s?s:N?P:null,le="all"===k?"All time":q?J(q):"Select start",de="all"===k?"Latest":O?J(O):"Select end",ce="custom"===k?"Custom":null!==(o=null===(l=se.find(e=>e.key===k))||void 0===l?void 0:l.label)&&void 0!==o?o:"All",ge=(0,n.useMemo)(()=>E?((e,t)=>{if(!e||!t)return 1;let a=0;const n=new Date(e);n.setHours(0,0,0,0);const r=new Date(t);for(r.setHours(23,59,59,999);n<=r;){const e=n.getDay();0!==e&&6!==e&&a++,n.setDate(n.getDate()+1)}return Math.max(1,a)})(E.start,E.end):void 0,[E]),ue=(0,n.useMemo)(()=>m&&0!==m.length?m.map(e=>{var t,a,n;const r=(e=>{var t;return e?null!==(t=G[e])&&void 0!==t?t:e:""})((e=>e&&(e.Nickname||e["Full Name"]||e.First||e.Last||e.Initials)||"Unknown")(e)),i=(e.Initials||"").trim().toUpperCase()||(e=>{const t=(e||"").trim();if(!t)return"?";let a=[];a=t.includes("@")?(t.split("@")[0]||"").split(/[^a-zA-Z]+/).filter(Boolean):t.split(/\s+/).filter(Boolean);return 0===a.length?"?":((a[0][0]||"")+(a.length>1?a[a.length-1][0]:a[0][1]||"")).toUpperCase()||"?"})(r),s=(e.status||"").toLowerCase();return{initials:i,display:r,role:null===(t=e.Role)||void 0===t?void 0:t.trim(),isActive:"inactive"!==s,email:null===(a=e.Email)||void 0===a?void 0:a.trim(),holidayEntitlement:null!==(n=e.holiday_entitlement)&&void 0!==n?n:25}}).filter(e=>e.initials&&"?"!==e.initials).sort((e,t)=>e.display.localeCompare(t.display)):[],[m]),pe=(0,n.useMemo)(()=>{const e=new Map;return ue.forEach(t=>{e.set(t.initials,t)}),e},[ue]),he=(0,n.useMemo)(()=>(null!==x&&void 0!==x?x:[]).filter(e=>{if(!("booked"===(e.status||"").toLowerCase()))return!1;const t=(e.fe||"").trim().toUpperCase(),a=pe.get(t);if(!a||!a.isActive)return!1;if(T.size>0&&!T.has(t))return!1;if(C.size>0){var n;const e=null===(n=a.role)||void 0===n?void 0:n.trim();if(!e||!C.has(e))return!1}if(E){var r;const t=U(e.start_date),a=null!==(r=U(e.end_date))&&void 0!==r?r:t;if(!t&&!a)return!1;const n=!!t&&oe(t,E.start,E.end),i=!!a&&oe(a,E.start,E.end);if(!n&&!i)return!1}return!0}),[x,E,T,C,pe]),xe=(0,n.useMemo)(()=>{const e=new Map;return he.forEach(t=>{const a=(t.fe||"").trim().toUpperCase();e.has(a)||e.set(a,[]),e.get(a).push(t)}),e},[he]),fe=(0,n.useMemo)(()=>{const e=new Map;return he.forEach(t=>{const a=(t.fe||"").trim().toUpperCase();e.set(a,(e.get(a)||0)+1)}),e},[he]),me=(0,n.useMemo)(()=>he.map(e=>{var t,a,n,r;const i=(e.fe||"").trim().toUpperCase(),s=pe.get(i),o=U(e.start_date),l=null!==(t=U(e.end_date))&&void 0!==t?t:o,d=V(null!==o&&void 0!==o?o:null),c=V(null!==l&&void 0!==l?l:null),g=d&&c?d===c?d:`${d} \u2013 ${c}`:d||c||"Unknown";return{id:null!==(a=e.request_id)&&void 0!==a?a:`${i}-${e.start_date}-${e.end_date}`,initials:i,name:null!==(n=null===s||void 0===s?void 0:s.display)&&void 0!==n?n:i||"Unknown",start:o,end:l,dateLabel:g,daysTaken:null!==(r=e.days_taken)&&void 0!==r?r:0,leaveType:e.leave_type||"Standard",status:e.status||"Unknown",reason:e.reason||""}}).sort((e,t)=>{var a,n,r,i;const s=null!==(a=null===(n=e.start)||void 0===n?void 0:n.getTime())&&void 0!==a?a:0;return(null!==(r=null===(i=t.start)||void 0===i?void 0:i.getTime())&&void 0!==r?r:0)-s}),[he,pe]),ye=(0,n.useMemo)(()=>{const e=new Map;return he.forEach(t=>{var a,n;const r=(t.fe||"").trim().toUpperCase(),i=null===(a=pe.get(r))||void 0===a||null===(n=a.role)||void 0===n?void 0:n.trim();i&&e.set(i,(e.get(i)||0)+1)}),e},[he,pe]),be=(0,n.useMemo)(()=>ue.filter(e=>{if(!e.isActive)return!1;const t=0===T.size||T.has(e.initials),a=0===C.size||e.role&&C.has(e.role);return t&&a}),[ue,T,C]),ve=(0,n.useMemo)(()=>be.map(e=>{var t;const a=null!==(t=xe.get(e.initials))&&void 0!==t?t:[],n=a.filter(e=>"standard"===(e.leave_type||"").toLowerCase()).reduce((e,t)=>e+(t.days_taken||0),0),r=a.filter(e=>"unpaid"===(e.leave_type||"").toLowerCase()).reduce((e,t)=>e+(t.days_taken||0),0),i=Math.max(0,e.holidayEntitlement-n),s=Math.max(0,5-r),o=n+r;return{initials:e.initials,fullName:e.display,entitlement:e.holidayEntitlement,standardTaken:n,standardRemaining:i,unpaidTaken:r,unpaidRemaining:s,totalTaken:o}}),[be,xe]),je=(0,n.useMemo)(()=>ve.reduce((e,t)=>({entitlement:e.entitlement+t.entitlement,standardTaken:e.standardTaken+t.standardTaken,standardRemaining:e.standardRemaining+t.standardRemaining,unpaidTaken:e.unpaidTaken+t.unpaidTaken,unpaidRemaining:e.unpaidRemaining+t.unpaidRemaining,totalTaken:e.totalTaken+t.totalTaken}),{entitlement:0,standardTaken:0,standardRemaining:0,unpaidTaken:0,unpaidRemaining:0,totalTaken:0}),[ve]),ke=(0,n.useMemo)(()=>({total:x.length,booked:x.filter(e=>"booked"===(e.status||"").toLowerCase()).length,uniquePeople:new Set(x.map(e=>(e.fe||"").trim().toUpperCase()).filter(Boolean)).size}),[x]),we=(0,n.useMemo)(()=>(e=>{if(!e)return"Not refreshed yet";const t=Date.now()-e;if(t<6e4)return"Just now";const a=Math.floor(t/6e4);if(a<60)return`${a}m ago`;const n=Math.floor(a/60);if(n<24){const e=a%60;return e?`${n}h ${e}m ago`:`${n}h ago`}const r=Math.floor(n/24);if(r<7)return`${r}d ago`;const i=Math.floor(r/7);if(i<5)return`${i}w ago`;const s=Math.floor(r/30);return s<12?`${s}mo ago`:`${Math.floor(r/365)}y ago`})(b),[b]),Me=(0,n.useMemo)(()=>b?new Date(b):new Date,[b]),Se=(0,n.useCallback)(e=>{S("custom"===e?e=>{if(e&&e.start&&e.end)return e;const{start:t,end:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;const t=e.getFullYear(),a=new Date(e);e.getMonth()<3?a.setFullYear(t-1,3,1):a.setFullYear(t,3,1);const n=new Date(a);return n.setFullYear(a.getFullYear()+1),n.setMonth(2,31),{start:a,end:n}}();return{start:t,end:a}}:null),w(e)},[]),Ce=(0,n.useCallback)(e=>t=>{S(a=>{const n=a?{...a}:{start:null,end:null};return n[e]=t?new Date(t):null,n}),w("custom")},[]),De=(0,n.useCallback)(e=>{const t=e.toUpperCase();_(e=>{const a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a})},[]),Te=(0,n.useCallback)(()=>{_(new Set)},[]),_e=(0,n.useCallback)(e=>{D(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),Re=(0,n.useCallback)(()=>{D(new Set)},[]),We=(0,n.useCallback)(()=>{W(e=>!e)},[]),Fe=(0,n.useCallback)(()=>{z(e=>!e)},[]),ze=(0,n.useCallback)(e=>{$(t=>t===e?null:e)},[]),Ie=(0,n.useCallback)(()=>{y&&!v&&(y(),A(0))},[y,v]),$e=(0,n.useCallback)((e,t)=>{var a;const n=null!==(a=xe.get(e))&&void 0!==a?a:[],r=ue.find(t=>t.initials===e);if(!r)return"";const i=n.filter(e=>"standard"===(e.leave_type||"").toLowerCase()),s=n.filter(e=>"unpaid"===(e.leave_type||"").toLowerCase()),o=i.reduce((e,t)=>e+(t.days_taken||0),0),l=s.reduce((e,t)=>e+(t.days_taken||0),0);switch(t){case"taken":return 0===i.length?"No standard leave taken":`Standard Leave Taken:\n${i.map(e=>{const t=U(e.start_date),a=U(e.end_date),n=t?t.toLocaleDateString("en-GB"):"?";return`\u2022 ${n} - ${a?a.toLocaleDateString("en-GB"):n}: ${e.days_taken} days (${e.reason||"n/a"})`}).join("\n")}`;case"remaining":{const e=Math.max(0,r.holidayEntitlement-o);return`Remaining Leave:\n\u2022 Entitlement: ${r.holidayEntitlement} days\n\u2022 Taken: ${o} days\n\u2022 Remaining: ${e} days`}case"unpaid":return 0===s.length?"No unpaid leave taken":`Unpaid Leave:\n${s.map(e=>{const t=U(e.start_date),a=U(e.end_date),n=t?t.toLocaleDateString("en-GB"):"?";return`\u2022 ${n} - ${a?a.toLocaleDateString("en-GB"):n}: ${e.days_taken} days (${e.reason||"n/a"})`}).join("\n")}\n\u2022 Unpaid cap: 5 days`;case"total":return`Total Leave Taken:\n\u2022 Standard: ${o} days\n\u2022 Unpaid: ${l} days\n\u2022 Total: ${o+l} days`;default:return`${r.display}\n\u2022 Entitlement: ${r.holidayEntitlement} days\n\u2022 Standard taken: ${o} days\n\u2022 Unpaid taken: ${l} days`}},[xe,ue]),Le=(0,n.useMemo)(()=>I?me.filter(e=>e.initials===I):[],[me,I]),Ae=(0,n.useMemo)(()=>[{label:"Rows available",value:ke.total.toLocaleString()},{label:"Booked requests",value:ke.booked.toLocaleString()},{label:"People with leave",value:ke.uniquePeople.toLocaleString()},{label:"Current range",value:ce},{label:"Filters applied",value:`${C.size} roles \xb7 ${T.size} team`},{label:"Working days",value:ge?ge.toString():"All time"}],[ke,ce,C.size,T.size,ge]);return(0,f.jsxs)("div",{style:ne(j),children:[(0,f.jsx)("div",{style:re(j),children:(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12},children:[N?(0,f.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,f.jsx)(u.l,{label:"From",styles:X(j),value:H||void 0,onSelectDate:Ce("start"),allowTextInput:!0,firstDayOfWeek:p.ob.Monday,formatDate:V,parseDateFromString:K}),(0,f.jsx)(u.l,{label:"To",styles:X(j),value:P||void 0,onSelectDate:Ce("end"),allowTextInput:!0,firstDayOfWeek:p.ob.Monday,formatDate:V,parseDateFromString:K})]}):(0,f.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,f.jsxs)("button",{type:"button",style:ae(j),onClick:()=>Se("custom"),title:"Click to customise the start date",children:[(0,f.jsx)("span",{style:{fontSize:11,opacity:.7,fontWeight:600},children:"From"}),(0,f.jsx)("span",{style:{fontSize:16,fontWeight:700},children:le})]}),(0,f.jsxs)("button",{type:"button",style:ae(j),onClick:()=>Se("custom"),title:"Click to customise the end date",children:[(0,f.jsx)("span",{style:{fontSize:11,opacity:.7,fontWeight:600},children:"To"}),(0,f.jsx)("span",{style:{fontSize:16,fontWeight:700},children:de})]})]}),(0,f.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,f.jsx)("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:8,border:`1px solid ${v?j?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.25)":B()}`,background:j?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",fontSize:12,fontWeight:600,color:j?"#E2E8F0":d.M.missedBlue,transition:"border-color 1s ease"},title:v?"Refreshing data...":`Next auto-refresh in ${Math.max(0,Math.floor((900-L)/60))}m ${Math.max(0,(900-L)%60)}s`,children:v?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{width:8,height:8,borderRadius:"50%",background:j?"rgba(148, 163, 184, 0.6)":"rgba(13, 47, 96, 0.5)"}}),"Refreshing"]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{width:8,height:8,borderRadius:"50%",background:B(),transition:"background 1s ease"}}),we]})}),y&&(0,f.jsx)("button",{type:"button",onClick:Ie,disabled:v,style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:8,border:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:j?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",color:j?"#E2E8F0":d.M.missedBlue,cursor:v?"default":"pointer",opacity:v?.6:1,transition:"all 0.2s ease"},title:v?"Refreshing data...":"Refresh datasets (auto-refreshes every 15 min)","aria-label":v?"Refreshing data":"Refresh datasets",children:(0,f.jsx)(h.I,{iconName:"Refresh",style:{fontSize:16,animation:v?"spin 1s linear infinite":"none"}})}),(0,f.jsx)("button",{type:"button",onClick:We,style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:8,border:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:j?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",color:R?j?"#60a5fa":d.M.highlight:j?"rgba(148, 163, 184, 0.6)":"rgba(13, 47, 96, 0.5)",cursor:"pointer",transform:R?"translateY(-1px)":"translateY(0)",transition:"all 0.2s ease"},title:R?"Hide role filter":"Show role filter","aria-label":R?"Hide role filter":"Show role filter",children:(0,f.jsx)(h.I,{iconName:"People",style:{fontSize:16}})}),(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("button",{type:"button",onClick:Fe,style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:8,border:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:j?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",color:j?"#60a5fa":d.M.highlight,cursor:"pointer",transform:F?"translateY(-1px)":"translateY(0)",transition:"all 0.2s ease"},title:"Dataset information","aria-label":"Dataset information",children:(0,f.jsx)(h.I,{iconName:"Info",style:{fontSize:16}})}),F&&(0,f.jsxs)("div",{style:{position:"absolute",top:"100%",right:0,marginTop:8,padding:"10px 12px",background:j?"rgba(15, 23, 42, 0.98)":"rgba(255, 255, 255, 0.98)",border:"1px solid "+(j?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.25)"),borderRadius:8,boxShadow:j?"0 8px 16px rgba(0, 0, 0, 0.4)":"0 4px 12px rgba(0, 0, 0, 0.15)",fontSize:11,lineHeight:1.5,width:260,zIndex:1e3,color:j?"#e2e8f0":"#334155",textAlign:"left"},children:[(0,f.jsx)("div",{style:{fontWeight:700,marginBottom:8,fontSize:13,color:j?"#60a5fa":d.M.highlight},children:"Dataset information"}),(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:Ae.map(e=>(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,f.jsxs)("span",{style:{opacity:.75},children:[e.label,":"]}),(0,f.jsx)("span",{style:{fontWeight:600},children:e.value})]},e.label))}),(0,f.jsx)("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid "+(j?"rgba(148, 163, 184, 0.2)":"rgba(148, 163, 184, 0.3)"),fontSize:11,opacity:.7,fontStyle:"italic"},children:"Data is limited to booked annual leave captured in Dynamics."})]})]})]})]}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12,padding:"10px 12px",borderRadius:10,background:j?"rgba(148, 163, 184, 0.08)":"rgba(13, 47, 96, 0.04)",border:"1px solid "+(j?"rgba(148, 163, 184, 0.16)":"rgba(13, 47, 96, 0.08)"),fontSize:12,color:j?"rgba(226, 232, 240, 0.85)":"rgba(13, 47, 96, 0.75)"},children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,opacity:.7},children:"Range"}),(0,f.jsx)("div",{style:{fontSize:14,fontWeight:600},children:ce})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,opacity:.7},children:"Working days"}),(0,f.jsx)("div",{style:{fontSize:14,fontWeight:600},children:ge||"All time"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,opacity:.7},children:"Active filters"}),(0,f.jsx)("div",{style:{fontSize:14,fontWeight:600},children:0===C.size&&0===T.size?"None":`${C.size} roles \xb7 ${T.size} team`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,opacity:.7},children:"Entries in view"}),(0,f.jsx)("div",{style:{fontSize:14,fontWeight:600},children:he.length.toLocaleString()})]})]}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[se.map(e=>{const t=e.key===k;return(0,f.jsx)(r.Y,{text:e.label,onClick:()=>Se(e.key),styles:Q(j,t,!0)},e.key)}),"all"!==k&&(0,f.jsxs)("button",{onClick:()=>Se("all"),style:te(j),title:"Clear date range filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]}),R&&(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[Y.map(e=>{let{key:t,label:a}=e;return(0,f.jsx)(r.Y,{text:a,onClick:()=>_e(t),styles:Z(j,C.has(t),(ye.get(t)||0)>0)},t)}),C.size>0&&(0,f.jsxs)("button",{onClick:Re,style:te(j),title:"Clear role filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]}),(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[ue.filter(e=>e.isActive).map(e=>{const t=fe.get(e.initials)||0,a=T.has(e.initials);return(0,f.jsx)(r.Y,{text:e.initials,onClick:()=>De(e.initials),title:`${e.display}${t?` (${t} entries)`:""}`,styles:ee(j,a,t>0||a)},e.initials)}),T.size>0&&(0,f.jsxs)("button",{onClick:Te,style:te(j),title:"Clear team filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]})]}),!R&&(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[ue.filter(e=>e.isActive).map(e=>{const t=fe.get(e.initials)||0,a=T.has(e.initials);return(0,f.jsx)(r.Y,{text:e.initials,onClick:()=>De(e.initials),styles:ee(j,a,t>0||a),title:`${e.display}${t?` (${t} entries)`:""}`},e.initials)}),T.size>0&&(0,f.jsxs)("button",{onClick:Te,style:te(j),title:"Clear team filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]})]})]})}),(0,f.jsxs)("div",{style:re(j,{padding:0}),children:[(0,f.jsxs)("div",{className:"metrics-table",children:[(0,f.jsxs)("div",{className:"metrics-table-header",children:[(0,f.jsx)("span",{title:"Employee name and overview (click to view details)",children:"Employee"}),(0,f.jsx)("span",{title:"Annual leave entitlement in days",children:"Entitlement"}),(0,f.jsx)("span",{title:"Standard annual leave taken (hover rows for details)",children:"Taken"}),(0,f.jsx)("span",{title:"Standard annual leave remaining",children:"Remaining"}),(0,f.jsx)("span",{title:"Unpaid leave taken (hover rows for details)",children:"Unpaid"}),(0,f.jsx)("span",{title:"Total leave taken (standard + unpaid)",children:"Total"})]}),0===ve.length&&(0,f.jsxs)("div",{className:"metrics-table-row animate-table-row",children:[(0,f.jsx)("span",{children:"No team members selected"}),(0,f.jsx)("span",{children:"0"}),(0,f.jsx)("span",{children:"0"}),(0,f.jsx)("span",{children:"0"}),(0,f.jsx)("span",{children:"0"}),(0,f.jsx)("span",{children:"0"})]}),ve.map((e,t)=>{var a,n;return(0,f.jsxs)("div",{className:"metrics-table-row animate-table-row",style:{animationDelay:`${Math.min(.05*t,.5)}s`,cursor:"pointer",position:"relative"},onClick:()=>ze(e.initials),title:`Click to view detailed leave entries for ${e.fullName}`,children:[(0,f.jsxs)("span",{title:$e(e.initials),style:{display:"flex",alignItems:"center",gap:8},children:[e.fullName,(0,f.jsx)(h.I,{iconName:I===e.initials?"ChevronDown":"ChevronRight",style:{fontSize:12,opacity:.6,transition:"transform 0.2s ease"}})]}),(0,f.jsx)("span",{title:`Annual leave entitlement: ${e.entitlement} days`,children:e.entitlement}),(0,f.jsx)("span",{style:{color:e.standardTaken>e.entitlement?"#dc2626":"inherit"},title:$e(e.initials,"taken"),children:e.standardTaken}),(0,f.jsx)("span",{style:{color:e.standardRemaining<=5?"#f59e0b":"#059669"},title:$e(e.initials,"remaining"),children:e.standardRemaining}),(0,f.jsx)("span",{style:{color:e.unpaidTaken>0?"#dc2626":"inherit"},title:$e(e.initials,"unpaid"),children:e.unpaidTaken}),(0,f.jsx)("span",{style:{fontWeight:600},title:$e(e.initials,"total"),children:e.totalTaken})]},`${e.initials}-${null!==(a=null===q||void 0===q?void 0:q.getTime())&&void 0!==a?a:"na"}-${null!==(n=null===O||void 0===O?void 0:O.getTime())&&void 0!==n?n:"na"}-${t}`)}),(0,f.jsxs)("div",{className:"metrics-table-row animate-table-row",style:{animationDelay:`${Math.min(.05*ve.length,.5)}s`},children:[(0,f.jsx)("span",{title:"Summary totals for all selected team members",children:"Total"}),(0,f.jsx)("span",{title:`Total entitlement: ${je.entitlement} days across ${ve.length} team members`,children:je.entitlement}),(0,f.jsx)("span",{title:`Total standard leave taken: ${je.standardTaken} days`,children:je.standardTaken}),(0,f.jsx)("span",{title:`Total standard leave remaining: ${je.standardRemaining} days`,children:je.standardRemaining}),(0,f.jsx)("span",{title:`Total unpaid leave taken: ${je.unpaidTaken} days`,children:je.unpaidTaken}),(0,f.jsx)("span",{title:`Total leave taken: ${je.totalTaken} days (standard + unpaid)`,children:je.totalTaken})]})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",padding:"8px 12px",fontSize:12,opacity:.7,fontWeight:500},children:["Last refreshed: ",Me.toLocaleDateString("en-GB")," ",Me.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})]})]}),I&&(0,f.jsxs)("div",{style:re(j),children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,f.jsxs)("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:["Leave entries for ",(null===(g=ve.find(e=>e.initials===I))||void 0===g?void 0:g.fullName)||I]}),(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,f.jsxs)("span",{style:{fontSize:12,opacity:.65},children:[Le.length," entries"]}),(0,f.jsx)("button",{onClick:()=>$(null),style:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,border:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:"transparent",color:j?"#E2E8F0":d.M.missedBlue,cursor:"pointer",fontSize:16},title:"Close details",children:"\xd7"})]})]}),0===Le.length?(0,f.jsx)("div",{style:{padding:"16px 20px",borderRadius:8,border:"1px dashed "+(j?"rgba(148, 163, 184, 0.3)":"rgba(13, 47, 96, 0.2)"),color:j?"rgba(226, 232, 240, 0.75)":"rgba(13, 47, 96, 0.7)",fontSize:13},children:"No leave entries found for this user in the current date range and filters."}):(0,f.jsx)("div",{style:{overflowX:"auto"},children:(0,f.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13,minWidth:680},children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{style:{textTransform:"uppercase",letterSpacing:.4,fontSize:11,color:j?"rgba(226, 232, 240, 0.7)":"rgba(15, 23, 42, 0.66)"},children:[(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Dates"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Days"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Type"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Status"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Reason"})]})}),(0,f.jsx)("tbody",{children:Le.map((e,t)=>{const a=t%2===1;return(0,f.jsxs)("tr",{style:{background:a?j?"rgba(148, 163, 184, 0.06)":"rgba(248, 250, 252, 0.8)":"transparent",color:j?"#e2e8f0":"#1f2937"},children:[(0,f.jsx)("td",{style:{padding:"10px 12px"},children:e.dateLabel}),(0,f.jsx)("td",{style:{padding:"10px 12px"},children:e.daysTaken}),(0,f.jsx)("td",{style:{padding:"10px 12px",textTransform:"capitalize"},children:e.leaveType.toLowerCase()}),(0,f.jsx)("td",{style:{padding:"10px 12px"},children:(0,f.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"4px 10px",borderRadius:999,fontSize:11,fontWeight:600,background:"booked"===e.status.toLowerCase()?j?"rgba(16, 185, 129, 0.18)":"rgba(16, 185, 129, 0.16)":j?"rgba(148, 163, 184, 0.14)":"rgba(148, 163, 184, 0.18)",color:"booked"===e.status.toLowerCase()?j?"#34d399":"#047857":j?"#e2e8f0":"#0f172a"},children:e.status})}),(0,f.jsx)("td",{style:{padding:"10px 12px",maxWidth:280,whiteSpace:"normal",lineHeight:1.4},children:e.reason||"\u2014"})]},e.id)})})]})})]}),(0,f.jsxs)("div",{style:re(j),children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,f.jsx)("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"All leave entries in view"}),(0,f.jsxs)("span",{style:{fontSize:12,opacity:.65},children:[me.length," entries"]})]}),0===me.length?(0,f.jsx)("div",{style:{padding:"16px 20px",borderRadius:8,border:"1px dashed "+(j?"rgba(148, 163, 184, 0.3)":"rgba(13, 47, 96, 0.2)"),color:j?"rgba(226, 232, 240, 0.75)":"rgba(13, 47, 96, 0.7)",fontSize:13},children:"No leave entries match the current filters."}):(0,f.jsx)("div",{style:{overflowX:"auto"},children:(0,f.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13,minWidth:680},children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{style:{textTransform:"uppercase",letterSpacing:.4,fontSize:11,color:j?"rgba(226, 232, 240, 0.7)":"rgba(15, 23, 42, 0.66)"},children:[(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Person"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Dates"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Days"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Type"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Status"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid "+(j?"rgba(148, 163, 184, 0.24)":"rgba(203, 213, 225, 0.8)")},children:"Reason"})]})}),(0,f.jsx)("tbody",{children:me.map((e,t)=>{const a=t%2===1;return(0,f.jsxs)("tr",{style:{background:a?j?"rgba(148, 163, 184, 0.06)":"rgba(248, 250, 252, 0.8)":"transparent",color:j?"#e2e8f0":"#1f2937"},children:[(0,f.jsx)("td",{style:{padding:"10px 12px",fontWeight:600},children:(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,f.jsx)("span",{children:e.name}),(0,f.jsx)("span",{style:{fontSize:11,opacity:.6},children:e.initials})]})}),(0,f.jsx)("td",{style:{padding:"10px 12px"},children:e.dateLabel}),(0,f.jsx)("td",{style:{padding:"10px 12px"},children:e.daysTaken}),(0,f.jsx)("td",{style:{padding:"10px 12px",textTransform:"capitalize"},children:e.leaveType.toLowerCase()}),(0,f.jsx)("td",{style:{padding:"10px 12px"},children:(0,f.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"4px 10px",borderRadius:999,fontSize:11,fontWeight:600,background:"booked"===e.status.toLowerCase()?j?"rgba(16, 185, 129, 0.18)":"rgba(16, 185, 129, 0.16)":j?"rgba(148, 163, 184, 0.14)":"rgba(148, 163, 184, 0.18)",color:"booked"===e.status.toLowerCase()?j?"#34d399":"#047857":j?"#e2e8f0":"#0f172a"},children:e.status})}),(0,f.jsx)("td",{style:{padding:"10px 12px",maxWidth:280,whiteSpace:"normal",lineHeight:1.4},children:e.reason||"\u2014"})]},e.id)})})]})})]})]})},de=e=>"string"===typeof e?e:null==e?"":String(e);function ce(e){return de(e).trim().toLowerCase()}function ge(e){var t,a,n,r,i,s,o,l,d,c;const g=null!==e&&void 0!==e?e:{},u=ce(null!==(t=null!==(a=g.Ultimate_Source)&&void 0!==a?a:g.source)&&void 0!==t?t:g.Source),p=(ce(null!==(n=null!==(r=g.Method_of_Contact)&&void 0!==r?r:g.method_of_contact)&&void 0!==n?n:g.moc),de(null!==(i=g.Contact_Referrer)&&void 0!==i?i:g.contact_referrer).trim()),h=de(null!==(s=g.Referring_Company)&&void 0!==s?s:g.referring_company).trim(),x=de(null!==(o=g.Referral_URL)&&void 0!==o?o:g.referral_url).trim(),f=de(null!==(l=g.Campaign)&&void 0!==l?l:g.campaign).trim(),m=de(null!==(d=g.GCLID)&&void 0!==d?d:g.gclid).trim(),y=de(null!==(c=g.Initial_first_call_notes)&&void 0!==c?c:g.notes).trim(),b=["phone call","phone","call in","direct email","web form","website form","online form","chat","chatgpt"].some(e=>u.includes(e)),v=x?function(e){try{const t=new URL(e).searchParams;return{source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,campaign:t.get("utm_campaign")||void 0}}catch{return{}}}(x):{},j=ce(v.medium).includes("cpc")||ce(v.medium).includes("ppc");if(function(e){const t=ce(e);return!!t&&(t.includes("gclid=")||t.length>0)}(m)||"google"===ce(v.source)&&(j||u.includes("paid")||u.includes("ads"))||u.includes("google ads")&&!b||u.includes("paid search")&&!b)return{key:"google_ads",label:"Google Ads",detail:f||v.campaign};const k=x?function(e){try{return new URL(e).hostname.toLowerCase()}catch{return null}}(x):null;return"chatgpt.com"===k||u.includes("searchgpt")||x.includes("utm_source=chatgpt")?{key:"chatgpt",label:"ChatGPT",detail:v.campaign}:"facebook.com"===k||"m.facebook.com"===k||function(e,t){const a=e.toLowerCase(),n=t.toLowerCase();return a.includes("facebook lead id")||n.includes("facebook")}(y,f)||u.includes("facebook")&&!b?{key:"meta_ads",label:"Meta Ads",detail:f}:u.includes("organic search")&&!b||u.includes("google organic")&&!b||"organic"===ce(v.medium)?{key:"organic",label:"Organic search"}:h?{key:"referral_company",label:`Referral: ${h}`,detail:h}:p?{key:"referral_contact",label:"Referral",detail:p}:"operations"===u?{key:"operations",label:"Operations"}:u&&!b?{key:u.replace(/\s+/g,"_"),label:de(g.Ultimate_Source)||de(g.Source)}:{key:"not_recorded",label:"Not Recorded"}}function ue(e){return ge(e).label}function pe(e){return function(e){var t,a,n,r;const i=null!==e&&void 0!==e?e:{},s=ce(null!==(t=null!==(a=i.Method_of_Contact)&&void 0!==a?a:i.method_of_contact)&&void 0!==t?t:i.moc),o=ce(null!==(n=null!==(r=i.Ultimate_Source)&&void 0!==r?r:i.source)&&void 0!==n?n:i.Source);return o.includes("phone call")||o.includes("phone")||"call in"===o?{key:"phone",label:"Phone call"}:o.includes("website form")||o.includes("web form")||o.includes("online form")?{key:"web_form",label:"Website form"}:o.includes("chatgpt")||o.includes("chat")?{key:"chat",label:"Live chat"}:o.includes("email")||"direct email"===s||"email"===s?{key:"email",label:"Email"}:"call in"===s||"phone"===s||"phone call"===s||"telephone"===s?{key:"phone",label:"Phone call"}:"web form"===s||"website form"===s||"online form"===s||"contact form"===s?{key:"web_form",label:"Website form"}:"live chat"===s||"chat"===s||"chatgpt"===s?{key:"chat",label:"Live chat"}:"in-person"===s||"walk-in"===s?{key:"in_person",label:"In-person"}:s?{key:s.replace(/\s+/g,"_"),label:de(i.Method_of_Contact)||de(i.moc)}:{key:"unknown",label:"Unknown"}}(e).label}let he,xe,fe,me,ye,be,ve,je,ke,we;try{const e=a(76531);he=e.LineChart,xe=e.Line,fe=e.XAxis,me=e.YAxis,ye=e.CartesianGrid,be=e.Tooltip,ve=e.Legend,je=e.ResponsiveContainer,ke=e.AreaChart,we=e.Area}catch(Fa){console.warn("Recharts not available, charts will be disabled")}const Me=[{key:"today",label:"Today"},{key:"yesterday",label:"Yesterday"},{key:"week",label:"This Week"},{key:"lastWeek",label:"Last Week"},{key:"month",label:"This Month"},{key:"lastMonth",label:"Last Month"},{key:"last90Days",label:"Last 90 Days"},{key:"quarter",label:"This Quarter"},{key:"yearToDate",label:"Year To Date"},{key:"year",label:"Current Year"}];function Se(e){return{background:e?"rgba(15, 23, 42, 0.88)":"#FFFFFF",borderRadius:12,border:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(15, 23, 42, 0.06)"),boxShadow:e?"0 2px 10px rgba(0, 0, 0, 0.22)":"0 2px 8px rgba(15, 23, 42, 0.06)",padding:16,...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}const Ce=e=>{let{metaMetrics:t,enquiries:a,triggerRefresh:g,lastRefreshTimestamp:h,isFetching:x=!1}=e;const{isDarkMode:m}=(0,c.DP)(),[y,b]=(0,n.useState)(!1),[v,j]=(0,n.useState)("month"),[k,w]=(0,n.useState)(null),[M,S]=(0,n.useState)(0),[C,D]=(0,n.useState)(null),[T,_]=(0,n.useState)(!1),[R,W]=(0,n.useState)(null),[F,z]=(0,n.useState)(!1),[I,$]=(0,n.useState)({}),[L,A]=(0,n.useState)({}),[B,E]=(0,n.useState)(0),[N,H]=(0,n.useState)(!1);(0,n.useEffect)(()=>{const e=setInterval(()=>{S(e=>e+1)},1e3);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{h&&S(0)},[h]);const P=(0,n.useCallback)(e=>{const t=new Date,a=new Date(t),n=new Date(t);switch(e){case"today":n.setHours(0,0,0,0),a.setHours(23,59,59,999);break;case"yesterday":n.setDate(n.getDate()-1),n.setHours(0,0,0,0),a.setDate(a.getDate()-1),a.setHours(23,59,59,999);break;case"week":const e=(n.getDay()+6)%7;n.setDate(n.getDate()-e),n.setHours(0,0,0,0),a.setHours(23,59,59,999);break;case"lastWeek":const t=(n.getDay()+6)%7+7;n.setDate(n.getDate()-t),n.setHours(0,0,0,0),a.setDate(a.getDate()-(a.getDay()+6)%7-1),a.setHours(23,59,59,999);break;case"month":n.setDate(1),n.setHours(0,0,0,0),a.setHours(23,59,59,999);break;case"lastMonth":n.setMonth(n.getMonth()-1,1),n.setHours(0,0,0,0),a.setMonth(a.getMonth(),0),a.setHours(23,59,59,999);break;case"last90Days":n.setDate(n.getDate()-90),n.setHours(0,0,0,0),a.setHours(23,59,59,999);break;case"quarter":const r=Math.floor(n.getMonth()/3);n.setMonth(3*r,1),n.setHours(0,0,0,0),a.setHours(23,59,59,999);break;case"yearToDate":n.setMonth(0,1),n.setHours(0,0,0,0),a.setHours(23,59,59,999);break;case"year":n.setMonth(0,1),n.setHours(0,0,0,0),a.setMonth(11,31),a.setHours(23,59,59,999);break;default:n.setDate(n.getDate()-30),n.setHours(0,0,0,0),a.setHours(23,59,59,999)}return{start:n,end:a}},[]),q=(0,n.useMemo)(()=>{if("custom"===v&&k){if(k.start&&k.end){const e=new Date(k.start),t=new Date(k.end);return e.setHours(0,0,0,0),t.setHours(23,59,59,999),{start:e,end:t}}return null}return"all"===v?null:P(v)},[v,k,P]),O=(0,n.useMemo)(()=>{if(!t)return[];if(!q)return console.log("No range filter - returning all metrics"),t;console.log("Filtering metrics with range:",{rangeKey:v,startDate:q.start.toISOString(),endDate:q.end.toISOString(),totalMetrics:t.length,sampleDates:t.slice(0,3).map(e=>({raw:e.date,parsed:new Date(e.date).toISOString(),type:typeof e.date}))});const e=t.filter((e,t)=>{const a=new Date(e.date),n=a>=q.start&&a<=q.end;return t<3&&console.log(`Metric ${t}:`,{rawDate:e.date,parsedDate:a.toISOString(),rangeStart:q.start.toISOString(),rangeEnd:q.end.toISOString(),isInRange:n,comparison:{afterStart:a>=q.start,beforeEnd:a<=q.end}}),n});return console.log("Filter complete:",{originalCount:t.length,filteredCount:e.length,filteredDates:e.slice(0,3).map(e=>new Date(e.date).toLocaleDateString())}),e},[t,q,v]),Y=(0,n.useMemo)(()=>{if(!O.length)return{totalSpend:0,totalReach:0,totalImpressions:0,totalClicks:0,totalConversions:0,avgCtr:0,avgCpc:0,avgCpm:0,avgFrequency:0,costPerConversion:0,conversionRate:0,reachRate:0,impressionShare:0};const e=O.reduce((e,t)=>{const a=t.metaAds;return a?{spend:e.spend+a.spend,reach:e.reach+a.reach,impressions:e.impressions+a.impressions,clicks:e.clicks+a.clicks,conversions:e.conversions+a.conversions,ctrSum:e.ctrSum+a.ctr,cpcSum:e.cpcSum+a.cpc,cpmSum:e.cpmSum+a.cpm,frequencySum:e.frequencySum+a.frequency,days:e.days+1}:e},{spend:0,reach:0,impressions:0,clicks:0,conversions:0,ctrSum:0,cpcSum:0,cpmSum:0,frequencySum:0,days:0}),t=e.days>0?e.ctrSum/e.days:0,a=e.days>0?e.cpcSum/e.days:0,n=e.days>0?e.cpmSum/e.days:0,r=e.days>0?e.frequencySum/e.days:0,i=e.conversions>0?e.spend/e.conversions:0,s=e.clicks>0?e.conversions/e.clicks*100:0,o=e.impressions>0?e.reach/e.impressions*100:0;return{totalSpend:e.spend,totalReach:e.reach,totalImpressions:e.impressions,totalClicks:e.clicks,totalConversions:e.conversions,avgCtr:t,avgCpc:a,avgCpm:n,avgFrequency:r,costPerConversion:i,conversionRate:s,reachRate:o,impressionShare:85.2}},[O]),G=(0,n.useCallback)(e=>{var t,a,n;if(null===R||void 0===R||!R.deals)return window.noDealDataLogged||(console.log("\u26a0\ufe0f No instruction data available for pitch matching"),window.noDealDataLogged=!0),{isPitched:!1,pitchDate:null};window.noDealDataLogged=!1,!window.dealStructureLogged&&R.deals.length>0&&(console.log("\ud83d\udccb Sample deal structure:",R.deals[0]),console.log("\ud83d\udccb All available fields in first deal:",Object.keys(R.deals[0])),console.log("\ud83d\udccb Date-related fields:",Object.keys(R.deals[0]).filter(e=>e.toLowerCase().includes("date")||e.toLowerCase().includes("created")||e.toLowerCase().includes("time"))),window.dealStructureLogged=!0);const r=null===(t=e.Email)||void 0===t?void 0:t.toLowerCase().trim(),i=null===(a=e.First_Name)||void 0===a?void 0:a.toLowerCase().trim(),s=null===(n=e.Last_Name)||void 0===n?void 0:n.toLowerCase().trim();if(!r&&(!i||!s))return{isPitched:!1,pitchDate:null};const o=R.deals.find(e=>{var t;if(r&&(null===(t=e.LeadClientEmail)||void 0===t?void 0:t.toLowerCase().trim())===r)return!0;if(i&&s){var a,n;const t=null===(a=e.FirstName)||void 0===a?void 0:a.toLowerCase().trim(),r=null===(n=e.LastName)||void 0===n?void 0:n.toLowerCase().trim();if(t===i&&r===s)return!0}return!1});if(!o)return{isPitched:!1,pitchDate:null};return{isPitched:!0,pitchDate:o.PitchedDate||null}},[R]),U=(0,n.useCallback)(e=>{var t,a,n,r;if(null===R||void 0===R||!R.instructions)return{hasInstruction:!1,instructionRef:null,isProofOfIdComplete:!1};const i=null===(t=e.Email)||void 0===t?void 0:t.toLowerCase().trim(),s=null===(a=e.First_Name)||void 0===a?void 0:a.toLowerCase().trim(),o=null===(n=e.Last_Name)||void 0===n?void 0:n.toLowerCase().trim();if(!i&&(!s||!o))return{hasInstruction:!1,instructionRef:null,isProofOfIdComplete:!1};const l=null===(r=R.deals)||void 0===r?void 0:r.find(e=>{var t;if(i&&(null===(t=e.LeadClientEmail)||void 0===t?void 0:t.toLowerCase().trim())===i)return!0;if(s&&o){var a,n;const t=null===(a=e.FirstName)||void 0===a?void 0:a.toLowerCase().trim(),r=null===(n=e.LastName)||void 0===n?void 0:n.toLowerCase().trim();if(t===s&&r===o)return!0}return!1});if(("Mohammad"===e.First_Name&&"Khawaja"===e.Last_Name||"Amanda"===e.First_Name&&"Townsend"===e.Last_Name)&&console.log(`Instruction debug for ${e.First_Name} ${e.Last_Name}:`,{email:i,hasDeal:!!l,dealData:l?{InstructionRef:l.InstructionRef,LeadClientEmail:l.LeadClientEmail,FirstName:l.FirstName,LastName:l.LastName}:null}),!l||!l.InstructionRef)return{hasInstruction:!1,instructionRef:null,isProofOfIdComplete:!1};const d=l.InstructionRef,c=R.instructions.find(e=>e.ref===d||e.InstructionRef===d);if(!c)return{hasInstruction:!1,instructionRef:d,isProofOfIdComplete:!1};const g=(c.Stage||c.stage||"").toLowerCase(),u=(c.InternalStatus||c.internalStatus||"").toLowerCase(),p="paid"===u,h="proof-of-id-complete"===g&&"poid"===u;return("Mohammad"===e.First_Name&&"Khawaja"===e.Last_Name||"Amanda"===e.First_Name&&"Townsend"===e.Last_Name)&&console.log(`Instruction status for ${e.First_Name} ${e.Last_Name}:`,{instructionRef:d,stage:g,internalStatus:u,isInstructed:p,isProofOfIdComplete:h,instructionData:c}),{hasInstruction:p,instructionRef:d,isProofOfIdComplete:h&&!p}},[R]),V=e=>{if(e.Value&&""!==e.Value.trim())return e.Value;const t=(e.Initial_first_call_notes||"").match(/Value Band Or Qualifier:\s*([^,\n]+)/i);if(t){const e=t[1].trim();switch(e.toLowerCase()){case"<10k":case"less than 10k":return"Less than \xa310,000";case"10k-50k":case"10-50k":return"\xa310,000 to \xa350,000";case"50k-100k":case"50-100k":return"\xa350,000 to \xa3100,000";case"100k-500k":case"100-500k":return"\xa3100,001 - \xa3500,000";case">500k":case"more than 500k":return"\xa3500,001 or more";case"unsure":case"uncertain":return"unsure";case"other":case"non-monetary":return"The claim is for something other than money";default:return e}}return""},K=(0,n.useMemo)(()=>{if(!a)return{totalEnquiries:0,enquiriesInPeriod:0,totalValue:0,averageValue:0,roi:0,costPerEnquiry:0,pitchedCount:0,instructedCount:0,pitchConversionRate:0,instructionConversionRate:0,pitchToInstructionRate:0,enquiries:[]};var e,t,n,r,i;!window.instructionDataLogged&&R&&(console.log("\ud83d\udccb Instruction data summary:",{totalInstructions:(null===(e=R.instructions)||void 0===e?void 0:e.length)||0,totalDeals:(null===(t=R.deals)||void 0===t?void 0:t.length)||0,sampleInstruction:null===(n=R.instructions)||void 0===n?void 0:n[0],sampleDeal:null===(r=R.deals)||void 0===r?void 0:r[0],instructionStages:null===(i=R.instructions)||void 0===i?void 0:i.slice(0,10).map(e=>({ref:e.ref||e.InstructionRef,stage:e.Stage||e.stage,internalStatus:e.InternalStatus||e.internalStatus}))}),window.instructionDataLogged=!0);if(!window.metaSourcesLogged){const e=a.map(e=>({name:`${e.First_Name} ${e.Last_Name}`,Ultimate_Source:e.Ultimate_Source,normalizedSource:ue(e),Method_of_Contact:e.Method_of_Contact,Referral_URL:e.Referral_URL})).filter(e=>"Meta Ads"===e.normalizedSource).slice(0,10);console.log("Enquiries classified as Meta Ads:",e),window.metaSourcesLogged=!0}const s=a.filter(e=>{const t=ue(e),a="Meta Ads"===t;if("Mohammad"===e.First_Name&&"Khawaja"===e.Last_Name&&console.log("Mohammad Khawaja debug:",{Ultimate_Source:e.Ultimate_Source,normalizedSource:t,isMetaSource:a,enquiry:e}),!a)return!1;if(q){const t=new Date(e.Date_Created||e.Touchpoint_Date);return t>=q.start&&t<=q.end}return!0});s.length>0&&!window.metaEnquiriesLogged&&(console.log("\ufffd Meta enquiries found:",s.length),console.log("\ud83d\udccb Sample Meta enquiry fields:",Object.keys(s[0])),window.metaEnquiriesLogged=!0);const o=s.length;if(o>0&&null!==R&&void 0!==R&&R.deals&&!window.pitchSummaryLogged){const e=s.filter(e=>G(e).isPitched).length,t=s.filter(e=>U(e).hasInstruction).length;console.log(`\ud83d\udcc8 Conversion Summary: ${e}/${o} pitched, ${t}/${o} instructed`),window.pitchSummaryLogged=!0}else!(o>0)||null!==R&&void 0!==R&&R.deals||window.noPitchDataLogged||(console.log("\u26a0\ufe0f Cannot calculate conversion summary - no instruction data available"),window.noPitchDataLogged=!0);const l=o>0&&null!==R&&void 0!==R&&R.deals?s.filter(e=>G(e).isPitched).length:0,d=o>0&&null!==R&&void 0!==R&&R.deals?s.filter(e=>U(e).hasInstruction).length:0,c=o>0?l/o*100:0,g=o>0?d/o*100:0,u=l>0?d/l*100:0,p=s.reduce((e,t)=>e+(e=>{if(!e||"string"!==typeof e)return 0;const t=e.toLowerCase().trim();switch(t){case"less than \xa310,000":case"\xa310,000 or less":case"a financial sum below \xa310,000":case"5000":return 5e3;case"\xa310,000 to \xa350,000":case"\xa310,000 - \xa350,000":case"\xa325,000 to \xa350,000":return 3e4;case"\xa310,001 - \xa3100,000":case"a financial sum between \xa310,000 - \xa3100,000":return 55e3;case"\xa350,000 to \xa3100,000":case"\xa350,000 or more":return 75e3;case"\xa3100,001 - \xa3500,000":case"a financial sum between \xa3100,001 - \xa3500,000":return 3e5;case"greater than \xa3100,000":return 25e4;case"\xa3500,001 or more":case"a financial sum over \xa3500,001":return 75e4;case"\xa31000":return 1e3;case"unsure":case"uncertain":case"i'm uncertain/other":case"unable to establish":case"other":case"not applicable":case"the claim is for something other than money":case"dispute involves a property, land or shares":case"test item":case"":return 0;default:const a=t.match(/\xa3?([\d,]+)/);if(a){const e=parseFloat(a[1].replace(/,/g,""));return isNaN(e)?0:e}return console.log("Unmapped value band:",e),0}})(V(t)),0),h=o>0?p/o:0,x=Y.totalSpend>0&&o>0?Y.totalSpend/o:0;return{totalEnquiries:o,enquiriesInPeriod:o,totalValue:p,averageValue:h,roi:Y.totalSpend>0?(p-Y.totalSpend)/Y.totalSpend*100:0,costPerEnquiry:x,pitchedCount:l,instructedCount:d,pitchConversionRate:c,instructionConversionRate:g,pitchToInstructionRate:u,enquiries:s}},[a,q,Y.totalSpend]),J=(0,n.useMemo)(()=>O.map(e=>{var t,a,n,r,i,s,o,l;return{date:new Date(e.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}),spend:(null===(t=e.metaAds)||void 0===t?void 0:t.spend)||0,reach:(null===(a=e.metaAds)||void 0===a?void 0:a.reach)||0,impressions:(null===(n=e.metaAds)||void 0===n?void 0:n.impressions)||0,clicks:(null===(r=e.metaAds)||void 0===r?void 0:r.clicks)||0,conversions:(null===(i=e.metaAds)||void 0===i?void 0:i.conversions)||0,ctr:(null===(s=e.metaAds)||void 0===s?void 0:s.ctr)||0,cpc:(null===(o=e.metaAds)||void 0===o?void 0:o.cpc)||0,cpm:(null===(l=e.metaAds)||void 0===l?void 0:l.cpm)||0}}),[O]),X=(0,n.useCallback)(async()=>{_(!0);try{const e=await fetch("/api/marketing-metrics/ads?daysBack=7");if(e.ok){const t=await e.json();t.success&&(D(t.data),console.log("Ad data loaded:",t.data.length,"ads"))}}catch(Fa){console.error("Failed to fetch ad data:",Fa)}finally{_(!1)}},[]),Q=(0,n.useCallback)(async()=>{z(!0);try{const t=await fetch("/api/instructions");if(t.ok){var e;const a=await t.json();W({instructions:a.instructions||[],deals:a.deals||[]}),console.log("\u2705 Instruction data loaded:",(null===(e=a.deals)||void 0===e?void 0:e.length)||0,"deals for pitch matching")}else console.error("\u274c Failed to fetch instruction data:",t.status,t.statusText)}catch(Fa){console.error("\u274c Error fetching instruction data:",Fa)}finally{z(!1)}},[]),Z=(0,n.useCallback)(async e=>{if(0===e.length)return;const t=Date.now();if(t-B<5e3)return void console.log(`\u23f3 Clio search rate limited. Last search was ${Math.round((t-B)/1e3)}s ago`);const a=e.filter(e=>{const a=L[e];if(!a)return!0;return t-a.timestamp>6e5?(console.log(`\ud83d\uddd1\ufe0f Cache expired for ${e} (${Math.round((t-a.timestamp)/1e3/60)} mins old)`),!0):(console.log(`\ud83d\udcbe Using cached result for ${e}`),$(t=>({...t,[e]:a.result})),!1)});if(0!==a.length){console.log(`\ud83d\udce7 Searching Clio for ${a.length}/${e.length} emails (${e.length-a.length} cached)`),H(!0),E(t);try{const e=await fetch("/api/search-clio-contacts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emails:a})});if(e.ok){const a=await e.json();if(a.success){const e=a.results,n={};Object.entries(e).forEach(e=>{let[a,r]=e;n[a]={result:r,timestamp:t}}),$(t=>({...t,...e})),A(e=>({...e,...n})),console.log(`\ud83d\udd0d Clio search completed: ${a.summary.totalFound}/${a.summary.totalSearched} contacts found, cached for 10 minutes`)}else console.error("\u274c Clio search failed:",a.error)}else console.error("\u274c Failed to search Clio contacts:",e.status,e.statusText)}catch(Fa){console.error("\u274c Error searching Clio contacts:",Fa)}finally{H(!1)}}else console.log(`\ud83d\udce7 All ${e.length} emails already cached - no Clio API calls needed`)},[L,B]),ee=(0,n.useCallback)(()=>{if(console.log("\ud83d\uddd1\ufe0f Clearing Clio cache and forcing refresh"),A({}),$({}),E(0),null!==K&&void 0!==K&&K.enquiries&&K.enquiries.length>0){const e=Array.from(new Set(K.enquiries.map(e=>e.Email).filter(e=>e&&""!==e.trim())));e.length>0&&(console.log(`\ud83d\udce7 Re-starting fresh Clio contact search for ${e.length} unique email addresses`),Z(e))}},[null===K||void 0===K?void 0:K.enquiries,Z]);(0,n.useEffect)(()=>{X(),Q()},[X,Q]),(0,n.useEffect)(()=>{if(null!==K&&void 0!==K&&K.enquiries&&K.enquiries.length>0){const e=Array.from(new Set(K.enquiries.map(e=>e.Email).filter(e=>e&&""!==e.trim())));e.length>0&&(console.log(`\ud83d\udce7 Starting Clio contact search for ${e.length} unique email addresses`),Z(e))}},[null===K||void 0===K?void 0:K.enquiries,Z]);const te=(0,n.useCallback)(async()=>{if(g&&!y){b(!0);try{await Promise.all([g(),X(),Q()])}finally{b(!1)}}},[g,y,X,Q]),ae=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),ne=e=>new Intl.NumberFormat("en-GB").format(e),re=e=>`${e.toFixed(2)}%`,ie=e=>({root:{maxWidth:220},textField:{root:{fontFamily:"Raleway, sans-serif !important",width:"100% !important"},fieldGroup:{height:"36px !important",borderRadius:"8px !important",border:`1px solid ${e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.18)"} !important`,background:(e?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.95)")+" !important",padding:"0 14px !important"},field:{fontSize:"14px !important",fontFamily:"Raleway, sans-serif !important",fontWeight:"500 !important"}}}),se=(e,t)=>({root:{borderRadius:999,border:t?"1px solid "+(e?"rgba(135, 176, 255, 0.5)":"rgba(13, 47, 96, 0.32)"):"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),padding:"0 12px",minHeight:32,height:32,fontWeight:600,fontSize:13,color:t?"#ffffff":e?"#E2E8F0":d.M.missedBlue,background:t?d.M.highlight:e?"rgba(148, 163, 184, 0.16)":"transparent",fontFamily:"Raleway, sans-serif",transition:"all 0.2s ease"},rootHovered:{background:t?"#2f7cb3":e?"rgba(148, 163, 184, 0.24)":"rgba(54, 144, 206, 0.12)"}}),oe={padding:"24px",backgroundColor:m?d.M.dark.background:d.M.light.background,minHeight:"100vh",color:m?d.M.dark.text:d.M.light.text,fontFamily:"Raleway, sans-serif"},le={color:m?d.M.dark.text:d.M.light.text,fontSize:"28px",fontWeight:700,marginBottom:"8px",fontFamily:"Raleway, sans-serif"},de={color:m?d.M.dark.subText:d.M.light.subText,fontSize:"16px",margin:0,fontFamily:"Raleway, sans-serif"},ce={color:m?d.M.dark.text:d.M.light.text,fontSize:"20px",fontWeight:600,marginBottom:"16px",fontFamily:"Raleway, sans-serif"};return(0,f.jsxs)("div",{style:oe,children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"16px",flexWrap:"wrap",gap:"16px"},children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h1",{style:{...le,marginBottom:"4px"},children:"Meta Analytics"}),(0,f.jsx)("p",{style:{...de,margin:0},children:"Facebook advertising performance insights"})]}),(0,f.jsxs)("div",{style:{display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:[h&&(0,f.jsx)("div",{style:{fontSize:"12px",color:m?d.M.dark.subText:d.M.light.subText,textAlign:"right",fontFamily:"Raleway, sans-serif"},children:(0,f.jsxs)("div",{children:["Updated ",new Date(h).toLocaleTimeString()]})}),(0,f.jsx)(i.j,{text:y?"Refreshing...":"Refresh",onClick:te,disabled:y||x,iconProps:y?void 0:{iconName:"Refresh"},styles:{root:{backgroundColor:d.M.cta,borderColor:d.M.cta,fontFamily:"Raleway, sans-serif"}}})]})]}),(0,f.jsx)("div",{style:Se(m),children:(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12},children:["custom"===v&&k?(0,f.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,f.jsx)(u.l,{placeholder:"Start date",value:(null===k||void 0===k?void 0:k.start)||void 0,onSelectDate:e=>w(t=>({start:e||null,end:(null===t||void 0===t?void 0:t.end)||null})),firstDayOfWeek:p.ob.Monday,styles:ie(m)}),(0,f.jsx)(u.l,{placeholder:"End date",value:(null===k||void 0===k?void 0:k.end)||void 0,onSelectDate:e=>w(t=>({start:(null===t||void 0===t?void 0:t.start)||null,end:e||null})),firstDayOfWeek:p.ob.Monday,styles:ie(m)})]}):(0,f.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,f.jsxs)("div",{style:{padding:"8px 12px",borderRadius:8,background:m?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",border:"1px solid "+(m?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.18)"),display:"flex",flexDirection:"column",gap:2,cursor:"pointer"},onClick:()=>j("custom"),title:"Click to set custom date range",children:[(0,f.jsx)("span",{style:{fontSize:11,opacity:.7,fontWeight:600},children:"From"}),(0,f.jsx)("span",{style:{fontSize:16,fontWeight:700},children:q?q.start.toLocaleDateString():"All time"})]}),(0,f.jsxs)("div",{style:{padding:"8px 12px",borderRadius:8,background:m?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",border:"1px solid "+(m?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.18)"),display:"flex",flexDirection:"column",gap:2,cursor:"pointer"},onClick:()=>j("custom"),title:"Click to set custom date range",children:[(0,f.jsx)("span",{style:{fontSize:11,opacity:.7,fontWeight:600},children:"To"}),(0,f.jsx)("span",{style:{fontSize:16,fontWeight:700},children:q?q.end.toLocaleDateString():"All time"})]})]}),(0,f.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:(0,f.jsx)("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:8,border:"1px solid "+(x?m?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.25)":m?"rgba(34, 197, 94, 0.3)":"rgba(34, 197, 94, 0.25)"),background:m?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",fontSize:12,fontWeight:600,color:m?"#E2E8F0":d.M.missedBlue},children:x?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(s.y,{size:o.H.xSmall}),"Refreshing..."]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{width:8,height:8,borderRadius:"50%",backgroundColor:"#22c55e"}}),"Live data"]})})})]}),t&&t.length>0&&(0,f.jsxs)("div",{style:{padding:"8px 12px",borderRadius:8,background:m?"rgba(148, 163, 184, 0.08)":"rgba(13, 47, 96, 0.04)",border:"1px solid "+(m?"rgba(148, 163, 184, 0.16)":"rgba(13, 47, 96, 0.08)"),fontSize:12,color:m?"rgba(226, 232, 240, 0.85)":"rgba(13, 47, 96, 0.75)",display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,f.jsxs)("span",{children:["Available data: ",new Date(Math.min(...t.map(e=>new Date(e.date).getTime()))).toLocaleDateString()," to ",new Date(Math.max(...t.map(e=>new Date(e.date).getTime()))).toLocaleDateString(),"(",t.length.toLocaleString()," total records)"]}),(0,f.jsxs)("span",{children:["Showing ",O.length.toLocaleString()," filtered"]})]}),(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[Me.map(e=>(0,f.jsx)(r.Y,{text:e.label,onClick:()=>j(e.key),styles:se(m,v===e.key)},e.key)),(0,f.jsx)(r.Y,{text:"Custom",onClick:()=>j("custom"),styles:se(m,"custom"===v)}),(0,f.jsx)(r.Y,{text:"All Time",onClick:()=>j("all"),styles:se(m,"all"===v)}),"all"!==v&&(0,f.jsxs)("button",{onClick:()=>j("all"),style:{marginLeft:8,padding:"4px 8px",backgroundColor:"transparent",border:`1px solid ${m?d.M.accent:d.M.highlight}`,borderRadius:"4px",color:m?d.M.accent:d.M.highlight,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",gap:4},title:"Clear date range filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]})]})}),x&&(0,f.jsxs)("div",{style:Se(m,{textAlign:"center",padding:"60px",marginTop:"16px"}),children:[(0,f.jsx)(s.y,{size:o.H.large}),(0,f.jsx)("p",{style:{marginTop:"20px",fontSize:"16px"},children:"Loading Meta marketing analytics..."})]}),!x&&(!t||0===t.length||0===O.length)&&(0,f.jsxs)("div",{style:Se(m,{textAlign:"center",padding:"60px",marginTop:"16px"}),children:[(0,f.jsx)(l.l8,{iconName:"BarChart4",style:{fontSize:"64px",color:m?d.M.dark.subText:d.M.light.subText,marginBottom:"20px"}}),(0,f.jsx)("h3",{style:{color:m?d.M.dark.text:d.M.light.text,marginBottom:"12px",fontSize:"24px"},children:t&&0!==t.length?"No data for selected period":"No Meta metrics available"}),(0,f.jsx)("p",{style:{color:m?d.M.dark.subText:d.M.light.subText,margin:0,fontSize:"16px"},children:t&&0!==t.length?"Try selecting a different time range to view data.":"Meta marketing data will appear here once available."})]}),!x&&O.length>0&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{style:Se(m,{marginTop:"16px"}),children:[(0,f.jsx)("h3",{style:ce,children:"Key Metrics"}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px",marginBottom:"32px"},children:[(0,f.jsxs)("div",{style:{padding:"20px",backgroundColor:m?"rgba(15, 23, 42, 0.7)":"rgba(248, 250, 252, 0.8)",borderRadius:"12px",border:"1px solid "+(m?"rgba(148, 163, 184, 0.24)":"rgba(15, 23, 42, 0.06)")},children:[(0,f.jsx)("div",{style:{fontSize:"36px",fontWeight:700,color:d.M.accent,marginBottom:"8px"},children:ae(Y.totalSpend)}),(0,f.jsx)("div",{style:{fontSize:"14px",color:"#ffffff"},children:"Total Investment"})]}),(0,f.jsxs)("div",{style:{padding:"20px",backgroundColor:m?"rgba(15, 23, 42, 0.7)":"rgba(248, 250, 252, 0.8)",borderRadius:"12px",border:"1px solid "+(m?"rgba(148, 163, 184, 0.24)":"rgba(15, 23, 42, 0.06)")},children:[(0,f.jsx)("div",{style:{fontSize:"36px",fontWeight:700,color:d.M.accent,marginBottom:"8px"},children:ne(Y.totalReach)}),(0,f.jsx)("div",{style:{fontSize:"14px",color:"#ffffff"},children:"People Reached"})]}),(0,f.jsxs)("div",{style:{padding:"20px",backgroundColor:m?"rgba(15, 23, 42, 0.7)":"rgba(248, 250, 252, 0.8)",borderRadius:"12px",border:"1px solid "+(m?"rgba(148, 163, 184, 0.24)":"rgba(15, 23, 42, 0.06)")},children:[(0,f.jsx)("div",{style:{fontSize:"36px",fontWeight:700,color:d.M.accent,marginBottom:"8px"},children:ne(Y.totalConversions)}),(0,f.jsx)("div",{style:{fontSize:"14px",color:"#ffffff"},children:"Total Conversions"})]}),(0,f.jsxs)("div",{style:{padding:"20px",backgroundColor:m?"rgba(15, 23, 42, 0.7)":"rgba(248, 250, 252, 0.8)",borderRadius:"12px",border:"1px solid "+(m?"rgba(148, 163, 184, 0.24)":"rgba(15, 23, 42, 0.06)")},children:[(0,f.jsx)("div",{style:{fontSize:"36px",fontWeight:700,color:d.M.accent,marginBottom:"8px"},children:ae(Y.costPerConversion)}),(0,f.jsx)("div",{style:{fontSize:"14px",color:"#ffffff"},children:"Cost Per Conversion"})]})]})]}),(0,f.jsxs)("div",{style:Se(m,{marginTop:"16px"}),children:[(0,f.jsx)("h3",{style:ce,children:"Performance Summary"}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px",marginBottom:"20px"},children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{style:{color:m?d.M.dark.text:d.M.light.text,marginBottom:"12px",fontSize:"16px"},children:"Campaign Efficiency"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Click-Through Rate:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:re(Y.avgCtr)})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Cost Per Click:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:ae(Y.avgCpc)})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Conversion Rate:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:re(Y.conversionRate)})]})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{style:{color:m?d.M.dark.text:d.M.light.text,marginBottom:"12px",fontSize:"16px"},children:"Reach & Frequency"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Total Impressions:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:ne(Y.totalImpressions)})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Unique Reach:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:ne(Y.totalReach)})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Average Frequency:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:Y.avgFrequency.toFixed(2)})]})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{style:{color:m?d.M.dark.text:d.M.light.text,marginBottom:"12px",fontSize:"16px"},children:"ROI Analysis"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Total Clicks:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:ne(Y.totalClicks)})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Cost Per Conversion:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:ae(Y.costPerConversion)})]})]})]})]})]}),(0,f.jsxs)("div",{style:Se(m,{marginTop:"16px"}),children:[(0,f.jsx)("h3",{style:ce,children:"ROI & Enquiries Analysis"}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"20px",marginBottom:"20px"},children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{style:{color:m?d.M.dark.text:d.M.light.text,marginBottom:"12px",fontSize:"16px"},children:"Meta Enquiries"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Total Enquiries:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:K.totalEnquiries})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Cost Per Enquiry:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:K.costPerEnquiry>0?ae(K.costPerEnquiry):"\u2014"})]})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{style:{color:m?d.M.dark.text:d.M.light.text,marginBottom:"12px",fontSize:"16px"},children:"Return on Investment"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Total Value (est.):"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:K.totalValue>0?ae(K.totalValue):"\u2014"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"ROI:"}),(0,f.jsx)("strong",{style:{color:K.roi>0?d.M.accent:d.M.cta},children:K.totalValue>0?`${K.roi.toFixed(1)}%`:"\u2014"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Revenue Ratio:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:K.totalValue>0&&Y.totalSpend>0?`${(K.totalValue/Y.totalSpend).toFixed(2)}:1`:"\u2014"})]})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{style:{color:m?d.M.dark.text:d.M.light.text,marginBottom:"12px",fontSize:"16px"},children:"Conversion Funnel"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Ad Impressions:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:ne(Y.totalImpressions)})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Ad Clicks:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:ne(Y.totalClicks)})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Enquiries:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:K.totalEnquiries})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{children:"Click-to-Enquiry:"}),(0,f.jsx)("strong",{style:{color:d.M.accent},children:Y.totalClicks>0&&K.totalEnquiries>0?`${(K.totalEnquiries/Y.totalClicks*100).toFixed(2)}%`:"\u2014"})]})]})]})]}),K.enquiries.length>0&&(0,f.jsxs)("div",{style:{marginTop:"24px"},children:[(0,f.jsxs)("h4",{style:{color:m?d.M.dark.text:d.M.light.text,marginBottom:"12px",fontSize:"16px"},children:["Recent Meta Enquiries (",K.enquiries.length,")"]}),Object.keys(I).length>0&&(0,f.jsxs)("div",{style:{fontSize:"12px",marginBottom:"8px",padding:"8px",backgroundColor:m?"rgba(59, 130, 246, 0.1)":"rgba(59, 130, 246, 0.05)",borderRadius:"4px",border:"1px solid rgba(59, 130, 246, 0.2)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("span",{style:{color:d.M.accent,fontWeight:600},children:"\ud83d\udd0d Clio Validation: "}),(()=>{const e=Object.keys(I).length,t=Object.values(I).filter(e=>null!==e).length,a=Object.values(I).filter(e=>e&&e.matters&&e.matters.length>0).length,n=Object.keys(L).length;return`${t}/${e} contacts found, ${a} with matters${n>0?` (${n} cached)`:""}`})(),N&&(0,f.jsx)("span",{style:{opacity:.7},children:" (searching...)"})]}),(0,f.jsx)("button",{onClick:ee,disabled:N,style:{padding:"4px 8px",fontSize:"10px",backgroundColor:"transparent",border:"1px solid rgba(59, 130, 246, 0.4)",borderRadius:"3px",color:d.M.accent,cursor:N?"not-allowed":"pointer",opacity:N?.5:1},title:"Clear cache and refresh Clio search results",children:"\ud83d\udd04 Refresh"})]}),(0,f.jsxs)("div",{style:{maxHeight:"400px",overflowY:"auto",border:"1px solid "+(m?"rgba(148, 163, 184, 0.12)":"rgba(15, 23, 42, 0.08)"),borderRadius:"8px"},children:[(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 1fr",gap:"12px",padding:"12px",backgroundColor:m?"rgba(15, 23, 42, 0.6)":"rgba(248, 250, 252, 0.8)",borderBottom:"1px solid "+(m?"rgba(148, 163, 184, 0.12)":"rgba(15, 23, 42, 0.08)"),fontSize:"11px",fontWeight:600,color:m?d.M.dark.subText:d.M.light.subText,position:"sticky",top:0,zIndex:1},children:[(0,f.jsx)("div",{children:"Name"}),(0,f.jsx)("div",{children:"Value"}),(0,f.jsx)("div",{children:"Claimed"}),(0,f.jsx)("div",{children:"Pitched"}),(0,f.jsx)("div",{children:"Conversion"}),(0,f.jsx)("div",{children:"Clio"}),(0,f.jsx)("div",{children:"Enquiry Date"})]}),K.enquiries.map((e,t)=>(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 1fr",gap:"12px",padding:"12px",borderBottom:t<K.enquiries.length-1?"1px solid "+(m?"rgba(148, 163, 184, 0.08)":"rgba(15, 23, 42, 0.04)"):"none",fontSize:"12px",alignItems:"center",backgroundColor:"transparent",transition:"background-color 0.2s ease",cursor:"default"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=m?"rgba(15, 23, 42, 0.3)":"rgba(248, 250, 252, 0.7)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{style:{fontWeight:600,marginBottom:"2px"},children:[e.First_Name," ",e.Last_Name]}),(0,f.jsx)("div",{style:{opacity:.7,fontSize:"11px"},children:e.Area_of_Work||"No AOW"})]}),(0,f.jsx)("div",{style:{fontWeight:500,color:d.M.accent},children:(()=>{window.valueDebugLogged||(console.log("\ud83d\udd0d Value Debug - First 5 enquiries:"),K.enquiries.slice(0,5).forEach((e,t)=>{console.log(`${t+1}. ${e.First_Name} ${e.Last_Name}:`,{Value:e.Value,ValueType:typeof e.Value,ValueString:String(e.Value),ParsedFloat:parseFloat(String(e.Value))})}),window.valueDebugLogged=!0);const t=V(e);return t&&""!==t.trim()?t:"\u2014"})()}),(0,f.jsx)("div",{children:(t=>{const a=(null===(t=e.Point_of_Contact)||void 0===t?void 0:t.toLowerCase())||"";if("team@helix-law.com"!==a&&!!a){var n;const t=((null===(n=e.Point_of_Contact)||void 0===n?void 0:n.split("@")[0])||"").replace(/\./g," ").split(" ").map(e=>e.toUpperCase()).join(" ");return(0,f.jsx)("div",{style:{fontWeight:600,color:"#10b981",fontSize:"11px"},children:t})}return(0,f.jsx)("div",{style:{fontWeight:600,color:"#ef4444",fontSize:"11px"},children:"Unclaimed"})})()}),(0,f.jsx)("div",{children:(()=>{const t=G(e);return t.isPitched?(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,color:"#3b82f6",fontSize:"11px"},children:"Pitched"}),t.pitchDate?(0,f.jsx)("div",{style:{fontSize:"10px",color:"#3b82f6",fontWeight:500,marginTop:"2px"},children:new Date(t.pitchDate).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"2-digit"})}):(0,f.jsx)("div",{style:{fontSize:"9px",color:"#64748b",fontStyle:"italic",marginTop:"2px"},children:"Date unknown"})]}):(0,f.jsx)("div",{style:{fontWeight:600,color:"#64748b",fontSize:"11px"},children:"Not Pitched"})})()}),(0,f.jsx)("div",{children:(()=>{const t=U(e);return(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,color:t.hasInstruction?"#10b981":t.isProofOfIdComplete?"#f59e0b":"#64748b",fontSize:"11px"},children:t.hasInstruction?"Instructed":t.isProofOfIdComplete?"poid-complete":"Not Instructed"}),(t.hasInstruction||t.isProofOfIdComplete)&&(0,f.jsx)("div",{style:{opacity:.7,fontSize:"9px",marginTop:"1px"},children:t.instructionRef})]})})()}),(0,f.jsx)("div",{children:(()=>{const t=I[e.Email];if(N&&!I.hasOwnProperty(e.Email))return(0,f.jsx)("div",{style:{fontWeight:600,color:"#64748b",fontSize:"11px"},children:"Searching..."});if(t){var a;const e=t.matters&&t.matters.length>0,n=(null===(a=t.matters)||void 0===a?void 0:a.length)||0;return(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,color:e?"#10b981":"#3b82f6",fontSize:"11px"},children:e?`${n} Matter(s)`:"Contact Found"}),(0,f.jsx)("div",{style:{opacity:.7,fontSize:"9px",marginTop:"1px"},children:t.name})]})}return(0,f.jsx)("div",{style:{fontWeight:600,color:"#ef4444",fontSize:"11px"},children:"Not Found"})})()}),(0,f.jsx)("div",{style:{fontWeight:500},children:new Date(e.Date_Created||e.Touchpoint_Date).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"2-digit"})})]},`enquiry-${e.ID}-${t}`))]})]})]}),he&&ke&&(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(500px, 1fr))",gap:"16px",marginTop:"16px"},children:[(0,f.jsxs)("div",{style:Se(m),children:[(0,f.jsx)("h3",{style:ce,children:"Daily Spend Trend"}),(0,f.jsx)(je,{width:"100%",height:300,children:(0,f.jsxs)(ke,{data:J,children:[(0,f.jsx)(ye,{strokeDasharray:"3 3",stroke:m?"rgba(148, 163, 184, 0.2)":"rgba(0,0,0,0.1)"}),(0,f.jsx)(fe,{dataKey:"date",tick:{fontSize:12,fill:m?"#E2E8F0":"#374151"},stroke:m?"#64748B":"#9CA3AF"}),(0,f.jsx)(me,{tick:{fontSize:12,fill:m?"#E2E8F0":"#374151"},stroke:m?"#64748B":"#9CA3AF"}),(0,f.jsx)(be,{contentStyle:{backgroundColor:m?d.M.dark.cardBackground:d.M.light.cardBackground,border:`1px solid ${m?d.M.dark.border:d.M.light.border}`,borderRadius:"8px",fontSize:"12px"},formatter:e=>[ae(Number(e)),"Spend"]}),(0,f.jsx)(we,{type:"monotone",dataKey:"spend",stroke:d.M.cta,fill:d.M.cta,fillOpacity:.3})]})})]}),(0,f.jsxs)("div",{style:Se(m),children:[(0,f.jsx)("h3",{style:ce,children:"Engagement Performance"}),(0,f.jsx)(je,{width:"100%",height:300,children:(0,f.jsxs)(he,{data:J,children:[(0,f.jsx)(ye,{strokeDasharray:"3 3",stroke:m?"rgba(148, 163, 184, 0.2)":"rgba(0,0,0,0.1)"}),(0,f.jsx)(fe,{dataKey:"date",tick:{fontSize:12,fill:m?"#E2E8F0":"#374151"},stroke:m?"#64748B":"#9CA3AF"}),(0,f.jsx)(me,{tick:{fontSize:12,fill:m?"#E2E8F0":"#374151"},stroke:m?"#64748B":"#9CA3AF"}),(0,f.jsx)(be,{contentStyle:{backgroundColor:m?d.M.dark.cardBackground:d.M.light.cardBackground,border:`1px solid ${m?d.M.dark.border:d.M.light.border}`,borderRadius:"8px",fontSize:"12px"}}),(0,f.jsx)(ve,{}),(0,f.jsx)(xe,{type:"monotone",dataKey:"clicks",stroke:d.M.highlight,strokeWidth:2,name:"Clicks"}),(0,f.jsx)(xe,{type:"monotone",dataKey:"conversions",stroke:d.M.accent,strokeWidth:2,name:"Conversions"})]})})]})]}),(!he||!ke)&&(0,f.jsxs)("div",{style:Se(m,{marginTop:"16px"}),children:[(0,f.jsx)("h3",{style:ce,children:"Performance Charts"}),(0,f.jsxs)("div",{style:{padding:"40px",textAlign:"center",backgroundColor:m?"rgba(15, 23, 42, 0.5)":"rgba(248, 250, 252, 0.8)",borderRadius:"8px",border:"1px dashed "+(m?"rgba(148, 163, 184, 0.3)":"rgba(13, 47, 96, 0.2)")},children:[(0,f.jsx)(l.l8,{iconName:"LineChart",style:{fontSize:"48px",color:m?d.M.dark.subText:d.M.light.subText,marginBottom:"16px"}}),(0,f.jsx)("h4",{style:{color:m?d.M.dark.text:d.M.light.text,marginBottom:"8px"},children:"Charts Loading..."}),(0,f.jsx)("p",{style:{color:m?d.M.dark.subText:d.M.light.subText,margin:0,fontSize:"14px"},children:"Performance visualizations will be displayed here once Recharts loads."})]})]}),(0,f.jsxs)("div",{style:Se(m,{marginTop:"16px"}),children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[(0,f.jsx)("h3",{style:ce,children:"Top Performing Ads (Last 7 Days)"}),T&&(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,f.jsx)(s.y,{size:o.H.small}),(0,f.jsx)("span",{style:{fontSize:"12px",color:m?d.M.dark.subText:d.M.light.subText},children:"Loading ads..."})]})]}),C&&C.length>0?(0,f.jsxs)("div",{style:{display:"grid",gap:"12px"},children:[C.slice(0,10).map(e=>(0,f.jsx)("div",{style:{padding:"16px",backgroundColor:m?"rgba(15, 23, 42, 0.5)":"rgba(248, 250, 252, 0.6)",borderRadius:"8px",border:"1px solid "+(m?"rgba(148, 163, 184, 0.16)":"rgba(15, 23, 42, 0.04)")},children:(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr",gap:"16px",alignItems:"center"},children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,fontSize:"14px",color:m?d.M.dark.text:d.M.light.text,marginBottom:"4px"},children:e.adName}),(0,f.jsxs)("div",{style:{fontSize:"12px",color:m?d.M.dark.subText:d.M.light.subText,marginBottom:"2px"},children:["Campaign: ",e.campaignName]}),(0,f.jsxs)("div",{style:{fontSize:"12px",color:m?d.M.dark.subText:d.M.light.subText},children:["Ad Set: ",e.adsetName]})]}),(0,f.jsxs)("div",{style:{textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:"18px",fontWeight:700,color:d.M.cta,marginBottom:"2px"},children:ae(e.metrics.spend)}),(0,f.jsx)("div",{style:{fontSize:"11px",color:m?d.M.dark.subText:d.M.light.subText},children:"Spend"})]}),(0,f.jsxs)("div",{style:{textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:"16px",fontWeight:600,color:d.M.highlight,marginBottom:"2px"},children:ne(e.metrics.reach)}),(0,f.jsx)("div",{style:{fontSize:"11px",color:m?d.M.dark.subText:d.M.light.subText,marginBottom:"4px"},children:"Reach"}),(0,f.jsxs)("div",{style:{fontSize:"12px",color:m?d.M.dark.subText:d.M.light.subText},children:[ne(e.metrics.impressions)," imp"]})]}),(0,f.jsxs)("div",{style:{textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:"16px",fontWeight:600,color:d.M.highlight,marginBottom:"2px"},children:ne(e.metrics.clicks)}),(0,f.jsx)("div",{style:{fontSize:"11px",color:m?d.M.dark.subText:d.M.light.subText,marginBottom:"4px"},children:"Clicks"}),(0,f.jsxs)("div",{style:{fontSize:"12px",color:d.M.accent},children:[re(e.metrics.ctr)," CTR"]})]}),(0,f.jsxs)("div",{style:{textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:"16px",fontWeight:600,color:d.M.accent,marginBottom:"2px"},children:e.metrics.conversions}),(0,f.jsx)("div",{style:{fontSize:"11px",color:m?d.M.dark.subText:d.M.light.subText,marginBottom:"4px"},children:"Conversions"}),(0,f.jsxs)("div",{style:{fontSize:"12px",color:d.M.cta},children:[e.metrics.costPerConversion>0?ae(e.metrics.costPerConversion):"\u2014"," CPA"]})]})]})},e.adId)),C.length>10&&(0,f.jsxs)("div",{style:{textAlign:"center",padding:"12px",fontSize:"12px",color:m?d.M.dark.subText:d.M.light.subText},children:["Showing top 10 of ",C.length," ads"]})]}):T?null:(0,f.jsxs)("div",{style:{textAlign:"center",padding:"40px",backgroundColor:m?"rgba(15, 23, 42, 0.3)":"rgba(248, 250, 252, 0.6)",borderRadius:"8px",border:"1px dashed "+(m?"rgba(148, 163, 184, 0.2)":"rgba(13, 47, 96, 0.15)")},children:[(0,f.jsx)(l.l8,{iconName:"Target",style:{fontSize:"32px",color:m?d.M.dark.subText:d.M.light.subText,marginBottom:"12px"}}),(0,f.jsx)("p",{style:{color:m?d.M.dark.subText:d.M.light.subText,margin:0,fontSize:"14px"},children:"No individual ad data available for the selected period."})]})]})]})]})},De=e=>({background:e?"rgba(15, 23, 42, 0.88)":"#fff",border:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(15, 23, 42, 0.06)"),borderRadius:12,padding:16,display:"flex",flexDirection:"column",gap:8}),Te=e=>{let{children:t}=e;return(0,f.jsx)("h2",{style:{margin:0,fontSize:16,fontWeight:600,fontFamily:"Raleway, sans-serif"},children:t})};function _e(e){return e&&8===e.length?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6)}`:e}function Re(e,t){return e?e.map(e=>{var a;return{x:_e(e.date),y:Number(null!==(a=e[t])&&void 0!==a?a:0)}}):[]}const We=()=>{const[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(!0),[i,l]=(0,n.useState)(null),[c,g]=(0,n.useState)([]);(0,n.useEffect)(()=>{t(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)},[]),(0,n.useEffect)(()=>{(async()=>{try{r(!0),l(null);const e=await fetch("/api/marketing-metrics/ga4?daysBack=30&organicOnly=true");if(!e.ok)throw new Error(`${e.status} ${e.statusText}`);const t=await e.json(),a=(Array.isArray(null===t||void 0===t?void 0:t.data)?t.data:Array.isArray(t)?t:[]).map(e=>{var t,a,n,r,i,s,o;return{date:e.date||(null===(t=e.googleAnalytics)||void 0===t?void 0:t.date),sessions:null===(a=e.googleAnalytics)||void 0===a?void 0:a.sessions,activeUsers:null===(n=e.googleAnalytics)||void 0===n?void 0:n.activeUsers,screenPageViews:null===(r=e.googleAnalytics)||void 0===r?void 0:r.screenPageViews,bounceRate:null===(i=e.googleAnalytics)||void 0===i?void 0:i.bounceRate,averageSessionDuration:null===(s=e.googleAnalytics)||void 0===s?void 0:s.averageSessionDuration,conversions:null===(o=e.googleAnalytics)||void 0===o?void 0:o.conversions}});g(a)}catch(e){l((null===e||void 0===e?void 0:e.message)||"Failed to load GA4 data")}finally{r(!1)}})()},[]);const u=(0,n.useMemo)(()=>Re(c,"sessions"),[c]),p=(0,n.useMemo)(()=>Re(c,"activeUsers"),[c]),h=(0,n.useMemo)(()=>Re(c,"conversions"),[c]);if(a)return(0,f.jsx)("div",{style:{padding:24},children:(0,f.jsx)(s.y,{size:o.H.medium,label:"Loading SEO metrics\u2026"})});if(i)return(0,f.jsx)("div",{style:{padding:16,color:e?"#fecaca":"#991b1b",background:e?"rgba(248,113,113,0.18)":"rgba(248,113,113,0.12)",borderRadius:10},children:i});const x=(t,a)=>(0,f.jsxs)("div",{style:De(e),children:[(0,f.jsx)("span",{style:{fontSize:12,color:e?"#E2E8F0":d.M.missedBlue,fontWeight:600},children:t}),(0,f.jsx)("span",{style:{fontSize:22,fontWeight:700},children:a})]}),m=c[c.length-1],y=c.reduce((e,t)=>e+(t.sessions||0),0),b=c.reduce((e,t)=>e+(t.activeUsers||0),0),v=c.reduce((e,t)=>e+(t.conversions||0),0);return(0,f.jsxs)("div",{style:{minHeight:"100vh",padding:"24px 28px",display:"flex",flexDirection:"column",gap:16},children:[(0,f.jsx)(Te,{children:"SEO report (GA4)"}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:[x("30\u2011day sessions",y.toLocaleString()),x("30\u2011day users",b.toLocaleString()),x("30\u2011day conversions",v.toLocaleString()),x("Latest day",m?_e(m.date):"\u2014")]}),(0,f.jsxs)("div",{style:De(e),children:[(0,f.jsx)("span",{style:{fontSize:13,fontWeight:600,marginBottom:6},children:"Daily sessions (last 30 days)"}),(0,f.jsx)("pre",{style:{margin:0,overflowX:"auto",fontSize:12},children:JSON.stringify(u.slice(-30),null,2)})]}),(0,f.jsxs)("div",{style:De(e),children:[(0,f.jsx)("span",{style:{fontSize:13,fontWeight:600,marginBottom:6},children:"Daily users (last 30 days)"}),(0,f.jsx)("pre",{style:{margin:0,overflowX:"auto",fontSize:12},children:JSON.stringify(p.slice(-30),null,2)})]}),(0,f.jsxs)("div",{style:De(e),children:[(0,f.jsx)("span",{style:{fontSize:13,fontWeight:600,marginBottom:6},children:"Daily conversions (last 30 days)"}),(0,f.jsx)("pre",{style:{margin:0,overflowX:"auto",fontSize:12},children:JSON.stringify(h.slice(-30),null,2)})]}),(0,f.jsx)("div",{style:{opacity:.7,fontSize:12},children:"Notes: Using GA4 daily metrics. We can narrow to organic search via dimension filters in the backend later (e.g., defaultChannelGroup = Organic Search)."})]})};var Fe=a(10615);const ze=e=>e?"0 2px 8px rgba(0, 0, 0, 0.24)":"0 2px 6px rgba(15, 23, 42, 0.08)",Ie=e=>e?"rgba(148, 163, 184, 0.28)":"rgba(15, 23, 42, 0.08)",$e=e=>({background:e?"rgba(15, 23, 42, 0.86)":"#FFFFFF",borderRadius:14,border:`1px solid ${Ie(e)}`,boxShadow:ze(e),padding:"22px 24px",display:"flex",flexDirection:"column",gap:18,fontFamily:"Raleway, sans-serif"}),Le=e=>({display:"flex",justifyContent:"space-between",gap:16,flexWrap:"wrap",alignItems:"center",color:e?d.M.light.text:d.M.dark.text,fontFamily:"Raleway, sans-serif"}),Ae=e=>({fontSize:20,fontWeight:700,margin:0,color:e?d.M.light.text:d.M.dark.text,fontFamily:"Raleway, sans-serif"}),Be={display:"flex",gap:10,flexWrap:"wrap"},Ee=(e,t)=>({root:{borderRadius:999,padding:"0 14px",height:32,background:t?d.M.highlight:e?"rgba(148, 163, 184, 0.18)":"rgba(54, 144, 206, 0.12)",color:t?"#FFFFFF":e?"#E2E8F0":d.M.missedBlue,border:t?"1px solid rgba(13, 47, 96, 0.42)":"1px solid "+(e?"rgba(148, 163, 184, 0.28)":"rgba(13, 47, 96, 0.18)"),fontWeight:600,boxShadow:"none",transition:"background 0.2s ease",fontFamily:"Raleway, sans-serif"},rootHovered:{background:t?"#2f7cb3":e?"rgba(148, 163, 184, 0.24)":"rgba(54, 144, 206, 0.18)"},rootPressed:{background:t?"#266795":e?"rgba(148, 163, 184, 0.3)":"rgba(54, 144, 206, 0.24)"}}),Ne={display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,width:"100%"},He=e=>({display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 14px",borderRadius:12,border:`1px solid ${Ie(e)}`,background:e?"rgba(15, 23, 42, 0.7)":"rgba(248, 250, 252, 0.92)",boxShadow:"none",gap:12}),Pe={display:"flex",flexDirection:"column",alignItems:"flex-start",gap:4},qe=e=>{let{enquiries:t,allMatters:a,wip:i,recoveredFees:s}=e;const{isDarkMode:o}=(0,c.DP)(),[l,g]=(0,n.useState)("all"),u=e=>{if(!e)return"N/A";const t=e.includes("/")?e.split("/"):e.split("-");let a;return a=3===t.length&&e.includes("/")?new Date(`${t[2]}-${t[1]}-${t[0]}`):new Date(e),isNaN(a.getTime())?"N/A":a.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})},p=e=>e<1e4?`\xa3${e.toLocaleString("en-GB",{minimumFractionDigits:0,maximumFractionDigits:0})}`:e<1e6?`\xa3${(e/1e3).toFixed(1)}k`:e<1e9?`\xa3${(e/1e6).toFixed(2)}m`:`\xa3${(e/1e9).toFixed(2)}b`,{startDate:x,endDate:m}=(()=>{const e=new Date;let t;switch(e.setHours(0,0,0,0),l){case"today":t=new Date(e);break;case"thisWeek":t=new Date(e),t.setDate(e.getDate()-e.getDay()+(0===e.getDay()?-6:1)),t.setHours(0,0,0,0);break;case"thisMonth":t=new Date(e.getFullYear(),e.getMonth(),1);break;default:t=new Date(0)}return{startDate:t,endDate:e}})(),y=(null===t||void 0===t?void 0:t.filter(e=>{const t=new Date(e.Touchpoint_Date);return t>=x&&t<=m}))||[],b=y.length,v=y.length?`${u(y.reduce((e,t)=>new Date(t.Touchpoint_Date)<new Date(e.Touchpoint_Date)?t:e,y[0]).Touchpoint_Date)} - ${u(y.reduce((e,t)=>new Date(t.Touchpoint_Date)>new Date(e.Touchpoint_Date)?t:e,y[0]).Touchpoint_Date)}`:"N/A",j=(null===a||void 0===a?void 0:a.filter(e=>{const t=new Date(e["Open Date"]||e.OpenDate);return t>=x&&t<=m}))||[],k=j.length,w=j.length?`${u(j.reduce((e,t)=>new Date(t["Open Date"]||t.OpenDate)<new Date(e["Open Date"]||e.OpenDate)?t:e,j[0])["Open Date"]||j[0].OpenDate)} - ${u(j.reduce((e,t)=>new Date(t["Open Date"]||t.OpenDate)>new Date(e["Open Date"]||e.OpenDate)?t:e,j[0])["Open Date"]||j[0].OpenDate)}`:"N/A",M=(null===i||void 0===i?void 0:i.filter(e=>{const t=new Date(e.created_at);return t>=x&&t<=m}))||[],S=M.reduce((e,t)=>e+(t.total||0),0)||0,C=M.reduce((e,t)=>e+(t.quantity_in_hours||0),0)||0,D=M.length?`${u(M.reduce((e,t)=>new Date(t.created_at)<new Date(e.created_at)?t:e,M[0]).created_at)} - ${u(M.reduce((e,t)=>new Date(t.created_at)>new Date(e.created_at)?t:e,M[0]).created_at)}`:"N/A",T=(null===s||void 0===s?void 0:s.filter(e=>{const t=new Date(e.payment_date);return t>=x&&t<=m}))||[],_=T.reduce((e,t)=>e+t.payment_allocated,0)||0,R=T.length?`${u(T.reduce((e,t)=>new Date(t.payment_date)<new Date(e.payment_date)?t:e,T[0]).payment_date)} - ${u(T.reduce((e,t)=>new Date(t.payment_date)>new Date(e.payment_date)?t:e,T[0]).payment_date)}`:"N/A",W=[{icon:"People",title:"Total Enquiries",value:b.toLocaleString(),range:v},{icon:"Folder",title:"Total Matters",value:k.toLocaleString(),range:w},{icon:"Clock",title:"WIP (h)",value:(e=>{const t=Math.floor(e),a=e-t;return`${t}h ${Math.round(60*a)}m`})(C),range:D},{icon:"Clock",title:"WIP (\xa3)",value:p(S),range:D},{icon:"Money",title:"Collected",value:p(_),range:R}];return(0,f.jsxs)("section",{className:"home-preview-section",style:$e(o),children:[(0,f.jsxs)("div",{style:Le(o),children:[(0,f.jsx)("h2",{style:Ae(o),children:"Key Insights"}),(0,f.jsx)("div",{style:Be,children:[{key:"today",label:"Today"},{key:"thisWeek",label:"This Week"},{key:"thisMonth",label:"This Month"},{key:"all",label:"All Time"}].map(e=>(0,f.jsx)(r.Y,{text:e.label,onClick:()=>g(e.key),styles:Ee(o,l===e.key)},e.key))})]}),(0,f.jsx)("div",{style:Ne,children:W.map(e=>(0,f.jsx)("div",{className:"metric-card",style:He(o),children:(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,f.jsx)(h.I,{iconName:e.icon,style:{fontSize:32,color:d.M.highlight}}),(0,f.jsxs)("div",{style:Pe,children:[(0,f.jsx)(Fe.E,{variant:"large",styles:{root:{fontWeight:600,color:o?"#E2E8F0":d.M.dark.text,fontFamily:"Raleway, sans-serif"}},children:e.title}),(0,f.jsx)(Fe.E,{variant:"xxLarge",styles:{root:{fontWeight:800,color:o?"#FFFFFF":"#0F172A",fontFamily:"Raleway, sans-serif"}},children:e.value}),(0,f.jsx)(Fe.E,{variant:"small",styles:{root:{color:o?"rgba(226, 232, 240, 0.7)":d.M.greyText,fontFamily:"Raleway, sans-serif"}},children:e.range})]})]})},e.title))})]})};var Oe=a(93589),Ye=a(42463),Ge=a(52342),Ue=a(40520),Ve=a(94028),Ke=a(54845),Je=a(50108),Xe=a(87890),Qe=a(4240),Ze=a(17869),et=a(84721),tt=a(75748),at=a(87734),nt=a(80768),rt=a(52185),it=a(6026),st=a(90168);function ot(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;if(!e||!t)return!1;const n=e.toLowerCase().trim(),r=t.toLowerCase().trim();if(n===r)return!0;const i=n.length>r.length?n:r,s=function(e,t){const a=[];for(let n=0;n<=t.length;n++)a[n]=[n];for(let n=0;n<=e.length;n++)a[0][n]=n;for(let n=1;n<=t.length;n++)for(let r=1;r<=e.length;r++)t.charAt(n-1)===e.charAt(r-1)?a[n][r]=a[n-1][r-1]:a[n][r]=Math.min(a[n-1][r-1]+1,a[n][r-1]+1,a[n-1][r]+1);return a[t.length][e.length]}(i,n.length>r.length?r:n);return(i.length-s)/i.length>=a}function lt(e){if(!e)return null;try{return new Date(e)}catch{return null}}function dt(e,t){const a=t.map(t=>{const a=[];let n=0;e.Email&&t.email&&e.Email.toLowerCase().trim()===t.email.toLowerCase().trim()&&(n+=50,a.push("Exact email match"));const r=`${e.First_Name||""} ${e.Last_Name||""}`.trim(),i=`${t.first||""} ${t.last||""}`.trim();return r&&i&&(ot(r,i,.9)?(n+=30,a.push("Name match")):(ot(e.First_Name||"",t.first||"",.8)||ot(e.Last_Name||"",t.last||"",.8))&&(n+=15,a.push("Partial name match"))),function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const n=lt(e),r=lt(t);return!(!n||!r)&&Math.abs(n.getTime()-r.getTime())/864e5<=a}(e.Date_Created,t.datetime,2)&&(n+=20,a.push("Date proximity")),e.Point_of_Contact&&t.poc&&e.Point_of_Contact.toLowerCase().trim()===t.poc.toLowerCase().trim()&&(n+=10,a.push("POC match")),{newId:t.id,score:n,matchReasons:a,newEnquiry:t}}),n=a.length>0?a.reduce((e,t)=>t.score>e.score?t:e):{newId:void 0,score:0,matchReasons:[],newEnquiry:null};let r,i;return n.score>=70?(r="exact",i="migrated"):n.score>=30?(r="partial",i="partial"):(r="none",i="not-migrated"),{oldId:e.ID,newId:n.newId,matchType:r,matchScore:n.score,matchReasons:n.matchReasons,migrationStatus:i}}const ct={name:"",poc:"",taker:"",status:""},gt=[{key:"Partner",label:"Partner"},{key:"Associate Solicitor",label:"Associate"},{key:"Solicitor",label:"Solicitor"},{key:"Paralegal",label:"Paralegal"},{key:"Ops",label:"Ops"},{key:"Inactive",label:"Inactive"}];function ut(e){if(!e)return null;const t=new Date(String(e));return Number.isNaN(t.getTime())?null:t}function pt(e){const t=(e||"").trim();if(!t)return"?";let a=[];if(t.includes("@")){a=(t.split("@")[0]||"").split(/[^a-zA-Z]+/).filter(Boolean)}else a=t.split(/\s+/).filter(Boolean);if(0===a.length)return"?";return((a[0][0]||"")+(a.length>1?a[a.length-1][0]:a[0][1]||"")).toUpperCase()||"?"}const ht={"Samuel Packwood":"Sam Packwood","Bianca ODonnell":"Bianca O'Donnell"},xt=[d.M.blue,d.M.darkBlue,d.M.websiteBlue,d.M.missedBlue,d.M.accent,d.M.highlight,d.M.dark.subText,d.M.dark.highlight,d.M.highlightBlue,d.M.greyText,d.M.subtleGrey,d.M.dark.border,d.M.dark.grey,d.M.light.border,d.M.dark.cardHover],ft=e=>{let{cx:t,cy:a,midAngle:n,innerRadius:r,outerRadius:i,name:s,percent:o,isDarkMode:l}=e;if(o<.05)return null;const c=Math.PI/180,g=i+25,u=t+g*Math.cos(-n*c),p=a+g*Math.sin(-n*c);return(0,f.jsx)("text",{x:u,y:p,fill:l?d.M.accent:d.M.greyText,textAnchor:u>t?"start":"end",dominantBaseline:"central",fontSize:10,fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",fontWeight:500,children:`${s} ${(100*o).toFixed(0)}%`})},mt=e=>{let{data:t,title:a,isDarkMode:r,type:i,activeFilter:s,onSliceClick:o}=e;const[l,c]=(0,n.useState)(!0),[g,u]=(0,n.useState)([]);(0,n.useEffect)(()=>{c(!0);const e=setTimeout(()=>{u(t),c(!1)},150);return()=>clearTimeout(e)},[t]);return 0===t.length?(0,f.jsx)("div",{style:{height:220,display:"flex",alignItems:"center",justifyContent:"center",opacity:.7,color:r?d.M.dark.text:d.M.light.text,transition:"all 0.3s ease-in-out"},children:"No data in range."}):(0,f.jsxs)("div",{style:{position:"relative",height:220,transition:"opacity 0.3s ease-in-out",opacity:l?.5:1},children:[l&&(0,f.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:10,color:r?d.M.accent:d.M.blue,fontSize:"12px",fontWeight:500},children:"Loading..."}),(0,f.jsx)(Je.u,{width:"100%",height:220,children:(0,f.jsxs)(Xe.r,{children:[(0,f.jsx)(Qe.F,{data:g,cx:"50%",cy:"50%",outerRadius:70,fill:"#8884d8",dataKey:"value",label:e=>(0,f.jsx)(ft,{...e,isDarkMode:r}),labelLine:!1,stroke:r?"#1f2937":"#ffffff",strokeWidth:1,animationBegin:0,animationDuration:800,animationEasing:"ease-out",onClick:(e,t)=>{e&&e.name&&o(e.name)},cursor:"pointer",children:g.map((e,t)=>(0,f.jsx)(Ze.f,{fill:e.color,stroke:s===e.name?r?d.M.accent:d.M.highlight:r?"#1f2937":"#ffffff",strokeWidth:s===e.name?3:2,style:{opacity:s&&s!==e.name?.4:1,transition:"all 0.3s ease-in-out",cursor:"pointer"}},`cell-${t}`))}),(0,f.jsx)(et.m,{contentStyle:{backgroundColor:r?d.M.dark.sectionBackground:d.M.light.sectionBackground,border:`1px solid ${r?d.M.dark.border:d.M.light.border}`,borderRadius:"8px",color:r?d.M.dark.text:d.M.light.text,boxShadow:r?"0 4px 12px rgba(0,0,0,0.3)":"0 4px 12px rgba(0,0,0,0.1)",fontSize:"12px",fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",transition:"all 0.2s ease-in-out"},formatter:(e,t)=>[e,t],labelStyle:{color:r?d.M.dark.text:d.M.light.text}})]})}),s&&(0,f.jsxs)("div",{style:{position:"absolute",top:"5px",right:"5px",fontSize:"10px",color:r?d.M.accent:d.M.highlight,backgroundColor:r?"rgba(135, 206, 255, 0.1)":"rgba(54, 144, 206, 0.1)",padding:"2px 6px",borderRadius:"4px",border:`1px solid ${r?d.M.accent:d.M.highlight}`,cursor:"pointer"},onClick:()=>o(s),title:"Click to clear filter",children:["Filtered: ",s," \xd7"]})]})},yt=e=>"string"===typeof e?e:null==e?"":String(e),bt=e=>"string"===typeof e?e.replace(/[^a-zA-Z]/g,"").toLowerCase():"",vt=e=>{var t;return e?null!==(t=ht[e])&&void 0!==t?t:e:""},jt=e=>{const t=e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.18)";return{root:{maxWidth:220,".ms-DatePicker":{fontFamily:"Raleway, sans-serif !important"}},textField:{root:{fontFamily:"Raleway, sans-serif !important",width:"100% !important"},fieldGroup:{height:"36px !important",borderRadius:"8px !important",border:`1px solid ${t} !important`,background:`${e?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.95)"} !important`,padding:"0 14px !important",boxShadow:e?"0 2px 4px rgba(0, 0, 0, 0.2) !important":"0 1px 3px rgba(15, 23, 42, 0.08) !important",transition:"all 0.2s ease !important",selectors:{":hover":{border:`1px solid ${e?"rgba(135, 206, 255, 0.5)":"rgba(54, 144, 206, 0.4)"} !important`,background:`${e?"rgba(15, 23, 42, 0.95)":"rgba(248, 250, 252, 1)"} !important`,boxShadow:e?"0 4px 8px rgba(0, 0, 0, 0.25) !important":"0 2px 6px rgba(15, 23, 42, 0.12) !important"},":focus-within":{border:`1px solid ${e?"#87ceeb":d.M.highlight} !important`,background:`${e?"rgba(15, 23, 42, 1)":"rgba(255, 255, 255, 1)"} !important`,boxShadow:e?"0 2px 4px rgba(135, 206, 255, 0.12) !important":"0 2px 6px rgba(54, 144, 206, 0.15) !important"}}},field:{fontSize:"14px !important",fontFamily:"Raleway, sans-serif !important",fontWeight:"500 !important",background:"transparent !important",lineHeight:"20px !important",border:"none !important",outline:"none !important"}},icon:{color:`${e?d.M.highlight:d.M.missedBlue} !important`,fontSize:"16px !important",fontWeight:"bold !important"},callout:{fontSize:"14px !important",borderRadius:"12px !important",border:`1px solid ${t} !important`,boxShadow:e?"0 8px 24px rgba(0, 0, 0, 0.4) !important":"0 6px 20px rgba(15, 23, 42, 0.15) !important"},wrapper:{borderRadius:"12px !important"}}},kt=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=d.M.highlight,r=a?e?"rgba(15, 23, 42, 0.8)":"transparent":t?n:e?"rgba(148, 163, 184, 0.16)":"transparent";return{root:{display:"inline-flex",alignItems:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderRadius:999,border:t?"1px solid "+(e?"rgba(135, 176, 255, 0.5)":"rgba(13, 47, 96, 0.32)"):"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),padding:"0 12px",minHeight:32,height:32,fontWeight:600,fontSize:13,color:a?e?"#E2E8F0":d.M.missedBlue:t?"#ffffff":e?"#E2E8F0":d.M.missedBlue,background:r,boxShadow:t&&!a?"0 2px 8px rgba(54, 144, 206, 0.25)":"none",fontFamily:"Raleway, sans-serif",cursor:a?"default":"pointer",transition:"all 0.2s ease"},rootHovered:{background:a?r:t?"#2f7cb3":e?"rgba(148, 163, 184, 0.24)":"rgba(54, 144, 206, 0.12)"},rootPressed:{background:a?r:t?"#266795":e?"rgba(148, 163, 184, 0.3)":"rgba(54, 144, 206, 0.16)"}}},wt=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=t?`linear-gradient(135deg, ${d.M.highlight} 0%, #2f7cb3 100%)`:e?"rgba(15, 23, 42, 0.8)":"transparent",r=!a,i=r?.4:1;return{root:{borderRadius:999,minHeight:32,height:32,padding:"0 8px",fontWeight:t?700:600,fontSize:12,border:t?`2px solid ${e?"#87ceeb":d.M.highlight}`:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:n,color:t?"#ffffff":r?e?"#64748B":"#94A3B8":e?"#E2E8F0":d.M.missedBlue,opacity:i,boxShadow:t?e?"0 2px 8px rgba(54, 144, 206, 0.3)":"0 2px 8px rgba(54, 144, 206, 0.25)":"none",fontFamily:"Raleway, sans-serif",transform:t?"translateY(-1px)":"none",transition:"all 0.2s ease"},rootHovered:{background:t?"linear-gradient(135deg, #2f7cb3 0%, #266795 100%)":e?"rgba(15, 23, 42, 0.86)":"rgba(54, 144, 206, 0.1)",transform:"translateY(-1px)",boxShadow:t?e?"0 4px 12px rgba(54, 144, 206, 0.4)":"0 4px 12px rgba(54, 144, 206, 0.35)":e?"0 2px 4px rgba(0, 0, 0, 0.1)":"0 2px 4px rgba(15, 23, 42, 0.05)"},rootPressed:{background:t?"linear-gradient(135deg, #266795 0%, #1e5a7a 100%)":e?"rgba(15, 23, 42, 0.9)":"rgba(54, 144, 206, 0.14)",transform:"translateY(0)"}}},Mt=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=t?`linear-gradient(135deg, ${d.M.highlight} 0%, #2f7cb3 100%)`:e?"rgba(15, 23, 42, 0.8)":"transparent",r=a?1:.55;return{root:{borderRadius:999,minHeight:32,height:32,padding:"0 12px",fontWeight:t?700:600,fontSize:12,border:t?`2px solid ${e?"#87ceeb":d.M.highlight}`:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:n,color:t?"#ffffff":a?e?"#E2E8F0":d.M.missedBlue:e?"#64748B":"#94A3B8",opacity:r,boxShadow:t?e?"0 2px 8px rgba(54, 144, 206, 0.3)":"0 2px 8px rgba(54, 144, 206, 0.25)":"none",fontFamily:"Raleway, sans-serif",transform:t?"translateY(-1px)":"none",transition:"all 0.2s ease"},rootHovered:{background:t?"linear-gradient(135deg, #2f7cb3 0%, #266795 100%)":e?"rgba(15, 23, 42, 0.86)":"rgba(54, 144, 206, 0.1)",transform:a?"translateY(-1px)":"none",opacity:a?1:r,boxShadow:t?e?"0 4px 12px rgba(54, 144, 206, 0.4)":"0 4px 12px rgba(54, 144, 206, 0.35)":e?"0 2px 4px rgba(0, 0, 0, 0.1)":"0 2px 4px rgba(15, 23, 42, 0.05)"},rootPressed:{background:t?"linear-gradient(135deg, #266795 0%, #1e5a7a 100%)":e?"rgba(15, 23, 42, 0.9)":"rgba(54, 144, 206, 0.14)",transform:a?"translateY(0)":"none"}}},St=e=>({display:"flex",alignItems:"center",justifyContent:"center",padding:"0 12px",height:32,borderRadius:8,border:"1px solid "+(e?"rgba(239, 68, 68, 0.35)":"rgba(239, 68, 68, 0.25)"),background:e?"rgba(239, 68, 68, 0.12)":"rgba(254, 242, 242, 0.85)",color:e?"#fca5a5":"#dc2626",gap:6,cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Raleway, sans-serif",fontWeight:600,fontSize:13,whiteSpace:"nowrap"}),Ct=e=>({display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"center",gap:2,padding:"8px 12px",borderRadius:10,border:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:e?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",color:e?"#E2E8F0":d.M.missedBlue,minWidth:120,transition:"all 0.2s ease",cursor:"pointer"}),Dt=e=>{const t=new Date(e.start),a=new Date(e.end);return t.setHours(0,0,0,0),a.setHours(23,59,59,999),{start:t,end:a}},Tt=[{key:"all",label:"All",get:()=>null},...[{key:"today",label:"Today"},{key:"yesterday",label:"Yesterday"},{key:"week",label:"This Week"},{key:"lastWeek",label:"Last Week"},{key:"month",label:"This Month"},{key:"lastMonth",label:"Last Month"},{key:"last90Days",label:"Last 90 Days"},{key:"quarter",label:"This Quarter"},{key:"yearToDate",label:"Year To Date"},{key:"year",label:"Current Year"}].map(e=>{let{key:t,label:a}=e;return{key:t,label:a,get:()=>Dt((e=>{const t=new Date,a=new Date(t),n=new Date(t);switch(e){case"today":n.setHours(0,0,0,0);break;case"yesterday":{const e=new Date(t);e.setDate(e.getDate()-1),n.setTime(e.getTime()),n.setHours(0,0,0,0),a.setTime(e.getTime()),a.setHours(23,59,59,999);break}case"week":{const e=(t.getDay()+6)%7;n.setDate(t.getDate()-e),n.setHours(0,0,0,0);break}case"lastWeek":{const e=(t.getDay()+6)%7,r=new Date(t);r.setDate(t.getDate()-e),r.setHours(0,0,0,0),n.setTime(r.getTime()),n.setDate(n.getDate()-7),n.setHours(0,0,0,0),a.setTime(n.getTime()),a.setDate(a.getDate()+6),a.setHours(23,59,59,999);break}case"month":n.setDate(1),n.setHours(0,0,0,0);break;case"lastMonth":n.setMonth(t.getMonth()-1,1),n.setHours(0,0,0,0),a.setDate(0),a.setHours(23,59,59,999);break;case"last90Days":n.setDate(t.getDate()-89),n.setHours(0,0,0,0);break;case"quarter":{const e=3*Math.floor(t.getMonth()/3);n.setMonth(e,1),n.setHours(0,0,0,0);break}case"yearToDate":{const e=t.getFullYear();t.getMonth()>=3?n.setFullYear(e,3,1):n.setFullYear(e-1,3,1),n.setHours(0,0,0,0);break}case"year":n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),a.setFullYear(t.getFullYear(),11,31),a.setHours(23,59,59,999);break;case"custom":return{start:new Date(t),end:new Date(t)};default:return{start:new Date(0),end:a}}return{start:n,end:a}})(t))}})],_t=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",Rt=e=>e?ut(e):null,Wt=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"n/a",Ft=(e,t)=>{if(!e||!t)return 1;let a=0;const n=new Date(e);n.setHours(0,0,0,0);const r=new Date(t);for(r.setHours(23,59,59,999);n<=r;){const e=n.getDay();0!==e&&6!==e&&a++,n.setDate(n.getDate()+1)}return Math.max(1,a)};function zt(e){const t=(e||"").trim().toLowerCase();if(!t)return!1;if("property@helix-law.com"===t||"commercial@helix-law.com"===t||"construction@helix-law.com"===t)return!0;const a=t.includes("@")?t.split("@")[0]:t;return"commercial"===a||"construction"===a||"property"===a}const It=e=>{var t;if(!e||"object"!==typeof e)return"";const a=e,n=null!==(t=a.Point_of_Contact)&&void 0!==t?t:a.poc;return"string"===typeof n?n.trim():""};function $t(e){return{background:e?"rgba(15, 23, 42, 0.88)":"#FFFFFF",borderRadius:12,border:"1px solid "+(e?"rgba(148, 163, 184, 0.24)":"rgba(15, 23, 42, 0.06)"),boxShadow:e?"0 2px 10px rgba(0, 0, 0, 0.22)":"0 2px 8px rgba(15, 23, 42, 0.06)",padding:16,...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}const Lt={display:"grid",gridTemplateColumns:"repeat(12, 1fr)",gap:12};const At=e=>{var t,a,s,o,l,g,x,m,y,b;let{enquiries:v,teamData:j,annualLeave:k,metaMetrics:w,triggerRefresh:M,lastRefreshTimestamp:S,isFetching:C}=e;const{isDarkMode:D}=(0,c.DP)();n.useEffect(()=>{const e=document.createElement("style");return e.textContent="\n      @keyframes fadeInUp {\n        from {\n          opacity: 0;\n          transform: translateY(10px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]);const[T,_]=(0,n.useState)("month"),[R,W]=(0,n.useState)(new Set),[F,z]=(0,n.useState)(new Set),[I,$]=(0,n.useState)(null),[L,A]=(0,n.useState)(0),[B,E]=(0,n.useState)(!1),[N,H]=(0,n.useState)(!1),[P,q]=(0,n.useState)(null),[O,Y]=(0,n.useState)(null),[G,U]=(0,n.useState)(null),[V,K]=(0,n.useState)({isOpen:!1,title:"",items:[],type:"source",filterValue:""}),J=(e,t)=>{let a=[],n="";switch(e){case"source":a=ce.filter(e=>{let{enquiry:a}=e;return ue(a)===t}),n=`Enquiries from: ${t}`;break;case"moc":a=ce.filter(e=>{let{enquiry:a}=e;return pe(a)===t}),n=`Enquiries via: ${t}`;break;case"poc":a=ce.filter(e=>{let{enquiry:a}=e;return yt(a.Point_of_Contact||a.point_of_contact).trim()===t}),n=`Enquiries handled by: ${t}`}K({isOpen:!0,title:n,items:a,type:e,filterValue:t})},X=()=>{K(e=>({...e,isOpen:!1}))},[Q,Z]=(0,n.useState)(null),[ee,te]=(0,n.useState)(!1),[ae,ne]=(0,n.useState)(null);n.useEffect(()=>{const e=setInterval(()=>{A(e=>e+1)},1e3);return()=>clearInterval(e)},[]),n.useEffect(()=>{S&&A(0)},[S]);const re=()=>{const e=Math.min(L/900,1);return`rgb(${Math.round(34+25*e)}, ${Math.round(197+-67*e)}, ${Math.round(94+152*e)})`},ie=(0,n.useMemo)(()=>{if("custom"===T)return I&&I.start&&I.end?Dt({start:I.start,end:I.end}):null;const e=Tt.find(e=>e.key===T),t=null===e||void 0===e?void 0:e.get();return null!==t&&void 0!==t?t:null},[T,I]),se=(0,n.useMemo)(()=>j&&0!==j.length?j.map(e=>{var t,a;const n=vt((e=>e&&(e.Nickname||e["Full Name"]||e.First||e.Last||e.Initials)||"Unknown")(e)),r=(e.Initials||"").trim()||pt(n),i=bt(n);return{initials:r,display:n,role:null===(t=e.Role)||void 0===t?void 0:t.trim(),isActive:"inactive"!==(e.status||"").toLowerCase(),record:e,email:null===(a=e.Email)||void 0===a?void 0:a.trim(),normalizedName:i}}).filter(e=>Boolean(e.initials)&&"?"!==e.initials).sort((e,t)=>e.display.localeCompare(t.display)):[],[j]),oe=(0,n.useMemo)(()=>{const e=v||[];if(0===e.length)return[];const t=new Map,a=new Map;return se.forEach(e=>{if(e.normalizedName&&t.set(e.normalizedName,e),a.set(e.initials.toLowerCase(),e),e.email){const a=e.email.split("@")[0]||"",n=bt(a);n&&t.set(n,e)}}),e.map(e=>{const n=(e.Point_of_Contact||e.poc||e.pocname||"").trim(),r=vt(n),i=bt(r);let s=i?t.get(i):void 0;if(!s&&r){const e=pt(r).toLowerCase();e&&(s=a.get(e))}if(!s){const n=(e.Call_Taker||e.call_taker||"").trim(),r=bt(vt(n));var o;if(r)s=null!==(o=t.get(r))&&void 0!==o?o:a.get(pt(n).toLowerCase())}return{enquiry:e,member:s}})},[v,se]),le=(0,n.useMemo)(()=>{var e;const t=new Map,a=null===(e=window)||void 0===e?void 0:e.migrationData,n=Array.isArray(null===a||void 0===a?void 0:a.allEnquiries)?a.allEnquiries:Array.isArray(v)?v:[];if(!n||0===n.length)return t;const r=[],i=[];for(const v of n){const e="undefined"!==typeof(null===v||void 0===v?void 0:v.ID)||"undefined"!==typeof(null===v||void 0===v?void 0:v.Date_Created)||"undefined"!==typeof(null===v||void 0===v?void 0:v.Point_of_Contact),t="undefined"!==typeof(null===v||void 0===v?void 0:v.id)||"undefined"!==typeof(null===v||void 0===v?void 0:v.datetime)||"undefined"!==typeof(null===v||void 0===v?void 0:v.poc);var s,o,l,d,c,g,u,p,h;if(e&&!t)r.push({ID:String(null!==(s=v.ID)&&void 0!==s?s:""),Date_Created:String(null!==(o=null!==(l=v.Date_Created)&&void 0!==l?l:v.Touchpoint_Date)&&void 0!==o?o:""),Email:String(null!==(d=v.Email)&&void 0!==d?d:""),First_Name:String(null!==(c=null!==(g=v.First_Name)&&void 0!==g?g:v.first)&&void 0!==c?c:""),Last_Name:String(null!==(u=null!==(p=v.Last_Name)&&void 0!==p?p:v.last)&&void 0!==u?u:""),Company:v.Company,Point_of_Contact:String(null!==(h=v.Point_of_Contact)&&void 0!==h?h:""),Matter_Ref:v.Matter_Ref});else if(t){var x,f,m,y,b,j,k,w,M,S,C,D;i.push({id:Number(null!==(x=v.id)&&void 0!==x?x:0),datetime:String(null!==(f=null!==(m=null!==(y=v.datetime)&&void 0!==y?y:v.Date_Created)&&void 0!==m?m:v.Touchpoint_Date)&&void 0!==f?f:""),first:String(null!==(b=null!==(j=v.first)&&void 0!==j?j:v.First_Name)&&void 0!==b?b:""),last:String(null!==(k=null!==(w=v.last)&&void 0!==w?w:v.Last_Name)&&void 0!==k?k:""),email:String(null!==(M=null!==(S=v.email)&&void 0!==S?S:v.Email)&&void 0!==M?M:""),poc:String(null!==(C=null!==(D=v.poc)&&void 0!==D?D:v.Point_of_Contact)&&void 0!==C?C:""),stage:v.stage,claim:v.claim})}}if(0===r.length||0===i.length)return t;for(const v of r){const e=dt(v,i);"migrated"===e.migrationStatus||"partial"===e.migrationStatus||"sync-pending"===e.migrationStatus?t.set(v.ID,{status:e.migrationStatus,instructionsId:e.newId,matchScore:e.matchScore}):t.set(v.ID,{status:"not-migrated"})}return t},[v]),de=(0,n.useMemo)(()=>{if(!v||0===v.length)return null;const e=v.map(e=>ut(e.Touchpoint_Date)).filter(e=>null!==e);if(0===e.length)return null;return{earliest:new Date(Math.min(...e.map(e=>e.getTime()))),latest:new Date(Math.max(...e.map(e=>e.getTime())))}},[v]);n.useEffect(()=>{console.log("[EnquiriesReport] Received enquiries:",{isNull:null===v,isArray:Array.isArray(v),length:Array.isArray(v)?v.length:0,sample:Array.isArray(v)&&v.length>0?v[0]:null})},[v]);const ce=(0,n.useMemo)(()=>oe.filter(e=>{let{enquiry:t,member:a}=e;if(ie){const e=ut(t.Touchpoint_Date||t.Date_Created);if(!e||!((e,t,a)=>{if(!e)return!1;const n=e.getTime();return n>=t.getTime()&&n<=a.getTime()})(e,ie.start,ie.end))return!1}if(F.size>0){const e=null===a||void 0===a?void 0:a.initials;if(!e||!F.has(e))return!1}if(R.size>0){var n;const e=null===a||void 0===a||null===(n=a.role)||void 0===n?void 0:n.trim();if(!e||!R.has(e))return!1}if(P){if(ue(t)!==P)return!1}if(O){if(pe(t)!==O)return!1}if(G){if(yt(t.Point_of_Contact||t.point_of_contact).trim()!==G)return!1}return!0}),[oe,ie,R,F,P,O,G]),ge=(0,n.useMemo)(()=>ce.map(e=>e.enquiry),[ce]),he=(0,n.useMemo)(()=>{const e=new Map;return ce.forEach(t=>{let{member:a}=t;a&&e.set(a.initials,(e.get(a.initials)||0)+1)}),e},[ce]),xe=((0,n.useMemo)(()=>{const e=new Map;return ce.forEach(t=>{var a;let{member:n}=t;const r=null===n||void 0===n||null===(a=n.role)||void 0===a?void 0:a.trim();r&&e.set(r,(e.get(r)||0)+1)}),e},[ce]),(0,n.useMemo)(()=>(e=>{if(!e)return"Not refreshed yet";const t=Date.now()-e;if(t<6e4)return"Just now";const a=Math.floor(t/6e4);if(a<60)return`${a}m ago`;const n=Math.floor(a/60);if(n<24){const e=a%60;return e?`${n}h ${e}m ago`:`${n}h ago`}const r=Math.floor(n/24);if(r<7)return`${r}d ago`;const i=Math.floor(r/7);if(i<5)return`${i}w ago`;const s=Math.floor(r/30);return s<12?`${s}mo ago`:`${Math.floor(r/365)}y ago`})(S),[S])),fe="custom"===T,me=null!==(t=null===I||void 0===I?void 0:I.start)&&void 0!==t?t:null,ye=null!==(a=null===I||void 0===I?void 0:I.end)&&void 0!==a?a:null,be=null!==(s=null===ie||void 0===ie?void 0:ie.start)&&void 0!==s?s:fe?me:null,ve=null!==(o=null===ie||void 0===ie?void 0:ie.end)&&void 0!==o?o:fe?ye:null,je="all"===T?"All time":be?Wt(be):"Select start",ke="all"===T?"Latest":ve?Wt(ve):"Select end",we="custom"===T?"Custom":null!==(l=null===(g=Tt.find(e=>e.key===T))||void 0===g?void 0:g.label)&&void 0!==l?l:"All",Me=(0,n.useMemo)(()=>{const e=ge.length,t=new Map,a=new Map,n=new Map;let r=0,i=0;ge.forEach(e=>{const s=(e=>ue(e))(e),o=(e=>pe(e))(e);t.set(s,(t.get(s)||0)+1),a.set(o,(a.get(o)||0)+1);const l=It(e),d=(e=>{const t=e.toLowerCase();return!!t&&"team@helix-law.com"!==t&&"team"!==t&&"anyone"!==t&&"unassigned"!==t&&"unknown"!==t&&"n/a"!==t&&!zt(t)})(l);let c;c=d?l:zt(l)?"Triaged":"Unassigned",n.set(c,(n.get(c)||0)+1),d?r++:i++});const s=ie?Ft(ie.start,ie.end):Ft(new Date(2e3,0,1),new Date);return{total:e,perDay:e/Math.max(1,s),bySource:t,byMOC:a,byPoc:n,workingDays:s,claimed:r,unclaimed:i}},[ge,ie]),Se=ie?`${Me.workingDays} working days in selected range`:"All data (working days not applicable)",Ce=(0,n.useMemo)(()=>{const e=new Map;for(const t of ge){const a=ut(t.Touchpoint_Date);if(!a||isNaN(a.getTime()))continue;const n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,r=e.get(n)||[];r.push(t),e.set(n,r)}return Array.from(e.entries()).sort((e,t)=>e[0]<t[0]?1:-1).map(e=>{let[t,a]=e;return{date:t,items:a}})},[ge]),[De,Te]=(0,n.useState)(3),_e=n.useRef(null);n.useEffect(()=>{Te(3)},[T,Ce.length]),n.useEffect(()=>{const e=_e.current;if(!e)return;const t=new IntersectionObserver(e=>{const t=e[0];t&&t.isIntersecting&&Te(e=>Math.min(Ce.length,e+3))},{rootMargin:"200px"});return t.observe(e),()=>t.disconnect()},[Ce.length]);const Re=(0,n.useMemo)(()=>Array.from(Me.bySource.entries()).sort((e,t)=>t[1]-e[1]).slice(0,6),[Me.bySource]),We=(0,n.useMemo)(()=>Array.from(Me.byMOC.entries()).sort((e,t)=>t[1]-e[1]).slice(0,6),[Me.byMOC]),Fe=(0,n.useMemo)(()=>Array.from(Me.byPoc.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10),[Me.byPoc]),ze=(0,n.useMemo)(()=>Re.map((e,t)=>{let[a,n]=e;return{name:a,value:n,color:xt[t%xt.length]}}),[Re]),Ie=(0,n.useMemo)(()=>We.map((e,t)=>{let[a,n]=e;return{name:a,value:n,color:xt[t%xt.length]}}),[We]),$e=(0,n.useMemo)(()=>Fe.map((e,t)=>{let[a,n]=e;return{name:a,value:n,color:xt[t%xt.length]}}),[Fe]),Le=(0,n.useMemo)(()=>{if(!ge||0===ge.length)return[];const{level:e,format:t}=(e=>{const t=(()=>{if(!ge||0===ge.length)return 0;const e=ge.map(e=>ut(e.Date_Created)).filter(Boolean).sort((e,t)=>e.getTime()-t.getTime());if(e.length<2)return 0;const t=e[0],a=e[e.length-1];return Math.abs(a.getTime()-t.getTime())/864e5})();switch(e){case"today":case"yesterday":case"week":case"lastWeek":case"month":case"lastMonth":default:return{level:"daily",format:{day:"2-digit",month:"short"}};case"last90Days":case"quarter":return t<14?{level:"daily",format:{day:"2-digit",month:"short"}}:{level:"weekly",format:{day:"2-digit",month:"short"}};case"yearToDate":case"year":return t<14?{level:"daily",format:{day:"2-digit",month:"short"}}:{level:"monthly",format:{month:"short",year:"2-digit"}};case"custom":if(null!==I&&void 0!==I&&I.start&&null!==I&&void 0!==I&&I.end){const e=Math.abs(I.end.getTime()-I.start.getTime())/864e5;return e<14?{level:"daily",format:{day:"2-digit",month:"short"}}:e<=90?{level:"weekly",format:{day:"2-digit",month:"short"}}:{level:"monthly",format:{month:"short",year:"2-digit"}}}return{level:"daily",format:{day:"2-digit",month:"short"}}}})(T),a=new Map;ge.forEach(t=>{const n=ut(t.Date_Created);if(!n)return;let r,i,s,o=!1;if("daily"===e){r=n.toISOString().split("T")[0],i=s=new Date(n);const e=n.getDay();o=0===e||6===e}else if("weekly"===e){const e=new Date(n);e.setDate(n.getDate()-(n.getDay()+6)%7),e.setHours(0,0,0,0);const t=new Date(e);t.setDate(e.getDate()+6),t.setHours(23,59,59,999),r=e.toISOString().split("T")[0],i=e,s=t}else{const e=new Date(n.getFullYear(),n.getMonth(),1),t=new Date(n.getFullYear(),n.getMonth()+1,0);r=`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}`,i=e,s=t}const l=a.get(r);a.set(r,{count:((null===l||void 0===l?void 0:l.count)||0)+1,startDate:(null===l||void 0===l?void 0:l.startDate)||i,endDate:(null===l||void 0===l?void 0:l.endDate)||s,isWeekend:"daily"===e?o:void 0})});return Array.from(a.entries()).map(a=>{let n,[r,i]=a;if("daily"===e)n=i.startDate.toLocaleDateString("en-GB",t);else if("weekly"===e){n=`${i.startDate.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})} - ${i.endDate.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}`}else n=i.startDate.toLocaleDateString("en-GB",t);return{date:r,count:i.count,formattedDate:n,isWeekend:i.isWeekend,aggregationLevel:e,startDate:i.startDate,endDate:i.endDate}}).sort((e,t)=>e.date.localeCompare(t.date))},[ge,T,I]),Ae=(0,n.useCallback)((e,t)=>{if(!k)return!1;const a=new Date(t);return k.filter(t=>{var a;return t.fe===e||(null===(a=t.fe)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase()))}).some(e=>{const t=new Date(e.start_date),n=new Date(e.end_date);return a>=t&&a<=n})},[k]),Be=(0,n.useMemo)(()=>{const e=new Map,t=se.filter(e=>e.isActive);return Ce.forEach(a=>{let{date:n,items:r}=a,i=0,s=0,o=0;const l=new Map;r.forEach(e=>{var t,a,n;const r=null===(t=e.Point_of_Contact)||void 0===t?void 0:t.trim(),d=null===(a=e.Status)||void 0===a?void 0:a.toLowerCase(),c=null===(n=e.Call_Taker)||void 0===n?void 0:n.trim();if(d&&["completed","closed","resolved","triaged","processed"].includes(d)&&o++,r||c){s++;const e=r||c;if(e){const t=pt(e),a=se.find(a=>{var n;return a.initials===t||(null===(n=a.email)||void 0===n?void 0:n.toLowerCase())===e.toLowerCase()||a.normalizedName.includes(e.toLowerCase())});if(a){const e=l.get(a.initials)||{count:0,display:a.display};l.set(a.initials,{count:e.count+1,display:a.display})}}}else i++});const d=Array.from(l.entries()).map(e=>{let[t,a]=e;return{initials:t,...a}}).sort((e,t)=>t.count-e.count).slice(0,3),c=new Set(l.keys()),g=t.filter(e=>!c.has(e.initials)).map(e=>({initials:e.initials,display:e.display,onLeave:Ae(e.initials,n)}));e.set(n,{unclaimed:i,claimed:s,triaged:o,topClaimers:d,nonClaimers:g,totalEnquiries:r.length})}),e},[Ce,se]),Ee=(0,n.useCallback)(e=>{ot(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),[Ne,He]=(0,n.useState)(null),[Pe,qe]=(0,n.useState)(null),[Xe,Qe]=(0,n.useState)({}),[Ze,ot]=(0,n.useState)(new Set),lt=(0,n.useCallback)(()=>{const e=new Set;Ce.forEach(t=>{e.add(t.date)}),ot(e)},[Ce]);(0,n.useEffect)(()=>{lt()},[lt]);const[ht,ft]=(0,n.useState)(!1),[At,Bt]=(0,n.useState)(null),[Et,Nt]=(0,n.useState)(null),[Ht,Pt]=(0,n.useState)(!1),[qt,Ot]=(0,n.useState)(null),[Yt,Gt]=(0,n.useState)(new Map),Ut=(0,n.useCallback)(e=>{const t=(e,t)=>{for(const a of t){const t=null===e||void 0===e?void 0:e[a];if(null!=t&&String(t).trim().length>0)return String(t).trim()}return""},a=t(e,["Ultimate_Source","source","Source"]),n=t(e,["Method_of_Contact","moc","Method","Channel"]),{source:r,moc:i}=((e,t)=>{const a=(null===e||void 0===e?void 0:e.toLowerCase())||"",n=(null===t||void 0===t?void 0:t.toLowerCase())||"";let r=a,i=n;return["phone call","phone","telephone","call","email","website form","contact form","online form","live chat","chatgpt","chat","in-person","walk-in"].some(e=>a.includes(e))&&(i=a,r=n||"direct"),(a.includes("website form")||a.includes("contact form"))&&(i="website form",r=r.replace(/website form|contact form/gi,"").trim()||"direct"),(a.includes("chatgpt")||a.includes("chat"))&&(i="live chat",r=r.replace(/chatgpt|chat/gi,"").trim()||"direct"),r||(r="direct"),i||(i="website form"),{source:r,moc:i}})(a,n),s=t(e,["Area_of_Work","aow","Service","Area","Practice"]),o=t(e,["First_Name","first","First"]),l=t(e,["Last_Name","last","Last"]),d=t(e,["Email","email","Email_Address"]),c=t(e,["Phone_Number","Secondary_Phone","Phone","Telephone","phone","tel"]),g=t(e,["Initial_first_call_notes","Notes","Description","Message","notes"]),u=t(e,["Type_of_Work","tow"]),p=t(e,["Call_Taker","rep"]),h=t(e,["Point_of_Contact","poc"]),x=t(e,["Value","value"]),f=t(e,["Rating","rating"]),m=t(e,["Gift_Rank","rank"]),y=t(e,["Contact_Referrer","contact_referrer"]),b=t(e,["Referring_Company","company_referrer"]),v=t(e,["GCLID","gclid"]),j=t(e,["Referral_URL","Website","url"]),k=t(e,["Stage","status","stage"])||"pending",w=t(e,["Claim_Date","claim"]),M=t(e,["Pitch","pitch"])||"0",S=t(e,["ID","id","ACID","acid"]),C=t(e,["Card_ID","card_id","CardID"]);let D=g;const T=[];a===r&&n===i||T.push(`Data cleaned: Original Source="${a}", Original MOC="${n}"`),e.Company&&T.push(`Company: ${e.Company}`),e.Title&&T.push(`Title: ${e.Title}`),e.Website&&!j&&T.push(`Website: ${e.Website}`);const _=[e.Unit_Building_Name_or_Number,e.Mailing_Street,e.Mailing_Street_2,e.Mailing_Street_3,e.City,e.Mailing_County,e.Postal_Code,e.Country].filter(Boolean);return _.length>0&&T.push(`Address: ${_.join(", ")}`),e.Campaign&&T.push(`Campaign: ${e.Campaign}`),e.Ad_Group&&T.push(`Ad Group: ${e.Ad_Group}`),e.Search_Keyword&&T.push(`Keywords: ${e.Search_Keyword}`),e.Tags&&T.push(`Tags: ${e.Tags}`),e.Do_not_Market&&T.push(`Do Not Market: ${e.Do_not_Market}`),e.DOB&&T.push(`DOB: ${e.DOB}`),e.Matter_Ref&&T.push(`Matter Ref: ${e.Matter_Ref}`),T.length>0&&(D=D?`${D}\n\n--- Legacy Data ---\n${T.join("\n")}`:`--- Legacy Data ---\n${T.join("\n")}`),{aow:s,moc:i,first:o,last:l,email:d,phone:c,notes:D,tow:u,rep:p,poc:h,value:x,rating:f,rank:m,contact_referrer:y,company_referrer:b,gclid:v,source:r,url:j,stage:k,claim:w,pitch:M,acid:S,card_id:C}},[]),Vt=(0,n.useCallback)(e=>{Bt(e),Nt(Ut(e)),Ot(null),ft(!0)},[Ut]),Kt=(0,n.useCallback)(()=>{ft(!1),Bt(null),Nt(null),Pt(!1),Ot(null)},[]),Jt=(0,n.useCallback)(async()=>{if(Et){Pt(!0),Ot(null);try{const e=await fetch("/processEnquiry?source=migration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Et)});if(!e.ok){const t=await e.text();throw new Error(t||`HTTP ${e.status}`)}const t=null!==At&&void 0!==At&&At.ID?String(At.ID):void 0;t&&Gt(e=>{const a=new Map(e);return a.set(t,{status:"migrated"}),a}),Kt()}catch(e){Ot(null!==e&&void 0!==e&&e.message?String(e.message):"Migration failed")}finally{Pt(!1)}}},[Et,At,Kt]),Xt=(0,n.useCallback)((e,t,a)=>{Qe(n=>{var r;const i={...null!==(r=n[e])&&void 0!==r?r:ct,[t]:a};if(!Object.values(i).some(e=>e.trim().length>0)){const{[e]:t,...a}=n;return a}return{...n,[e]:i}})},[]),Qt=e=>{$("custom"===e?e=>{if(e&&e.start&&e.end)return e;return{start:ie?new Date(ie.start):new Date,end:ie?new Date(ie.end):new Date}}:null),_(e)},Zt=e=>t=>{$(a=>{const n=a?{...a}:{start:null,end:null};return n[e]=t?new Date(t):null,n}),_("custom")},ea=(0,n.useMemo)(()=>se.filter(e=>e.isActive).map(e=>({value:e.email||e.display,text:`${e.display} (${e.initials})`,initials:e.initials,email:e.email})),[se]),ta=(0,n.useCallback)((e,t)=>{t.stopPropagation();const a=t.currentTarget.getBoundingClientRect();Z({enquiryId:e,x:a.left,y:a.bottom+5})},[]),aa=(0,n.useCallback)(async e=>{if(!e||!Q)return;const t=ea.find(t=>t.value===e);if(t){te(!0),ne(null);try{const a=await fetch("/api/updateEnquiryPOC",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ID:Q.enquiryId,Point_of_Contact:e})}),n=await a.json();if(!a.ok||!n.success)throw new Error(n.message||"Failed to reassign enquiry");ne({type:"success",text:`Successfully reassigned to ${t.text}`}),M&&setTimeout(()=>M(),500)}catch(Fa){console.error("Error reassigning enquiry:",Fa),ne({type:"error",text:`Failed to reassign: ${Fa instanceof Error?Fa.message:"Unknown error"}`})}finally{te(!1),Z(null),setTimeout(()=>ne(null),3e3)}}},[Q,M,ea]),na=(0,n.useCallback)(()=>{Z(null)},[]);return(0,n.useEffect)(()=>{const e=e=>{if(Q){e.target.closest(".reassignment-dropdown")||na()}};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Q,na]),(0,f.jsxs)("div",{style:(ra=D,{display:"flex",flexDirection:"column",gap:16,background:ra?d.M.dark.background:d.M.light.background,padding:"18px 22px",minHeight:"100%"}),children:[(P||O||G)&&(0,f.jsxs)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:D?"rgba(135, 206, 255, 0.1)":"rgba(54, 144, 206, 0.1)",borderLeft:`4px solid ${D?d.M.accent:d.M.highlight}`,borderRadius:"0 8px 8px 0",display:"flex",alignItems:"center",gap:12,fontSize:"14px",color:D?d.M.dark.text:d.M.light.text},children:[(0,f.jsx)("span",{style:{fontWeight:600,color:D?d.M.accent:d.M.highlight},children:"Active Filters:"}),(0,f.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[P&&(0,f.jsxs)("span",{style:{padding:"4px 8px",backgroundColor:D?"rgba(135, 206, 255, 0.2)":"rgba(54, 144, 206, 0.2)",borderRadius:"4px",border:`1px solid ${D?d.M.accent:d.M.highlight}`,cursor:"pointer"},onClick:()=>q(null),title:"Click to remove filter",children:["Source: ",P," \xd7"]}),O&&(0,f.jsxs)("span",{style:{padding:"4px 8px",backgroundColor:D?"rgba(135, 206, 255, 0.2)":"rgba(54, 144, 206, 0.2)",borderRadius:"4px",border:`1px solid ${D?d.M.accent:d.M.highlight}`,cursor:"pointer"},onClick:()=>Y(null),title:"Click to remove filter",children:["Contact: ",O," \xd7"]}),G&&(0,f.jsxs)("span",{style:{padding:"4px 8px",backgroundColor:D?"rgba(135, 206, 255, 0.2)":"rgba(54, 144, 206, 0.2)",borderRadius:"4px",border:`1px solid ${D?d.M.accent:d.M.highlight}`,cursor:"pointer"},onClick:()=>U(null),title:"Click to remove filter",children:["Fee Earner: ",G," \xd7"]})]}),(0,f.jsx)("button",{onClick:()=>{q(null),Y(null),U(null)},style:{marginLeft:"auto",padding:"4px 8px",backgroundColor:"transparent",border:`1px solid ${D?d.M.accent:d.M.highlight}`,borderRadius:"4px",color:D?d.M.accent:d.M.highlight,cursor:"pointer",fontSize:"12px"},title:"Clear all filters",children:"Clear All"})]}),(0,f.jsxs)("div",{style:$t(D),children:[(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12},children:[fe?(0,f.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,f.jsx)(u.l,{label:"From",styles:jt(D),value:me||void 0,onSelectDate:Zt("start"),allowTextInput:!0,firstDayOfWeek:p.ob.Monday,formatDate:_t,parseDateFromString:Rt}),(0,f.jsx)(u.l,{label:"To",styles:jt(D),value:ye||void 0,onSelectDate:Zt("end"),allowTextInput:!0,firstDayOfWeek:p.ob.Monday,formatDate:_t,parseDateFromString:Rt})]}):(0,f.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,f.jsxs)("button",{type:"button",style:Ct(D),onClick:()=>Qt("custom"),title:"Click to customise the start date",onMouseEnter:e=>{e.currentTarget.style.background=D?"rgba(30, 41, 59, 0.86)":"rgba(248, 250, 252, 1)",e.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.currentTarget.style.background=D?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",e.currentTarget.style.transform="translateY(0)"},children:[(0,f.jsx)("span",{style:{fontSize:11,opacity:.7,fontWeight:600},children:"From"}),(0,f.jsx)("span",{style:{fontSize:16,fontWeight:700},children:je})]}),(0,f.jsxs)("button",{type:"button",style:Ct(D),onClick:()=>Qt("custom"),title:"Click to customise the end date",onMouseEnter:e=>{e.currentTarget.style.background=D?"rgba(30, 41, 59, 0.86)":"rgba(248, 250, 252, 1)",e.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.currentTarget.style.background=D?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",e.currentTarget.style.transform="translateY(0)"},children:[(0,f.jsx)("span",{style:{fontSize:11,opacity:.7,fontWeight:600},children:"To"}),(0,f.jsx)("span",{style:{fontSize:16,fontWeight:700},children:ke})]})]}),(0,f.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,f.jsx)("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:8,border:`1px solid ${C?D?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.25)":re()}`,background:D?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",fontSize:12,fontWeight:600,color:D?"#E2E8F0":d.M.missedBlue,transition:"border-color 1s ease"},title:C?"Refreshing data...":`Next auto-refresh in ${Math.floor((900-L)/60)}m ${(900-L)%60}s`,children:C?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{width:8,height:8,borderRadius:"50%",background:D?"rgba(148, 163, 184, 0.6)":"rgba(13, 47, 96, 0.5)"}}),"Refreshing"]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{width:8,height:8,borderRadius:"50%",background:re(),transition:"background 1s ease"}}),xe]})}),M&&(0,f.jsx)("button",{type:"button",onClick:()=>{M&&(M(),A(0))},disabled:C,style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:8,border:"1px solid "+(D?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:D?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",color:D?"#E2E8F0":d.M.missedBlue,cursor:C?"default":"pointer",opacity:C?.6:1,transition:"all 0.2s ease"},title:C?"Refreshing data...":"Refresh datasets (auto-refreshes every 15 min)","aria-label":C?"Refreshing data":"Refresh datasets",onMouseEnter:e=>{C||(e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.background=D?"rgba(30, 41, 59, 0.86)":"rgba(248, 250, 252, 1)")},onMouseLeave:e=>{C||(e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.background=D?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)")},children:(0,f.jsx)(h.I,{iconName:"Refresh",style:{fontSize:16,animation:C?"spin 1s linear infinite":"none"}})}),(0,f.jsx)("button",{type:"button",onClick:()=>E(!B),style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:8,border:"1px solid "+(D?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:D?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",color:B?D?"#60a5fa":d.M.highlight:D?"rgba(148, 163, 184, 0.6)":"rgba(13, 47, 96, 0.5)",cursor:"pointer",transform:B?"translateY(-1px)":"translateY(0)",transition:"all 0.2s ease"},title:B?"Hide role filter":"Show role filter","aria-label":B?"Hide role filter":"Show role filter",onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.background=D?"rgba(30, 41, 59, 0.86)":"rgba(248, 250, 252, 1)"},onMouseLeave:e=>{e.currentTarget.style.transform=B?"translateY(-1px)":"translateY(0)",e.currentTarget.style.background=D?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)"},children:(0,f.jsx)(h.I,{iconName:"People",style:{fontSize:16}})}),(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("button",{type:"button",onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1),style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:8,border:"1px solid "+(D?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:D?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.95)",color:D?"#60a5fa":d.M.highlight,cursor:"pointer",transform:N?"translateY(-1px)":"translateY(0)",transition:"all 0.2s ease"},title:"Dataset information","aria-label":"Dataset information",children:(0,f.jsx)(h.I,{iconName:"Info",style:{fontSize:16}})}),N&&(0,f.jsxs)("div",{style:{position:"absolute",top:"100%",right:0,marginTop:8,padding:"10px 12px",background:D?"rgba(15, 23, 42, 0.98)":"rgba(255, 255, 255, 0.98)",border:"1px solid "+(D?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.25)"),borderRadius:8,boxShadow:D?"0 8px 16px rgba(0, 0, 0, 0.4)":"0 4px 12px rgba(0, 0, 0, 0.15)",fontSize:11,lineHeight:1.5,width:240,zIndex:1e3,color:D?"#e2e8f0":"#334155",textAlign:"left"},children:[(0,f.jsx)("div",{style:{fontWeight:700,marginBottom:8,fontSize:13,color:D?"#60a5fa":d.M.highlight},children:"Dataset Information"}),(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,f.jsx)("span",{style:{opacity:.8},children:"Enquiries:"}),(0,f.jsx)("span",{style:{fontWeight:600},children:"Last 24 months"})]})}),(0,f.jsx)("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid "+(D?"rgba(148, 163, 184, 0.2)":"rgba(148, 163, 184, 0.3)"),fontSize:11,opacity:.7,fontStyle:"italic"},children:"Data outside this range won't appear in metrics"})]})]})]})]}),de&&(0,f.jsxs)("div",{style:{padding:"8px 12px",borderRadius:8,background:D?"rgba(148, 163, 184, 0.08)":"rgba(13, 47, 96, 0.04)",border:"1px solid "+(D?"rgba(148, 163, 184, 0.16)":"rgba(13, 47, 96, 0.08)"),fontSize:12,color:D?"rgba(226, 232, 240, 0.85)":"rgba(13, 47, 96, 0.75)",display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,f.jsxs)("span",{children:["Available data: ",de.earliest.toLocaleDateString()," to ",de.latest.toLocaleDateString(),"(",null===v||void 0===v?void 0:v.length.toLocaleString()," total)"]}),(0,f.jsx)("span",{children:Se})]}),(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[Tt.map(e=>{const t=(a=e.key,T===a);var a;return(0,f.jsx)(r.Y,{text:e.label,onClick:()=>Qt(e.key),styles:kt(D,t,!1)},e.key)}),"all"!==T&&(0,f.jsxs)("button",{onClick:()=>Qt("all"),style:St(D),title:"Clear date range filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]}),B&&(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[gt.map(e=>{let{key:t,label:a}=e;return(0,f.jsx)(r.Y,{text:a,onClick:()=>(e=>{const t=new Set(R);t.has(e)?t.delete(e):t.add(e),W(t)})(t),styles:Mt(D,R.has(t))},t)}),R.size>0&&(0,f.jsxs)("button",{onClick:()=>{W(new Set)},style:St(D),title:"Clear role filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]}),(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[se.filter(e=>he.has(e.initials)).map(e=>{const t=he.get(e.initials)||0,a=F.has(e.initials);return(0,f.jsx)(r.Y,{text:e.initials,onClick:()=>(e=>{const t=new Set(F);t.has(e)?t.delete(e):t.add(e),z(t)})(e.initials),title:`${e.display} (${t} enquiries)`,styles:wt(D,a,t>0)},e.initials)}),F.size>0&&(0,f.jsxs)("button",{onClick:()=>{z(new Set)},style:St(D),title:"Clear team filter",children:[(0,f.jsx)("span",{style:{fontSize:16},children:"\xd7"}),"Clear"]})]})]})]}),ae&&(0,f.jsx)(Oe.n,{messageBarType:"success"===ae.type?Ye.H.success:Ye.H.error,onDismiss:()=>ne(null),styles:{root:{marginTop:12,borderRadius:8}},children:ae.text}),null===v&&(0,f.jsx)("div",{style:{marginTop:12,padding:16,borderRadius:12,background:D?"rgba(220,38,38,0.12)":"rgba(220,38,38,0.08)",border:D?"1px solid rgba(248,113,113,0.28)":"1px solid rgba(220,38,38,0.18)",color:D?"#fda4af":"#b91c1c",fontSize:14},children:"\u26a0\ufe0f No enquiry data loaded. Click refresh or check console for errors."}),v&&0===v.length&&(0,f.jsx)("div",{style:{marginTop:12,padding:16,borderRadius:12,background:D?"rgba(251,191,36,0.12)":"rgba(251,191,36,0.08)",border:D?"1px solid rgba(251,191,36,0.28)":"1px solid rgba(251,191,36,0.18)",color:D?"#fcd34d":"#d97706",fontSize:14},children:"\u2139\ufe0f No enquiries found in database for the last 24 months. Check server logs or database."}),v&&v.length>0&&0===ge.length&&(0,f.jsxs)("div",{style:{marginTop:12,padding:16,borderRadius:12,background:D?"rgba(251,191,36,0.12)":"rgba(251,191,36,0.08)",border:D?"1px solid rgba(251,191,36,0.28)":"1px solid rgba(251,191,36,0.18)",color:D?"#fcd34d":"#d97706",fontSize:14},children:["\u2139\ufe0f ",v.length,' enquiries loaded, but none match the selected date range "',we,'". Try "All" to see all data.']}),(0,f.jsxs)("div",{style:{marginTop:12,display:"grid",gridTemplateColumns:"repeat(3, minmax(220px, 1fr))",gap:12},children:[(0,f.jsxs)("div",{style:{borderRadius:12,padding:16,background:D?"linear-gradient(135deg, #0B1220 0%, #141C2C 100%)":"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",boxShadow:D?"0 4px 6px rgba(0, 0, 0, 0.3)":"0 4px 6px rgba(0, 0, 0, 0.07)",border:D?"1px solid rgba(148,163,184,0.18)":"1px solid rgba(13,47,96,0.08)"},children:[(0,f.jsx)("div",{style:{fontSize:12,fontWeight:700,opacity:.7,marginBottom:6},children:"Enquiries"}),(0,f.jsx)("div",{style:{fontSize:28,fontWeight:800,color:D?"#E2E8F0":d.M.missedBlue},children:ge.length.toLocaleString()}),(0,f.jsxs)("div",{style:{fontSize:12,opacity:.8,marginTop:6},children:["~ ",Math.round(Me.perDay)," per working day"]})]}),(0,f.jsxs)("div",{style:{borderRadius:12,padding:16,background:D?"linear-gradient(135deg, #0B1220 0%, #12263A 100%)":"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",boxShadow:D?"0 4px 6px rgba(0, 0, 0, 0.3)":"0 4px 6px rgba(0, 0, 0, 0.07)",border:D?"1px solid rgba(148,163,184,0.18)":"1px solid rgba(13,47,96,0.08)"},children:[(0,f.jsx)("div",{style:{fontSize:12,fontWeight:700,opacity:.7,marginBottom:6},children:"Claimed"}),(0,f.jsx)("div",{style:{fontSize:28,fontWeight:800,color:D?"#E2E8F0":d.M.missedBlue},children:Me.claimed.toLocaleString()}),(0,f.jsxs)("div",{style:{fontSize:12,opacity:.8,marginTop:6},children:[ge.length?Math.round(Me.claimed/ge.length*100):0,"% of total"]})]}),(0,f.jsxs)("div",{style:{borderRadius:12,padding:16,background:D?"linear-gradient(135deg, #0B1220 0%, #2A1B1B 100%)":"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",boxShadow:D?"0 4px 6px rgba(0, 0, 0, 0.3)":"0 4px 6px rgba(0, 0, 0, 0.07)",border:D?"1px solid rgba(148,163,184,0.18)":"1px solid rgba(13,47,96,0.08)"},children:[(0,f.jsx)("div",{style:{fontSize:12,fontWeight:700,opacity:.7,marginBottom:6},children:"Unclaimed"}),(0,f.jsx)("div",{style:{fontSize:28,fontWeight:800,color:D?"#E2E8F0":d.M.missedBlue},children:Me.unclaimed.toLocaleString()}),(0,f.jsxs)("div",{style:{fontSize:12,opacity:.8,marginTop:6},children:[ge.length?Math.round(Me.unclaimed/ge.length*100):0,"% of total"]})]})]}),(0,f.jsxs)("div",{style:{marginTop:24,borderRadius:12,padding:20,background:D?"linear-gradient(135deg, #0B1220 0%, #141C2C 100%)":"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",boxShadow:D?"0 4px 6px rgba(0, 0, 0, 0.3)":"0 4px 6px rgba(0, 0, 0, 0.07)",border:D?"1px solid rgba(148,163,184,0.18)":"1px solid rgba(13,47,96,0.08)"},children:[(0,f.jsxs)("h3",{style:{margin:"0 0 16px 0",fontSize:18,fontWeight:700,color:D?d.M.accent:d.M.blue},children:["Enquiries Over Time",(0,f.jsxs)("span",{style:{fontSize:12,fontWeight:400,opacity:.7,marginLeft:8},children:["(","daily"===(null===(x=Le[0])||void 0===x?void 0:x.aggregationLevel)?"Daily":"weekly"===(null===(m=Le[0])||void 0===m?void 0:m.aggregationLevel)?"Weekly":"Monthly",")"]})]}),0===Le.length?(0,f.jsx)("div",{style:{height:300,display:"flex",alignItems:"center",justifyContent:"center",color:D?d.M.dark.text:d.M.light.text,opacity:.7},children:"No data in selected range."}):(0,f.jsx)(Je.u,{width:"100%",height:300,children:(0,f.jsxs)(tt.b,{data:Le,margin:{top:20,right:30,left:20,bottom:20},children:[(0,f.jsx)(at.d,{strokeDasharray:"3 3",stroke:D?"rgba(148,163,184,0.2)":"rgba(15,23,42,0.1)"}),"daily"===(null===(y=Le[0])||void 0===y?void 0:y.aggregationLevel)&&(()=>{const e=[];let t=null;return Le.forEach((a,n)=>{a.isWeekend&&null===t?t=n:a.isWeekend||null===t||(e.push((0,f.jsx)(nt.T,{x1:Le[t].formattedDate,x2:Le[n-1].formattedDate,fill:D?"rgba(148,163,184,0.08)":"rgba(15,23,42,0.04)",fillOpacity:1},`weekend-${t}-${n}`)),t=null)}),null!==t&&e.push((0,f.jsx)(nt.T,{x1:Le[t].formattedDate,x2:Le[Le.length-1].formattedDate,fill:D?"rgba(148,163,184,0.08)":"rgba(15,23,42,0.04)",fillOpacity:1},`weekend-${t}-end`)),e})(),(0,f.jsx)(rt.W,{dataKey:"formattedDate",stroke:D?d.M.dark.text:d.M.light.text,fontSize:11,fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",tick:{fill:D?d.M.dark.text:d.M.light.text}}),(0,f.jsx)(it.h,{stroke:D?d.M.dark.text:d.M.light.text,fontSize:11,fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",tick:{fill:D?d.M.dark.text:d.M.light.text}}),(0,f.jsx)(et.m,{contentStyle:{backgroundColor:D?d.M.dark.sectionBackground:d.M.light.sectionBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,borderRadius:"8px",color:D?d.M.dark.text:d.M.light.text,boxShadow:D?"0 4px 12px rgba(0,0,0,0.3)":"0 4px 12px rgba(0,0,0,0.1)",fontSize:"12px",fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"},labelFormatter:e=>{const t=Le.find(t=>t.formattedDate===e);if(!t)return e;const a="daily"===t.aggregationLevel?"Date":"weekly"===t.aggregationLevel?"Week":"Month",n=t.isWeekend?" (Weekend)":"";return`${a}: ${e}${n}`},formatter:(e,t)=>[e,"Enquiries"]}),(0,f.jsx)(st.N,{type:"monotone",dataKey:"count",stroke:d.M.blue,strokeWidth:3,connectNulls:!1,dot:e=>{const{cx:t,cy:a,payload:n,index:r}=e,i="daily"===(null===n||void 0===n?void 0:n.aggregationLevel),s=null===n||void 0===n?void 0:n.isWeekend;let o=!1;if(i&&"number"===typeof r&&Le[r]){const e=new Date(Le[r].date).getDay();if(r>0){const t=new Date(Le[r-1].date).getDay();o=5===t&&6===e||0===t&&1===e}if(!o&&r<Le.length-1){const t=new Date(Le[r+1].date).getDay();o=5===e&&6===t||0===e&&1===t}}return(0,f.jsxs)("g",{children:[(0,f.jsx)("circle",{cx:t,cy:a,r:i?4:5,fill:i&&s?d.M.greyText:d.M.blue,stroke:D?d.M.dark.sectionBackground:d.M.light.sectionBackground,strokeWidth:2,opacity:o?.7:1}),o&&(0,f.jsx)("circle",{cx:t,cy:a,r:i?6:7,fill:"none",stroke:D?"rgba(135, 206, 255, 0.3)":"rgba(54, 144, 206, 0.3)",strokeWidth:1,strokeDasharray:"2 2"})]})},activeDot:{r:6,fill:d.M.accent,stroke:D?d.M.dark.sectionBackground:d.M.light.sectionBackground,strokeWidth:2},animationDuration:800,animationEasing:"ease-out"})]})})]}),(()=>{const e=window.migrationData;if(null===e||void 0===e||!e.stats)return null;const{stats:t}=e;return(0,f.jsxs)("div",{style:{marginTop:16,padding:14,borderRadius:8,background:D?"rgba(15, 23, 42, 0.4)":"rgba(248, 250, 252, 0.8)",border:D?"1px solid rgba(148,163,184,0.15)":"1px solid rgba(13,47,96,0.08)",boxShadow:"none"},children:[(0,f.jsx)("div",{style:{fontSize:13,fontWeight:600,marginBottom:10,color:D?"#cbd5e1":"#475569",opacity:.8},children:"Data Migration Status"}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:10,fontSize:11},children:[(0,f.jsxs)("div",{style:{textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:16,fontWeight:700,color:D?"#86efac":"#22c55e"},children:t.migrated||0}),(0,f.jsx)("div",{style:{opacity:.6},children:"\u25cf Synced"})]}),(0,f.jsxs)("div",{style:{textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:16,fontWeight:700,color:D?"#fcd34d":"#d97706"},children:t.partial||0}),(0,f.jsx)("div",{style:{opacity:.6},children:"\u25d0 Partial"})]}),(0,f.jsxs)("div",{style:{textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:16,fontWeight:700,color:D?"#94a3b8":"#64748b"},children:t.notMigrated||0}),(0,f.jsx)("div",{style:{opacity:.6},children:"\u25cb Legacy"})]}),(0,f.jsxs)("div",{style:{textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:16,fontWeight:700,color:D?"#c4b5fd":"#8b5cf6"},children:t.instructionsOnly||0}),(0,f.jsx)("div",{style:{opacity:.6},children:"\u25cf New Only"})]})]}),(0,f.jsxs)("div",{style:{marginTop:8,textAlign:"center",fontSize:10,opacity:.5},children:["Sync Rate: ",t.migrationRate||"0.0%"," \u2022 ",t.total||0," enquiries analyzed"]})]})})()]}),w&&w.length>0&&(0,f.jsxs)("div",{style:$t(D),children:[(0,f.jsx)("h3",{style:{fontSize:16,fontWeight:600,margin:0},children:"Marketing Performance"}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:20,marginTop:16},children:[(0,f.jsxs)("div",{style:{background:D?"rgba(66, 165, 245, 0.1)":"rgba(66, 165, 245, 0.05)",border:"1px solid "+(D?"rgba(66, 165, 245, 0.3)":"rgba(66, 165, 245, 0.2)"),borderRadius:12,padding:16},children:[(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12,color:"#42a5f5"},children:[(0,f.jsx)(h.I,{iconName:"BarChart4",style:{fontSize:16}}),(0,f.jsx)("span",{style:{fontWeight:600,fontSize:14},children:"Google Analytics"})]}),(e=>{const t=null===(e=w[w.length-1])||void 0===e?void 0:e.googleAnalytics;return t?(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,fontSize:12},children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:t.sessions.toLocaleString()}),(0,f.jsx)("div",{style:{opacity:.7},children:"Sessions"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:t.users.toLocaleString()}),(0,f.jsx)("div",{style:{opacity:.7},children:"Users"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:t.conversions}),(0,f.jsx)("div",{style:{opacity:.7},children:"Conversions"})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:[(100*t.conversionRate).toFixed(1),"%"]}),(0,f.jsx)("div",{style:{opacity:.7},children:"Conv. Rate"})]})]}):(0,f.jsx)("div",{style:{fontSize:12,opacity:.6},children:"No data available"})})()]}),(0,f.jsxs)("div",{style:{background:D?"rgba(76, 175, 80, 0.1)":"rgba(76, 175, 80, 0.05)",border:"1px solid "+(D?"rgba(76, 175, 80, 0.3)":"rgba(76, 175, 80, 0.2)"),borderRadius:12,padding:16},children:[(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12,color:"#4caf50"},children:[(0,f.jsx)(h.I,{iconName:"Money",style:{fontSize:16}}),(0,f.jsx)("span",{style:{fontWeight:600,fontSize:14},children:"Google Ads"})]}),(e=>{const t=null===(e=w[w.length-1])||void 0===e?void 0:e.googleAds;return t?(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,fontSize:12},children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:["\xa3",t.cost.toFixed(0)]}),(0,f.jsx)("div",{style:{opacity:.7},children:"Spend"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:t.clicks.toLocaleString()}),(0,f.jsx)("div",{style:{opacity:.7},children:"Clicks"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:t.conversions}),(0,f.jsx)("div",{style:{opacity:.7},children:"Conversions"})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:["\xa3",t.cpa.toFixed(0)]}),(0,f.jsx)("div",{style:{opacity:.7},children:"Cost/Conv"})]})]}):(0,f.jsx)("div",{style:{fontSize:12,opacity:.6},children:"No data available"})})()]}),(0,f.jsxs)("div",{style:{background:D?"rgba(59, 89, 152, 0.1)":"rgba(59, 89, 152, 0.05)",border:"1px solid "+(D?"rgba(59, 89, 152, 0.3)":"rgba(59, 89, 152, 0.2)"),borderRadius:12,padding:16},children:[(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12,color:"#3b5998"},children:[(0,f.jsx)(h.I,{iconName:"People",style:{fontSize:16}}),(0,f.jsx)("span",{style:{fontWeight:600,fontSize:14},children:"Meta Ads"})]}),(e=>{const t=null===(e=w[w.length-1])||void 0===e?void 0:e.metaAds;return t?(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,fontSize:12},children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:["\xa3",t.spend.toFixed(0)]}),(0,f.jsx)("div",{style:{opacity:.7},children:"Spend"})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:[(t.reach/1e3).toFixed(1),"k"]}),(0,f.jsx)("div",{style:{opacity:.7},children:"Reach"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:t.conversions}),(0,f.jsx)("div",{style:{opacity:.7},children:"Conversions"})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:[(100*t.ctr).toFixed(1),"%"]}),(0,f.jsx)("div",{style:{opacity:.7},children:"CTR"})]})]}):(0,f.jsx)("div",{style:{fontSize:12,opacity:.6},children:"No data available"})})()]})]})]}),(0,f.jsxs)("div",{style:Lt,children:[(0,f.jsx)("div",{style:{gridColumn:"span 4"},children:(0,f.jsxs)("div",{style:$t(D),children:[(0,f.jsx)("h3",{style:{fontSize:16,fontWeight:600,margin:0},children:"Top sources"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:window.innerWidth<1200?"column":"row",gap:20,marginTop:16},children:[(0,f.jsx)("div",{style:{flex:window.innerWidth<1200?"none":1,minHeight:220},children:(0,f.jsx)(mt,{data:ze,title:"Top sources",isDarkMode:D,type:"source",activeFilter:P,onSliceClick:e=>J("source",e)})}),(0,f.jsxs)("div",{style:{flex:window.innerWidth<1200?"none":1,display:"flex",flexDirection:"column",gap:12,justifyContent:"center",minHeight:180,marginTop:window.innerWidth<1200?16:0,transition:"all 0.3s ease-in-out"},children:[Re.map((e,t)=>{let[a,n]=e;return(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px dashed "+(D?"rgba(148,163,184,0.2)":"rgba(15,23,42,0.08)"),padding:"8px 0",fontSize:"14px",opacity:0,animation:`fadeInUp 0.4s ease-out ${.1*t}s forwards`},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.text:d.M.light.text},children:a}),(0,f.jsx)("span",{style:{fontWeight:600,color:d.M.blue,minWidth:"40px",textAlign:"right"},children:n})]},a)}),0===Re.length&&(0,f.jsx)("span",{style:{opacity:.7,color:D?d.M.dark.text:d.M.light.text,textAlign:"center",padding:"20px 0"},children:"No data in range."})]})]})]})}),(0,f.jsx)("div",{style:{gridColumn:"span 4"},children:(0,f.jsxs)("div",{style:$t(D),children:[(0,f.jsx)("h3",{style:{fontSize:16,fontWeight:600,margin:0},children:"Contact methods"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:window.innerWidth<1200?"column":"row",gap:20,marginTop:16},children:[(0,f.jsx)("div",{style:{flex:window.innerWidth<1200?"none":1,minHeight:220},children:(0,f.jsx)(mt,{data:Ie,title:"Contact methods",isDarkMode:D,type:"moc",activeFilter:O,onSliceClick:e=>J("moc",e)})}),(0,f.jsxs)("div",{style:{flex:window.innerWidth<1200?"none":1,display:"flex",flexDirection:"column",gap:12,justifyContent:"center",minHeight:180,marginTop:window.innerWidth<1200?16:0,transition:"all 0.3s ease-in-out"},children:[We.map((e,t)=>{let[a,n]=e;return(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px dashed "+(D?"rgba(148,163,184,0.2)":"rgba(15,23,42,0.08)"),padding:"8px 0",fontSize:"14px",opacity:0,animation:`fadeInUp 0.4s ease-out ${.1*t}s forwards`},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.text:d.M.light.text},children:a}),(0,f.jsx)("span",{style:{fontWeight:600,color:d.M.blue,minWidth:"40px",textAlign:"right"},children:n})]},a)}),0===We.length&&(0,f.jsx)("span",{style:{opacity:.7,color:D?d.M.dark.text:d.M.light.text,textAlign:"center",padding:"20px 0"},children:"No data in range."})]})]})]})}),(0,f.jsx)("div",{style:{gridColumn:"span 4"},children:(0,f.jsxs)("div",{style:$t(D),children:[(0,f.jsx)("h3",{style:{fontSize:16,fontWeight:600,margin:0},children:"By fee earner"}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:window.innerWidth<1200?"column":"row",gap:20,marginTop:16},children:[(0,f.jsx)("div",{style:{flex:window.innerWidth<1200?"none":1,minHeight:220},children:(0,f.jsx)(mt,{data:$e,title:"By fee earner",isDarkMode:D,type:"poc",activeFilter:G,onSliceClick:e=>J("poc",e)})}),(0,f.jsxs)("div",{style:{flex:window.innerWidth<1200?"none":1,display:"flex",flexDirection:"column",gap:12,justifyContent:"center",minHeight:180,marginTop:window.innerWidth<1200?16:0,transition:"all 0.3s ease-in-out"},children:[Fe.map((e,t)=>{let[a,n]=e;return(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px dashed "+(D?"rgba(148,163,184,0.2)":"rgba(15,23,42,0.08)"),padding:"8px 0",fontSize:"14px",opacity:0,animation:`fadeInUp 0.4s ease-out ${.1*t}s forwards`},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.text:d.M.light.text},children:a}),(0,f.jsx)("span",{style:{fontWeight:600,color:d.M.blue,minWidth:"40px",textAlign:"right"},children:n})]},a)}),0===Fe.length&&(0,f.jsx)("span",{style:{opacity:.7,color:D?d.M.dark.text:d.M.light.text,textAlign:"center",padding:"20px 0"},children:"No data in range."})]})]})]})})]}),(0,f.jsxs)("div",{style:$t(D),children:[(0,f.jsx)("h3",{style:{fontSize:16,fontWeight:600,margin:0},children:"Recent enquiries"}),0===Ce.length?(0,f.jsx)("div",{style:{opacity:.7},children:"No enquiries in the selected range."}):(0,f.jsxs)("div",{children:[Ce.slice(0,De).map((e,t)=>{var a;const r=Pe===e.date,i=(e=>{const t=ut(e);if(!t)return e;const a=new Date;a.setHours(0,0,0,0);const n=new Date(t);n.setHours(0,0,0,0);const r=a.getTime()-n.getTime(),i=Math.round(r/864e5);if(0===i)return"Today";if(1===i)return"Yesterday";const s=new Date(a),o=(s.getDay()+6)%7;s.setDate(s.getDate()-o);const l=new Date(s);return l.setDate(s.getDate()+6),n>=s&&n<=l?n.toLocaleDateString("en-GB",{weekday:"long"}):n.toLocaleDateString("en-GB")})(e.date),s=new Date(e.date).toLocaleDateString("en-GB",{weekday:"long",day:"2-digit",month:"long",year:"numeric"}),o=D?"rgba(135, 243, 243, 0.55)":d.M.missedBlue,l={position:"absolute",left:10,top:0===t?"20px":0,bottom:t===De-1?"50%":0,width:2,background:o,opacity:1,zIndex:1},c={position:"absolute",left:6,top:16,width:10,height:10,borderRadius:5,background:D?"rgba(255,255,255,0.15)":"#fff",border:`2px solid ${o}`,zIndex:2},g={borderRadius:12,padding:12,background:D?"linear-gradient(135deg, #0B1220 0%, #141C2C 100%)":"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",boxShadow:r?D?"0 6px 16px rgba(15,23,42,0.45)":"0 10px 24px rgba(15,23,42,0.12)":D?"0 2px 6px rgba(0,0,0,0.25)":"0 2px 6px rgba(15,23,42,0.04)",border:D?"1px solid "+(r?"rgba(148,163,184,0.35)":"rgba(148,163,184,0.14)"):"1px solid "+(r?"rgba(13,47,96,0.18)":"rgba(13,47,96,0.06)"),opacity:r?1:.6,filter:r?"none":"grayscale(0.12)",transition:"all 0.24s ease"},u=null!==(a=Xe[e.date])&&void 0!==a?a:ct,p=u.name.trim().toLowerCase(),x=u.poc.trim().toLowerCase(),m=u.taker.trim().toLowerCase(),y=u.status.trim().toLowerCase(),b=Boolean(p||x||m||y),v=e.items.filter(e=>{const t=(e.Client_Name||e.Description||e.Client||`${e.First_Name||""} ${e.Last_Name||""}`.trim()||"-").toLowerCase();if(p&&!t.includes(p))return!1;const a=It(e)||"",n=a.toLowerCase();if(x&&!n.includes(x))return!1;const r=(e.Call_Taker||"").toString().toLowerCase();if(m&&!r.includes(m))return!1;if(y){if((zt(a)?"triaged":a&&"team@helix-law.com"!==n?"claimed":"unclaimed")!==y)return!1}return!0}),j={display:"inline-flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:8,background:D?"rgba(148,163,184,0.12)":"rgba(13,47,96,0.05)",border:D?"1px solid rgba(148,163,184,0.18)":"1px solid rgba(13,47,96,0.08)",fontWeight:700,marginBottom:8},k={display:"inline-block",padding:"1px 6px",borderRadius:999,background:D?"rgba(148,163,184,0.12)":"rgba(13,47,96,0.05)",border:D?"1px solid rgba(148,163,184,0.18)":"1px solid rgba(13,47,96,0.08)",fontSize:11,fontWeight:600};return(0,f.jsxs)("div",{style:{position:"relative",paddingLeft:24,marginBottom:18,transition:"opacity 0.2s ease"},onMouseEnter:()=>qe(e.date),onMouseLeave:()=>qe(t=>t===e.date?null:t),onFocus:()=>qe(e.date),onBlur:()=>qe(t=>t===e.date?null:t),children:[(0,f.jsx)("div",{style:l}),(0,f.jsx)("div",{style:c}),(0,f.jsxs)("div",{style:g,children:[(0,f.jsxs)("div",{style:{...j,justifyContent:"space-between",width:"100%",cursor:"pointer",userSelect:"none"},onClick:()=>Ee(e.date),children:[(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,f.jsx)(h.I,{iconName:Ze.has(e.date)?"ChevronRight":"ChevronDown",style:{fontSize:10,opacity:.7,transition:"transform 0.2s ease",transform:(Ze.has(e.date),"rotate(0deg)")}}),(0,f.jsx)("span",{title:s,children:i})]}),(0,f.jsxs)("span",{style:{fontSize:12,opacity:.75},children:[v.length," shown",b?` \xb7 filtered from ${e.items.length}`:` \xb7 total ${e.items.length}`]})]}),Ze.has(e.date)?(()=>{const t=Be.get(e.date);return t?(0,f.jsxs)("div",{style:{padding:"12px 0",display:"flex",flexDirection:"column",gap:"12px"},children:[(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px"},children:[(0,f.jsxs)("div",{style:{padding:"8px 12px",borderRadius:"8px",background:D?"rgba(239, 68, 68, 0.1)":"rgba(239, 68, 68, 0.05)",border:"1px solid "+(D?"rgba(239, 68, 68, 0.2)":"rgba(239, 68, 68, 0.1)"),textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:"20px",fontWeight:700,color:"#ef4444"},children:t.unclaimed}),(0,f.jsx)("div",{style:{fontSize:"10px",opacity:.7,textTransform:"uppercase"},children:"Unclaimed"})]}),(0,f.jsxs)("div",{style:{padding:"8px 12px",borderRadius:"8px",background:D?"rgba(34, 197, 94, 0.1)":"rgba(34, 197, 94, 0.05)",border:"1px solid "+(D?"rgba(34, 197, 94, 0.2)":"rgba(34, 197, 94, 0.1)"),textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:"20px",fontWeight:700,color:"#22c55e"},children:t.claimed}),(0,f.jsx)("div",{style:{fontSize:"10px",opacity:.7,textTransform:"uppercase"},children:"Claimed"})]}),(0,f.jsxs)("div",{style:{padding:"8px 12px",borderRadius:"8px",background:D?"rgba(59, 130, 246, 0.1)":"rgba(59, 130, 246, 0.05)",border:"1px solid "+(D?"rgba(59, 130, 246, 0.2)":"rgba(59, 130, 246, 0.1)"),textAlign:"center"},children:[(0,f.jsx)("div",{style:{fontSize:"20px",fontWeight:700,color:"#3b82f6"},children:t.triaged}),(0,f.jsx)("div",{style:{fontSize:"10px",opacity:.7,textTransform:"uppercase"},children:"Triaged"})]})]}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontSize:"11px",fontWeight:600,marginBottom:"6px",opacity:.8},children:"Top Claimers"}),t.topClaimers.length>0?(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.topClaimers.map((e,t)=>(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"10px",padding:"4px 8px",background:D?"rgba(255,255,255,0.04)":"rgba(0,0,0,0.02)",borderRadius:"4px"},children:[(0,f.jsx)("span",{style:{fontWeight:500},children:e.initials}),(0,f.jsx)("span",{style:{fontSize:"9px",color:d.M.blue,fontWeight:600},children:e.count})]},e.initials))}):(0,f.jsx)("div",{style:{fontSize:"10px",opacity:.5,fontStyle:"italic"},children:"No claims"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{fontSize:"11px",fontWeight:600,marginBottom:"6px",opacity:.8},children:"Non-claimers"}),t.nonClaimers.length>0?(0,f.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(40px, 1fr))",gap:"3px"},children:t.nonClaimers.map(e=>(0,f.jsxs)("div",{style:{fontSize:"9px",padding:"3px 4px",backgroundColor:D?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",borderRadius:"3px",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",opacity:e.onLeave?.4:.8,border:e.onLeave?`1px dashed ${d.M.greyText}`:"none"},children:[(0,f.jsx)("span",{style:{fontWeight:500},children:e.initials}),e.onLeave&&(0,f.jsx)("span",{style:{fontSize:"7px",color:d.M.greyText,fontStyle:"italic",lineHeight:1},children:"leave"})]},e.initials))}):(0,f.jsx)("div",{style:{fontSize:"10px",opacity:.5,fontStyle:"italic"},children:"All claimed"})]})]})]}):null})():(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"minmax(220px, 1fr) 220px 160px 120px",gap:8,margin:"6px 0 10px",opacity:r?.8:.45,transition:"opacity 0.2s ease"},children:[(0,f.jsx)("input",{value:u.name,onChange:t=>Xt(e.date,"name",t.target.value),placeholder:"Filter name / description",style:{fontSize:11,padding:"6px 8px",borderRadius:8,border:D?"1px solid rgba(148,163,184,0.22)":"1px solid rgba(15,23,42,0.14)",background:D?"rgba(15,23,42,0.6)":"rgba(241,245,249,0.8)",color:D?"#e2e8f0":"#1f2937"}}),(0,f.jsx)("input",{value:u.poc,onChange:t=>Xt(e.date,"poc",t.target.value),placeholder:"Filter point of contact",style:{fontSize:11,padding:"6px 8px",borderRadius:8,border:D?"1px solid rgba(148,163,184,0.22)":"1px solid rgba(15,23,42,0.14)",background:D?"rgba(15,23,42,0.6)":"rgba(241,245,249,0.8)",color:D?"#e2e8f0":"#1f2937"}}),(0,f.jsx)("input",{value:u.taker,onChange:t=>Xt(e.date,"taker",t.target.value),placeholder:"Filter call taker",style:{fontSize:11,padding:"6px 8px",borderRadius:8,border:D?"1px solid rgba(148,163,184,0.22)":"1px solid rgba(15,23,42,0.14)",background:D?"rgba(15,23,42,0.6)":"rgba(241,245,249,0.8)",color:D?"#e2e8f0":"#1f2937"}}),(0,f.jsxs)("select",{value:u.status,onChange:t=>Xt(e.date,"status",t.target.value),style:{fontSize:11,padding:"6px 8px",borderRadius:8,border:D?"1px solid rgba(148,163,184,0.22)":"1px solid rgba(15,23,42,0.14)",background:D?"rgba(15,23,42,0.6)":"rgba(241,245,249,0.8)",color:D?"#e2e8f0":"#1f2937"},children:[(0,f.jsx)("option",{value:"",children:"All statuses"}),(0,f.jsx)("option",{value:"claimed",children:"Claimed"}),(0,f.jsx)("option",{value:"unclaimed",children:"Unclaimed"}),(0,f.jsx)("option",{value:"triaged",children:"Triaged"})]})]}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"minmax(220px, 1fr) 220px 160px 120px",gap:8},children:[(0,f.jsx)("div",{style:{fontSize:11,fontWeight:600,opacity:.55},children:"Name"}),(0,f.jsx)("div",{style:{fontSize:11,fontWeight:600,opacity:.55},children:"Point of contact"}),(0,f.jsx)("div",{style:{fontSize:11,fontWeight:600,opacity:.55},children:"Call taker"}),(0,f.jsx)("div",{style:{fontSize:11,fontWeight:600,opacity:.55},children:"Status"}),0===v.length&&(0,f.jsx)("div",{style:{gridColumn:"1 / span 4",fontSize:11,opacity:.6,padding:"8px 0"},children:"No enquiries match the filters for this day."}),v.map((a,r)=>{var i,s,o,l;const c=a.Client_Name||a.Description||a.Client||`${a.First_Name||""} ${a.Last_Name||""}`.trim()||"-",g="string"===typeof a.stage?a.stage.toLowerCase():"string"===typeof a.Stage?a.Stage.toLowerCase():"",u="string"===typeof a.Status?a.Status.toLowerCase():"string"===typeof a.status?a.status.toLowerCase():"",p=a.InstructionRef||a.instruction_ref||a.instructionRef,x=p||a.RRef||a.rref||a.Rref,m=null!==(i=null!==(s=a.DealId)&&void 0!==s?s:a.deal_id)&&void 0!==i?i:a.dealId,y=null!==(o=null!==(l=a.ProspectId)&&void 0!==l?l:a.prospect_id)&&void 0!==o?o:a.prospectId,b="string"===typeof m?parseInt(m,10):"number"===typeof m?m:NaN,v="string"===typeof y?parseInt(y,10):"number"===typeof y?y:NaN,j=Boolean(p||a.Matter_Ref||a.matter_ref||a.MatterRef||a.matterRef||a.MatterId||a.MatterID||a.matterId||a.matterID||"closed"===u||"instructed"===u||g&&g.includes("instruct")),w=Boolean(!0===a.pitch||!0===a.Pitched||Boolean(a.PitchedDate)||g&&(g.includes("deal")||g.includes("pitch"))||"pitched"===u||!!x&&!j||Number.isFinite(b)&&b>0||Number.isFinite(v)&&v>0),M=(a.Point_of_Contact||"").trim().toLowerCase(),S=!M||"team@helix-law.com"===M,C=zt(M),T=!S&&!C,_=!!Ne&&Ne.date===e.date&&Ne.poc===M,R=_?D?{background:"rgba(135, 243, 243, 0.12)",outline:"1px solid rgba(135, 243, 243, 0.38)",borderRadius:6}:{background:"rgba(13, 47, 96, 0.06)",outline:"1px solid rgba(13, 47, 96, 0.18)",borderRadius:6}:{};let W=a.migrationStatus||"unknown",F=a.matchScore||0,z=a.instructionsId;const I=a.ID?String(a.ID):null;if(I&&le.has(I)){const e=le.get(I);W=e.status||W,"number"===typeof e.matchScore&&(F=e.matchScore),"undefined"!==typeof e.instructionsId&&(z=e.instructionsId)}const $=(e=>{switch(e){case"migrated":return{icon:"\u25cf",color:D?"#86efac":"#22c55e",label:"Synced",title:`Synced to new system (ID: ${z})`};case"partial":return{icon:"\u25d0",color:D?"#fcd34d":"#d97706",label:"Partial",title:`Partially synced (Score: ${F})`};case"not-migrated":return{icon:"\u25cb",color:D?"#94a3b8":"#64748b",label:"Legacy",title:"Legacy system only"};case"sync-pending":return{icon:"\u25d2",color:D?"#93c5fd":"#3b82f6",label:"Pending",title:"Sync pending"};case"instructions-only":return{icon:"\u25cf",color:D?"#c4b5fd":"#8b5cf6",label:"New",title:"New system only"};default:return{icon:"\u25cb",color:D?"#64748b":"#94a3b8",label:"Unknown",title:"Migration status unknown"}}})(W),L={display:"inline-flex",alignItems:"center",gap:4,padding:"1px 4px",borderRadius:6,fontSize:9,fontWeight:500,background:D?"rgba(0,0,0,0.15)":"rgba(255,255,255,0.7)",border:`1px solid ${$.color}30`,color:$.color,marginLeft:4,opacity:.9,cursor:"pointer"},A=S?"Unclaimed":C?"Triaged":a.Point_of_Contact,B=S||C?{...k,background:C?D?"rgba(71,85,105,0.18)":"rgba(100,116,139,0.12)":D?"rgba(220,38,38,0.12)":"rgba(220,38,38,0.08)",border:C?D?"1px solid rgba(148,163,184,0.35)":"1px solid rgba(100,116,139,0.28)":D?"1px solid rgba(248,113,113,0.28)":"1px solid rgba(220,38,38,0.18)",color:C?D?"#CBD5E1":"#334155":D?"#fda4af":"#b91c1c"}:{},E="operations"===(a.Call_Taker||"").trim().toLowerCase()?"Internal":"External",N=k,H=D?{...k,background:"rgba(32,178,108,0.12)",border:"1px solid rgba(32,178,108,0.28)",color:"#86efac",marginRight:6}:{...k,background:"rgba(32,178,108,0.08)",border:"1px solid rgba(32,178,108,0.18)",color:d.M.green,marginRight:6},P={},q=S?"Unclaimed":C?"Triaged":"Claimed",O=S?D?{...k,background:"rgba(248,113,113,0.12)",border:"1px solid rgba(248,113,113,0.28)",color:"#fca5a5"}:{...k,background:"rgba(239,68,68,0.12)",border:"1px solid rgba(239,68,68,0.18)",color:"#b91c1c"}:C?D?{...k,background:"rgba(96,165,250,0.12)",border:"1px solid rgba(96,165,250,0.28)",color:"#93c5fd"}:{...k,background:"rgba(59,130,246,0.12)",border:"1px solid rgba(59,130,246,0.18)",color:"#1d4ed8"}:{...H,marginRight:0},Y={display:"inline-flex",alignItems:"center",gap:4,padding:"2px 6px",borderRadius:999,fontSize:10,fontWeight:700,marginLeft:8},G=D?{...Y,background:"rgba(59,130,246,0.12)",border:"1px solid rgba(147,197,253,0.28)",color:"#93c5fd"}:{...Y,background:"rgba(37,99,235,0.08)",border:"1px solid rgba(37,99,235,0.18)",color:"#1e40af"},U=D?{...Y,background:"rgba(32,178,108,0.12)",border:"1px solid rgba(32,178,108,0.28)",color:"#86efac"}:{...Y,background:"rgba(32,178,108,0.08)",border:"1px solid rgba(32,178,108,0.18)",color:d.M.green},V={display:"inline-flex",alignItems:"center",justifyContent:"center",width:22,height:22,borderRadius:999,fontSize:10,fontWeight:800,color:D?"#E2E8F0":d.M.missedBlue,background:D?"linear-gradient(135deg, #0B1220 0%, #12263A 100%)":"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",border:D?"1px solid rgba(148,163,184,0.35)":"1px solid rgba(13,47,96,0.18)",boxShadow:D?"0 1px 2px rgba(0,0,0,0.35)":"0 1px 2px rgba(15,23,42,0.08)",marginRight:8,cursor:"pointer"};return(0,f.jsxs)(n.Fragment,{children:[(0,f.jsxs)("div",{style:{...P,...R,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)("span",{children:c}),(0,f.jsx)("span",{title:$.title,style:L,onClick:()=>Vt(a),children:$.icon})]}),(0,f.jsxs)("div",{style:{...P,...R,display:"flex",alignItems:"center",gap:6},onMouseEnter:()=>{T&&He({date:e.date,poc:M})},onMouseLeave:()=>{_&&He(null)},children:[T&&(0,f.jsxs)("span",{title:`${A} - Click to reassign`,"aria-label":`${A} - Click to reassign`,style:{...V,cursor:"pointer",transition:"all 0.2s ease",position:"relative"},onClick:e=>ta(a.ID||a.id||`${t}-${r}`,e),onMouseEnter:()=>He({date:e.date,poc:M}),onMouseLeave:()=>{_&&He(null)},children:[pt(a.Point_of_Contact),(0,f.jsx)(h.I,{iconName:"Edit",style:{fontSize:8,position:"absolute",bottom:-2,right:-2,background:D?d.M.dark.background:d.M.light.background,borderRadius:"50%",padding:1,opacity:.7}})]}),(S||C)&&(0,f.jsxs)("span",{style:{...B,cursor:"pointer",position:"relative",transition:"all 0.2s ease"},title:`${A} - Click to assign`,onClick:e=>ta(a.ID||a.id||`${t}-${r}`,e),children:[A,(0,f.jsx)(h.I,{iconName:"AddFriend",style:{fontSize:8,marginLeft:4,opacity:.7}})]})]}),(0,f.jsx)("div",{style:{...P,...R},children:(0,f.jsx)("span",{style:N,children:E})}),(0,f.jsxs)("div",{style:{...P,...R,display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},children:[(0,f.jsx)("span",{style:O,children:q}),j&&(0,f.jsx)("span",{title:"Instructed","aria-label":"Instructed",style:U,children:"Instructed"}),!j&&w&&(0,f.jsx)("span",{title:"Pitched","aria-label":"Pitched",style:G,children:"Pitched"})]})]},r)})]})]})]})]},e.date)}),De<Ce.length&&(0,f.jsx)("div",{ref:_e,style:{height:1}})]})]}),(0,f.jsxs)(Ge.l,{hidden:!ht,onDismiss:Kt,dialogContentProps:{type:Ue.h.largeHeader,title:"Migrate Legacy Enquiry",subText:"Review and adjust field mappings before creating the new enquiry record."},minWidth:900,maxWidth:1100,styles:{main:{backgroundColor:D?d.M.dark.sectionBackground:d.M.light.sectionBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,borderRadius:12,boxShadow:D?"0 25px 50px -12px rgba(0, 0, 0, 0.8)":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",maxHeight:"85vh",height:"auto"}},children:[At&&Et&&(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"420px 1fr",gap:20,padding:16,maxHeight:"65vh",overflow:"hidden"},children:[(0,f.jsxs)("div",{style:{backgroundColor:D?d.M.dark.background:d.M.light.background,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,borderRadius:8,padding:16,overflow:"auto",maxHeight:"65vh"},children:[(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12,paddingBottom:8,borderBottom:`1px solid ${D?d.M.dark.border:d.M.light.border}`},children:[(0,f.jsx)(h.I,{iconName:"Database",style:{fontSize:14,color:D?d.M.dark.subText:d.M.light.subText}}),(0,f.jsx)("div",{style:{fontWeight:600,fontSize:14,color:D?d.M.dark.text:d.M.light.text},children:"Legacy Record"}),(0,f.jsxs)("div",{style:{fontSize:10,opacity:.7,backgroundColor:D?d.M.dark.border:d.M.light.border,padding:"2px 6px",borderRadius:4,fontFamily:"monospace"},children:["ID: ",String(null!==(b=At.ID)&&void 0!==b?b:"unknown")]})]}),(0,f.jsxs)("div",{style:{marginBottom:16},children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.blue,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"Contact",style:{fontSize:11}}),"Contact Information"]}),(0,f.jsxs)("div",{style:{display:"grid",gap:4,paddingLeft:16,fontSize:11},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Name:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:(At.First_Name||"")+" "+(At.Last_Name||"")||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Email:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Email||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Phone:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Phone_Number||At.Secondary_Phone||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Company:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Company||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Title:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Title||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Website:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right",fontSize:10},children:At.Website||"-"})]})]})]}),(0,f.jsxs)("div",{style:{marginBottom:16},children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.green,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"Work",style:{fontSize:11}}),"Business Details"]}),(0,f.jsxs)("div",{style:{display:"grid",gap:4,paddingLeft:16,fontSize:11},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Area of Work:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right",maxWidth:"60%"},children:At.Area_of_Work||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Type of Work:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right",maxWidth:"60%"},children:At.Type_of_Work||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Contact Method:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Method_of_Contact||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Value:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Value||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Rating:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Rating||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Gift Rank:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Gift_Rank||"-"})]})]})]}),(0,f.jsxs)("div",{style:{marginBottom:16},children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.yellow,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"Ringer",style:{fontSize:11}}),"Attribution & Source"]}),(0,f.jsxs)("div",{style:{display:"grid",gap:4,paddingLeft:16,fontSize:11},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Source:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right",maxWidth:"60%"},children:At.Ultimate_Source||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Contact Referrer:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right",maxWidth:"60%"},children:At.Contact_Referrer||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Referring Company:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right",maxWidth:"60%"},children:At.Referring_Company||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Campaign:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right",maxWidth:"60%"},children:At.Campaign||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"GCLID:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right",fontFamily:"monospace",fontSize:10},children:At.GCLID||"-"})]})]})]}),(0,f.jsxs)("div",{style:{marginBottom:16},children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.red,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"People",style:{fontSize:11}}),"Internal Details"]}),(0,f.jsxs)("div",{style:{display:"grid",gap:4,paddingLeft:16,fontSize:11},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Point of Contact:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Point_of_Contact||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Call Taker:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Call_Taker||"-"})]}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,f.jsx)("span",{style:{color:D?d.M.dark.subText:d.M.greyText},children:"Matter Ref:"}),(0,f.jsx)("span",{style:{fontWeight:500,textAlign:"right"},children:At.Matter_Ref||"-"})]})]})]}),At.Initial_first_call_notes&&(0,f.jsxs)("div",{style:{marginTop:16,padding:12,backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,borderRadius:6,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`},children:[(0,f.jsx)("div",{style:{fontSize:11,fontWeight:600,color:d.M.blue,marginBottom:6},children:"Full Notes:"}),(0,f.jsx)("div",{style:{fontSize:10,lineHeight:1.4,maxHeight:120,overflow:"auto",color:D?d.M.dark.text:d.M.light.text},children:At.Initial_first_call_notes})]})]}),(0,f.jsxs)("div",{style:{backgroundColor:D?d.M.dark.background:d.M.light.background,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,borderRadius:8,padding:16,overflow:"auto",maxHeight:"65vh"},children:[(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12,paddingBottom:8,borderBottom:`1px solid ${D?d.M.dark.border:d.M.light.border}`},children:[(0,f.jsx)(h.I,{iconName:"EditCreate",style:{fontSize:14,color:d.M.blue}}),(0,f.jsx)("div",{style:{fontWeight:600,fontSize:14,color:D?d.M.dark.text:d.M.light.text},children:"New Record"}),(0,f.jsx)("div",{style:{fontSize:10,opacity:.8,backgroundColor:d.M.blue,color:"#ffffff",padding:"2px 6px",borderRadius:4,fontWeight:500},children:"EDITABLE"})]}),(0,f.jsxs)("div",{style:{marginBottom:16},children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.blue,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"Contact",style:{fontSize:11}}),"Contact Information",(0,f.jsx)("span",{style:{fontSize:9,color:d.M.red,fontWeight:700},children:"*"})]}),(0,f.jsxs)("div",{style:{display:"grid",gap:8,paddingLeft:4},children:[(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[(0,f.jsx)(Ve.A,{label:"First name",value:Et.first,onChange:(e,t)=>Nt(e=>e?{...e,first:t||""}:e),required:!0,styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Last name",value:Et.last,onChange:(e,t)=>Nt(e=>e?{...e,last:t||""}:e),required:!0,styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}})]}),(0,f.jsx)(Ve.A,{label:"Email",value:Et.email,onChange:(e,t)=>Nt(e=>e?{...e,email:t||""}:e),required:!0,styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[(0,f.jsx)(Ve.A,{label:"Phone",value:Et.phone||"",onChange:(e,t)=>Nt(e=>e?{...e,phone:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Point of contact (poc)",value:Et.poc||"",onChange:(e,t)=>Nt(e=>e?{...e,poc:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}})]})]})]}),(0,f.jsxs)("div",{style:{marginBottom:16},children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.green,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"Work",style:{fontSize:11}}),"Business Details",(0,f.jsx)("span",{style:{fontSize:9,color:d.M.red,fontWeight:700},children:"*"})]}),(0,f.jsxs)("div",{style:{display:"grid",gap:8,paddingLeft:4},children:[(0,f.jsx)(Ve.A,{label:"Area of work (aow)",value:Et.aow,onChange:(e,t)=>Nt(e=>e?{...e,aow:t||""}:e),required:!0,styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Type of work (tow)",value:Et.tow||"",onChange:(e,t)=>Nt(e=>e?{...e,tow:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Method of contact (moc)",value:Et.moc,onChange:(e,t)=>Nt(e=>e?{...e,moc:t||""}:e),required:!0,styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[(0,f.jsx)(Ve.A,{label:"Value",value:Et.value||"",onChange:(e,t)=>Nt(e=>e?{...e,value:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Rating",value:Et.rating||"",onChange:(e,t)=>Nt(e=>e?{...e,rating:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}})]})]})]}),(0,f.jsxs)("div",{style:{marginBottom:16},children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.yellow,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"Ringer",style:{fontSize:11}}),"Attribution & Source"]}),(0,f.jsxs)("div",{style:{display:"grid",gap:8,paddingLeft:4},children:[(0,f.jsx)(Ve.A,{label:"Source",value:Et.source||"",onChange:(e,t)=>Nt(e=>e?{...e,source:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Contact referrer",value:Et.contact_referrer||"",onChange:(e,t)=>Nt(e=>e?{...e,contact_referrer:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Company referrer",value:Et.company_referrer||"",onChange:(e,t)=>Nt(e=>e?{...e,company_referrer:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[(0,f.jsx)(Ve.A,{label:"URL",value:Et.url||"",onChange:(e,t)=>Nt(e=>e?{...e,url:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"GCLID",value:Et.gclid||"",onChange:(e,t)=>Nt(e=>e?{...e,gclid:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px",fontFamily:"monospace"},fieldGroup:{height:28}}})]})]})]}),(0,f.jsxs)("div",{style:{marginBottom:16},children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.red,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"People",style:{fontSize:11}}),"Internal Details"]}),(0,f.jsx)("div",{style:{display:"grid",gap:8,paddingLeft:4},children:(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[(0,f.jsx)(Ve.A,{label:"Representative (rep)",value:Et.rep||"",onChange:(e,t)=>Nt(e=>e?{...e,rep:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Rank",value:Et.rank||"",onChange:(e,t)=>Nt(e=>e?{...e,rank:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}})]})})]}),(0,f.jsxs)("div",{style:{marginBottom:16},children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.blue,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"Settings",style:{fontSize:11}}),"Operational Fields"]}),(0,f.jsxs)("div",{style:{display:"grid",gap:8,paddingLeft:4},children:[(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[(0,f.jsx)(Ve.A,{label:"Stage",value:Et.stage||"",onChange:(e,t)=>Nt(e=>e?{...e,stage:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Claim Date",value:Et.claim||"",onChange:(e,t)=>Nt(e=>e?{...e,claim:t||""}:e),placeholder:"YYYY-MM-DD HH:mm:ss",styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}})]}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6},children:[(0,f.jsx)(Ve.A,{label:"Pitch",value:Et.pitch||"",onChange:(e,t)=>Nt(e=>e?{...e,pitch:t||""}:e),placeholder:"0",styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"ACID",value:Et.acid||"",onChange:(e,t)=>Nt(e=>e?{...e,acid:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}}),(0,f.jsx)(Ve.A,{label:"Card ID",value:Et.card_id||"",onChange:(e,t)=>Nt(e=>e?{...e,card_id:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:12,padding:"6px 8px"},fieldGroup:{height:28}}})]})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:d.M.yellow,marginBottom:8,display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"FileComment",style:{fontSize:11}}),"Notes & Additional Info"]}),(0,f.jsx)("div",{style:{paddingLeft:4},children:(0,f.jsx)(Ve.A,{label:"Notes",multiline:!0,rows:3,value:Et.notes||"",onChange:(e,t)=>Nt(e=>e?{...e,notes:t||""}:e),styles:{field:{backgroundColor:D?d.M.dark.inputBackground:d.M.light.inputBackground,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,fontSize:11,lineHeight:1.4,padding:"8px"}}})})]}),qt&&(0,f.jsx)("div",{style:{marginTop:16},children:(0,f.jsx)(Oe.n,{messageBarType:Ye.H.error,children:qt})})]})]}),(0,f.jsxs)(Ke.E,{styles:{actions:{backgroundColor:D?d.M.dark.sectionBackground:d.M.light.sectionBackground,borderTop:`1px solid ${D?d.M.dark.border:d.M.light.border}`,padding:"12px 16px",display:"flex",gap:8,justifyContent:"flex-end"}},children:[(0,f.jsx)(i.j,{text:Ht?"Migrating...":"Confirm & Create",iconProps:Ht?{iconName:"Sync"}:{iconName:"CloudUpload"},onClick:Jt,disabled:Ht,styles:{root:{backgroundColor:d.M.blue,border:"none",borderRadius:4,padding:"6px 12px",fontWeight:600,fontSize:12,height:28,minWidth:110},rootHovered:{backgroundColor:d.M.blue,opacity:.9},rootPressed:{backgroundColor:d.M.blue,opacity:.8},rootDisabled:{backgroundColor:D?d.M.dark.disabledBackground:d.M.light.disabledBackground,opacity:.6}}}),(0,f.jsx)(r.Y,{text:"Cancel",onClick:Kt,disabled:Ht,styles:{root:{backgroundColor:"transparent",border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,borderRadius:4,padding:"6px 12px",fontWeight:500,fontSize:12,height:28,minWidth:60,color:D?d.M.dark.text:d.M.light.text},rootHovered:{backgroundColor:D?d.M.dark.hoverBackground:d.M.light.hoverBackground}}})]})]}),Q&&(0,f.jsxs)("div",{className:"reassignment-dropdown",style:{position:"fixed",left:Q.x,top:Q.y,zIndex:9999,minWidth:250,background:D?"rgba(15, 23, 42, 0.98)":"rgba(255, 255, 255, 0.98)",border:"1px solid "+(D?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.25)"),borderRadius:8,boxShadow:D?"0 8px 24px rgba(0, 0, 0, 0.4)":"0 6px 20px rgba(15, 23, 42, 0.15)",padding:16},children:[(0,f.jsx)("div",{style:{fontSize:14,fontWeight:600,marginBottom:12,color:D?"#e2e8f0":"#334155"},children:"Reassign to:"}),(0,f.jsxs)("select",{value:"",onChange:e=>aa(e.target.value),disabled:ee,style:{width:"100%",padding:"8px 12px",borderRadius:6,border:"1px solid "+(D?"rgba(148, 163, 184, 0.24)":"rgba(13, 47, 96, 0.16)"),background:D?"rgba(15, 23, 42, 0.9)":"rgba(255, 255, 255, 0.95)",color:D?"#e2e8f0":"#334155",fontSize:14,fontFamily:"Raleway, sans-serif",cursor:ee?"default":"pointer",outline:"none"},children:[(0,f.jsx)("option",{value:"",disabled:!0,children:"Select team member..."}),ea.map(e=>(0,f.jsx)("option",{value:e.value,children:e.text},e.value))]}),ee&&(0,f.jsxs)("div",{style:{marginTop:8,fontSize:12,color:D?"#94a3b8":"#64748b",display:"flex",alignItems:"center",gap:6},children:[(0,f.jsx)(h.I,{iconName:"Loading",style:{animation:"spin 1s linear infinite"}}),"Reassigning..."]}),(0,f.jsx)("div",{style:{marginTop:12,fontSize:11,color:D?"#64748b":"#94a3b8",fontStyle:"italic"},children:"Click outside to cancel"})]}),V.isOpen&&(0,f.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:X,children:(0,f.jsxs)("div",{style:{backgroundColor:D?d.M.dark.sectionBackground:d.M.light.sectionBackground,borderRadius:"12px",padding:"24px",maxWidth:"80vw",maxHeight:"80vh",overflow:"hidden",boxShadow:D?"0 20px 60px rgba(0,0,0,0.4)":"0 20px 60px rgba(0,0,0,0.15)",border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,display:"flex",flexDirection:"column",minWidth:"600px"},onClick:e=>e.stopPropagation(),children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",paddingBottom:"16px",borderBottom:`1px solid ${D?d.M.dark.border:d.M.light.border}`},children:[(0,f.jsx)("h3",{style:{margin:0,color:D?d.M.dark.text:d.M.light.text,fontSize:"18px",fontWeight:600},children:V.title}),(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,f.jsxs)("span",{style:{fontSize:"14px",color:D?d.M.dark.subText:d.M.light.subText,fontWeight:500},children:[V.items.length," enquir",1===V.items.length?"y":"ies"]}),(0,f.jsx)("button",{onClick:X,style:{background:"none",border:"none",fontSize:"20px",cursor:"pointer",color:D?d.M.dark.subText:d.M.light.subText,padding:"4px",borderRadius:"4px"},title:"Close",children:"\xd7"})]})]}),(0,f.jsx)("div",{style:{flex:1,overflow:"auto",paddingRight:"8px",marginRight:"-8px"},children:0===V.items.length?(0,f.jsx)("div",{style:{textAlign:"center",padding:"40px",color:D?d.M.dark.subText:d.M.light.subText},children:"No enquiries found"}):(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:V.items.map((e,t)=>{let{enquiry:a,member:n}=e;const r=ut(a.Touchpoint_Date||a.Date_Created),i=`${yt(a.First_Name||a.first||"")} ${yt(a.Last_Name||a.last||"")}`.trim()||"Unknown",s=yt(a.Email||a.email||""),o=yt(a.Phone_Number||a.phone||""),l=yt(a.Area_of_Work||a.aow||""),c=yt(a.Initial_first_call_notes||a.notes||"").substring(0,80);return(0,f.jsxs)("div",{style:{padding:"8px 12px",backgroundColor:t%2===0?D?"rgba(255,255,255,0.02)":"rgba(0,0,0,0.02)":"transparent",borderRadius:"4px",fontSize:"13px",lineHeight:"1.4"},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[(0,f.jsx)("div",{style:{fontWeight:600,color:D?d.M.dark.text:d.M.light.text},children:i}),(0,f.jsx)("div",{style:{fontSize:"11px",color:D?d.M.dark.subText:d.M.light.subText},children:r?_t(r):"Unknown date"})]}),(0,f.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 16px",fontSize:"11px",color:D?d.M.dark.subText:d.M.light.subText},children:[s&&(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,f.jsx)("span",{style:{minWidth:"40px",fontWeight:500},children:"Email:"}),(0,f.jsx)("span",{children:s})]}),o&&(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,f.jsx)("span",{style:{minWidth:"40px",fontWeight:500},children:"Phone:"}),(0,f.jsx)("span",{children:o})]}),l&&(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gridColumn:"1 / -1"},children:[(0,f.jsx)("span",{style:{minWidth:"40px",fontWeight:500},children:"Area:"}),(0,f.jsx)("span",{children:l})]}),"source"===V.type&&(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gridColumn:"1 / -1"},children:[(0,f.jsx)("span",{style:{minWidth:"40px",fontWeight:500,color:d.M.blue},children:"Source:"}),(0,f.jsx)("span",{style:{color:d.M.blue},children:ue(a)})]}),"moc"===V.type&&(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gridColumn:"1 / -1"},children:[(0,f.jsx)("span",{style:{minWidth:"40px",fontWeight:500,color:d.M.blue},children:"Contact:"}),(0,f.jsx)("span",{style:{color:d.M.blue},children:pe(a)})]}),"poc"===V.type&&(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gridColumn:"1 / -1"},children:[(0,f.jsx)("span",{style:{minWidth:"40px",fontWeight:500,color:d.M.blue},children:"Handler:"}),(0,f.jsx)("span",{style:{color:d.M.blue},children:yt(a.Point_of_Contact||a.point_of_contact).trim()})]})]}),c&&(0,f.jsxs)("div",{style:{fontSize:"10px",color:D?d.M.dark.subText:d.M.light.subText,fontStyle:"italic",marginTop:"4px",opacity:.8},children:['"',c,'..."']})]},t)})})}),(0,f.jsxs)("div",{style:{marginTop:"20px",paddingTop:"16px",borderTop:`1px solid ${D?d.M.dark.border:d.M.light.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,f.jsxs)("button",{onClick:()=>{"source"===V.type?q(P===V.filterValue?null:V.filterValue):"moc"===V.type?Y(O===V.filterValue?null:V.filterValue):"poc"===V.type&&U(G===V.filterValue?null:V.filterValue),X()},style:{padding:"8px 16px",backgroundColor:d.M.blue,color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:500},children:["Filter by ",V.filterValue]}),(0,f.jsx)("button",{onClick:X,style:{padding:"8px 16px",backgroundColor:"transparent",color:D?d.M.dark.subText:d.M.light.subText,border:`1px solid ${D?d.M.dark.border:d.M.light.border}`,borderRadius:"6px",cursor:"pointer",fontSize:"13px"},children:"Close"})]})]})})]});var ra};function Bt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{datasets:t=["userData","teamData","enquiries","allMatters","wip","recoveredFees","poidData","wipClioCurrentWeek"],entraId:a,bypassCache:r=!1,autoStart:i=!1,maxConcurrent:s=3}=e,[o,l]=(0,n.useState)({}),[d,c]=(0,n.useState)(!1),[g,u]=(0,n.useState)(!1),p=(0,n.useRef)(null),h=(0,n.useRef)(null),x=(0,n.useCallback)(()=>{p.current&&(p.current.close(),p.current=null),h.current&&(clearTimeout(h.current),h.current=null),c(!1),u(!1)},[]),f=(0,n.useCallback)(e=>{var n;p.current&&(p.current.close(),p.current=null),c(!1),u(!1);const i=null!==e&&void 0!==e&&e.datasets&&e.datasets.length>0?e.datasets:t,o=null!==(n=null===e||void 0===e?void 0:e.bypassCache)&&void 0!==n?n:r,d=new URL("/api/reporting-stream/stream-datasets",window.location.origin);d.searchParams.set("datasets",i.join(",")),a&&d.searchParams.set("entraId",a),o&&d.searchParams.set("bypassCache","true"),s&&d.searchParams.set("maxConcurrent",s.toString());const g=new EventSource(d.toString());p.current=g;const f=Date.now(),m={};let y=0,b=0,v=0,j=0;g.onopen=()=>{c(!0),u(!1),h.current=setTimeout(()=>{console.warn("Streaming timeout reached - marking incomplete datasets as error"),l(e=>{const t={...e};return Object.keys(t).forEach(e=>{"loading"===t[e].status&&(t[e]={...t[e],status:"error",error:"Timeout: Dataset took too long to load (>5min)",updatedAt:Date.now(),elapsedMs:m[e]?Date.now()-m[e]:void 0})}),t}),u(!0),x()},3e5)},g.onmessage=e=>{try{const t=JSON.parse(e.data);switch(t.type){case"init":t.datasets&&l(e=>{const a={};return t.datasets.forEach(e=>{let{name:t,status:n}=e;m[t]=Date.now(),a[t]={status:n,data:null,cached:!1,count:0,updatedAt:void 0,elapsedMs:0}}),a});break;case"dataset-complete":if(t.dataset){const e=m[t.dataset];if(e){const a=Date.now()-e;t.cached?(y++,b+=a):(v++,j+=a)}l(a=>({...a,[t.dataset]:{status:"ready",data:t.data,cached:t.cached||!1,count:t.count||0,updatedAt:Date.now(),elapsedMs:e?Date.now()-e:void 0}}))}break;case"dataset-error":if(t.dataset){const e=m[t.dataset];l(a=>({...a,[t.dataset]:{...a[t.dataset],status:"error",error:t.error,updatedAt:Date.now(),elapsedMs:e?Date.now()-e:void 0}}))}break;case"complete":u(!0),h.current&&(clearTimeout(h.current),h.current=null);const e=Date.now()-f,a=v?Math.round(j/v):0,n=y?Math.round(b/y):0,r=v?Math.max(0,a*y-b):0;console.info(`Reporting stream: ${y+v} datasets in ${Math.round(e)}ms | cached: ${y}`+(y?` (avg ${n}ms)`:"")+` | fresh: ${v}`+(v?` (avg ${a}ms)`:"")+(r?` | est. saved ~${Math.round(r)}ms`:"")),x()}}catch(Fa){console.error("Streaming update parse error:",Fa)}},g.onerror=e=>{console.error("Reporting stream connection error:",e,"state:",g.readyState),c(!1),p.current&&(p.current.close(),p.current=null)}},[t,a,r]);(0,n.useEffect)(()=>{if(i)return f(),()=>{p.current&&(p.current.close(),p.current=null),c(!1),u(!1)}},[i]);const m={completed:Object.values(o).filter(e=>"ready"===e.status||"error"===e.status).length,total:Object.keys(o).length,percentage:Object.keys(o).length>0?Object.values(o).filter(e=>"ready"===e.status||"error"===e.status).length/Object.keys(o).length*100:0};return{datasets:o,isConnected:d,isComplete:g,start:f,stop:x,progress:m}}const Et="reporting_stream_snapshot_v1",Nt="reporting_cache_state_v1",Ht=()=>{try{const e=sessionStorage.getItem(Nt);return e?JSON.parse(e):{hasFetchedOnce:!1,lastCacheTime:null}}catch{return{hasFetchedOnce:!1,lastCacheTime:null}}},Pt=(e,t)=>{try{sessionStorage.setItem(Nt,JSON.stringify({hasFetchedOnce:e,lastCacheTime:null!==t&&void 0!==t?t:Vt}))}catch{}},qt=(e,t)=>{t(e),Pt(!0,e)},Ot=[{key:"userData",name:"People"},{key:"teamData",name:"Teams"},{key:"enquiries",name:"Enquiries"},{key:"allMatters",name:"Matters"},{key:"wip",name:"WIP"},{key:"recoveredFees",name:"Collected Fees"},{key:"poidData",name:"ID Submissions"},{key:"annualLeave",name:"Annual Leave"},{key:"metaMetrics",name:"Meta Metrics"}],Yt=[{key:"management",name:"Management dashboard",status:"Live today",action:"dashboard"},{key:"enquiries",name:"Enquiries report",status:"Live today",action:"enquiries"},{key:"annualLeave",name:"Annual leave report",status:"Live today",action:"annualLeave"},{key:"metaMetrics",name:"Meta metrics",status:"Live today",action:"metaMetrics"},{key:"matters",name:"Matters snapshot",status:"Matters tab"}],Gt=Ot.map(e=>e.key);let Ut={userData:null,teamData:null,enquiries:null,allMatters:null,wip:null,recoveredFees:null,poidData:null,annualLeave:null,metaMetrics:null},Vt=null;const Kt=d.M.light.background,Jt=d.M.dark.background,Xt=(d.M.light.sectionBackground,d.M.dark.sectionBackground,{ready:{lightBg:"rgba(34, 197, 94, 0.16)",darkBg:"rgba(34, 197, 94, 0.28)",dot:"#22c55e",label:"Ready",icon:"CheckMark"},loading:{lightBg:"rgba(59, 130, 246, 0.18)",darkBg:"rgba(59, 130, 246, 0.32)",dot:"#60a5fa",label:"Refreshing"},error:{lightBg:"rgba(248, 113, 113, 0.18)",darkBg:"rgba(248, 113, 113, 0.32)",dot:"#f87171",label:"Error",icon:"WarningSolid"},idle:{lightBg:"rgba(148, 163, 184, 0.16)",darkBg:"rgba(148, 163, 184, 0.28)",dot:"rgba(148, 163, 184, 0.7)",label:"Not loaded",icon:"Clock"}}),Qt=e=>e?"0 2px 10px rgba(0, 0, 0, 0.22)":"0 2px 8px rgba(15, 23, 42, 0.06)",Zt=e=>e?"rgba(148, 163, 184, 0.24)":"rgba(15, 23, 42, 0.06)",ea=e=>({minHeight:"100vh",width:"100%",padding:"26px 30px 40px",background:e?d.M.dark.background:d.M.light.background,color:e?d.M.dark.text:d.M.light.text,display:"flex",flexDirection:"column",gap:18,transition:"background 0.3s ease, color 0.3s ease",fontFamily:"Raleway, sans-serif"}),ta=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{background:e?"rgba(15, 23, 42, 0.88)":"#FFFFFF",borderRadius:12,border:`1px solid ${Zt(e)}`,boxShadow:Qt(e),padding:"20px 22px",display:"flex",flexDirection:"column",gap:12,...t}},aa=e=>ta(e,{gap:14,padding:"22px 24px"}),na=e=>({display:"flex",flexDirection:"column",gap:6,padding:"12px 14px",borderRadius:10,border:`1px solid ${Zt(e)}`,background:e?"rgba(17, 24, 39, 0.72)":"rgba(255, 255, 255, 0.95)"}),ra=e=>({display:"flex",alignItems:"baseline",justifyContent:"space-between",gap:12,color:e?d.M.dark.text:d.M.light.text}),ia={fontSize:15,fontWeight:600},sa=e=>({fontSize:12,fontWeight:600,color:e?d.M.dark.subText:d.M.highlight}),oa=e=>({display:"flex",justifyContent:"space-between",alignItems:"center",borderRadius:8,padding:"8px 12px",background:e?d.M.dark.cardBackground:d.M.light.cardBackground,border:`1px solid ${e?d.M.dark.borderColor:d.M.light.borderColor}`,gap:12}),la={display:"flex",flexDirection:"column",gap:2},da={fontSize:13,fontWeight:600},ca={fontSize:12,opacity:.65},ga=(e,t)=>({display:"inline-flex",alignItems:"center",gap:6,padding:"4px 10px",borderRadius:999,fontSize:12,fontWeight:600,background:t?e.darkBg:e.lightBg,color:t?"#E2E8F0":d.M.missedBlue,boxShadow:"none"}),ua=e=>({width:8,height:8,borderRadius:"50%",background:e}),pa=e=>({fontSize:12,color:e?"#E2E8F0":d.M.missedBlue}),ha=e=>({display:"flex",flexDirection:"column",gap:10,padding:"14px 16px",borderRadius:12,background:e?"linear-gradient(135deg, rgba(30, 41, 59, 0.85) 0%, rgba(15, 23, 42, 0.94) 100%)":"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",border:"1px solid "+(e?"rgba(148, 163, 184, 0.28)":"rgba(59, 130, 246, 0.18)"),boxShadow:e?"0 4px 6px rgba(0, 0, 0, 0.3)":"0 4px 6px rgba(0, 0, 0, 0.07)"}),xa=e=>({display:"flex",alignItems:"center",gap:10,fontSize:14,fontWeight:600,color:e?"#E2E8F0":d.M.missedBlue}),fa=e=>({fontSize:12,color:e?"rgba(226, 232, 240, 0.82)":"rgba(15, 23, 42, 0.72)",lineHeight:1.5}),ma=e=>({display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 10px",borderRadius:10,background:e?"rgba(30, 41, 59, 0.65)":"rgba(241, 245, 249, 0.85)",border:"1px solid rgba(148, 163, 184, 0.28)",gap:10}),ya=e=>({display:"flex",alignItems:"center",gap:8,fontSize:12,fontWeight:600,color:e?"#E2E8F0":d.M.missedBlue}),ba=e=>({fontSize:11,fontWeight:600,color:e?"rgba(226, 232, 240, 0.74)":"rgba(15, 23, 42, 0.64)"}),va={margin:0,fontSize:16,fontWeight:600,fontFamily:"Raleway, sans-serif"},ja={display:"flex",flexWrap:"wrap",gap:8,fontSize:12},ka=e=>({minHeight:"100vh",padding:"24px 28px",background:e?Jt:Kt,color:e?d.M.dark.text:d.M.light.text,display:"flex",flexDirection:"column",gap:16,transition:"background 0.3s ease, color 0.3s ease"}),wa=e=>({root:{borderRadius:12,padding:"0 20px",height:38,background:d.M.highlight,color:"#ffffff",fontWeight:600,boxShadow:"none",transition:"background 0.2s ease",fontFamily:"Raleway, sans-serif"},rootHovered:{background:"#2f7cb3"},rootPressed:{background:"#266795"}}),Ma=e=>({root:{borderRadius:12,padding:"0 18px",height:38,background:e?"rgba(148, 163, 184, 0.16)":"transparent",color:e?"#E2E8F0":d.M.missedBlue,border:"1px solid "+(e?"rgba(148, 163, 184, 0.32)":"rgba(13, 47, 96, 0.22)"),fontWeight:600,boxShadow:"none",transition:"background 0.2s ease",fontFamily:"Raleway, sans-serif"},rootHovered:{background:e?"rgba(148, 163, 184, 0.24)":"rgba(54, 144, 206, 0.12)"},rootPressed:{background:e?"rgba(148, 163, 184, 0.32)":"rgba(54, 144, 206, 0.18)"}}),Sa=e=>({display:"flex",alignItems:"center",gap:12,color:e?"#E2E8F0":d.M.missedBlue}),Ca=e=>({fontSize:14,fontWeight:600,fontFamily:"Raleway, sans-serif",color:e?"#E2E8F0":d.M.missedBlue}),Da=e=>({root:{borderRadius:999,height:32,padding:"0 12px",background:e?"rgba(15, 23, 42, 0.7)":"rgba(248, 250, 252, 0.95)",border:"1px solid "+(e?"rgba(148, 163, 184, 0.32)":"rgba(13, 47, 96, 0.18)"),color:e?"#E2E8F0":d.M.missedBlue,fontWeight:600,fontFamily:"Raleway, sans-serif",boxShadow:"none"},rootHovered:{background:e?"rgba(15, 23, 42, 0.78)":"rgba(236, 244, 251, 0.96)"},rootPressed:{background:e?"rgba(15, 23, 42, 0.85)":"rgba(222, 235, 249, 0.96)"},icon:{color:e?"#E2E8F0":d.M.missedBlue},label:{fontSize:12}});const Ta=e=>{if(e<=0)return"0s";const t=Math.floor(e/1e3),a=Math.floor(t/60),n=t%60;return 0===a?`${n}s`:`${a}m ${n.toString().padStart(2,"0")}s`},_a=e=>{if(e<=0)return"";if(e<1e3)return`${Math.round(e)}ms`;if(e<1e4)return`${(e/1e3).toFixed(1)}s`;const t=Math.floor(e/1e3);if(t<60)return`${t}s`;const a=Math.floor(t/60),n=t%60;return a<10&&n>0?`${a}m ${n}s`:`${a}m`},Ra=[{thresholdMs:15e3,label:"Connecting to reporting data sources\u2026"},{thresholdMs:45e3,label:"Pulling the latest matters and enquiries\u2026"},{thresholdMs:9e4,label:"Crunching reporting metrics\u2026"},{thresholdMs:Number.POSITIVE_INFINITY,label:"Finalising dashboard views\u2026"}],Wa=e=>{var t;let{userData:a,teamData:u}=e;const{isDarkMode:p}=(0,c.DP)(),{setContent:h}=(0,g.M9)(),[m,y]=(0,n.useState)(()=>new Date),[b,v]=(0,n.useState)("overview"),j=(0,n.useCallback)(()=>{v("overview")},[v]),[k,w]=(0,n.useState)(()=>({userData:null!==a&&void 0!==a?a:Ut.userData,teamData:null!==u&&void 0!==u?u:Ut.teamData,enquiries:Ut.enquiries,allMatters:Ut.allMatters,wip:Ut.wip,recoveredFees:Ut.recoveredFees,poidData:Ut.poidData,annualLeave:Ut.annualLeave,metaMetrics:Ut.metaMetrics})),[M,S]=(0,n.useState)(()=>{const e={};return Ot.forEach(t=>{const n="userData"===t.key&&void 0!==a?a:"teamData"===t.key&&void 0!==u?u:Ut[t.key],r=Array.isArray(n)?n.length>0:Boolean(n);e[t.key]={status:r?"ready":"idle",updatedAt:Vt}}),e}),[C,D]=(0,n.useState)(Vt),[T,_]=(0,n.useState)(!1),[R,W]=(0,n.useState)(null),[F,z]=(0,n.useState)(()=>{const e=Ht();return Boolean(Vt)&&e.hasFetchedOnce}),[I,$]=(0,n.useState)(null),L=(0,n.useCallback)((e,t)=>{S(a=>{const n={...a};return e.forEach(e=>{var r;const i=a[e];n[e]={status:t,updatedAt:null!==(r=null===i||void 0===i?void 0:i.updatedAt)&&void 0!==r?r:null}}),n})},[]),A=(0,n.useMemo)(()=>[...Gt.filter(e=>"annualLeave"!==e&&"metaMetrics"!==e),"wipClioCurrentWeek","wipDbCurrentWeek"],[]),{datasets:B,isConnected:E,isComplete:N,start:H,stop:P,progress:q}=Bt({datasets:A,entraId:null===a||void 0===a||null===(t=a[0])||void 0===t?void 0:t.EntraID,bypassCache:!1,autoStart:!1});(0,n.useEffect)(()=>{try{const e=sessionStorage.getItem(Et);if(!e)return;const t=JSON.parse(e);t&&t.statuses&&S(e=>({...e,...t.statuses}));const a=Date.now()-3e5,n=Boolean(null===t||void 0===t?void 0:t.hadStream);t&&n&&!1===t.isComplete&&t.ts>a?((0,x.cY)("ReportingHome: Resuming incomplete streaming session from",new Date(t.ts).toLocaleTimeString()),_(!0),$(Date.now()),S(e=>{var t,a,n,r;return{...e,annualLeave:{status:"loading",updatedAt:null!==(t=null===(a=e.annualLeave)||void 0===a?void 0:a.updatedAt)&&void 0!==t?t:null},metaMetrics:{status:"loading",updatedAt:null!==(n=null===(r=e.metaMetrics)||void 0===r?void 0:r.updatedAt)&&void 0!==n?n:null}}}),(async()=>{try{const[e,t]=await Promise.all([fetch("/api/attendance/annual-leave-all",{method:"GET",credentials:"include",headers:{Accept:"application/json"}}),Y()]);let a=[];if(e.ok)try{const t=await e.json();t.success&&t.all_data&&(a=t.all_data.map(e=>({request_id:e.request_id,fe:e.person,start_date:e.start_date,end_date:e.end_date,reason:e.reason,status:e.status,days_taken:e.days_taken,leave_type:e.leave_type,rejection_notes:e.rejection_notes,hearing_confirmation:e.hearing_confirmation,hearing_details:e.hearing_details})))}catch{}const n=Date.now();w(e=>({...e,annualLeave:a,metaMetrics:t})),S(e=>({...e,annualLeave:{status:"ready",updatedAt:n},metaMetrics:{status:"ready",updatedAt:n}})),Ut={...Ut,annualLeave:a,metaMetrics:t},Vt=n,qt(n,D)}catch{}})(),H()):t&&!1===t.isComplete&&((0,x.cY)("ReportingHome: Clearing stale streaming session from",new Date(t.ts).toLocaleTimeString()),sessionStorage.removeItem(Et))}catch{}},[H]),(0,n.useEffect)(()=>{try{const e={};Object.entries(B).forEach(t=>{let[a,n]=t;e[a]={status:n.status,updatedAt:n.updatedAt||null}});if(E||null!==I||Object.values(B).some(e=>"loading"===e.status||"ready"===e.status)){const t={statuses:e,isComplete:N,hadStream:!0,ts:Date.now()};sessionStorage.setItem(Et,JSON.stringify(t))}N&&sessionStorage.removeItem(Et)}catch{}},[B,N,E,I]),(0,n.useEffect)(()=>{const e=setInterval(()=>y(new Date),1e3);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>(h("dashboard"===b?(0,f.jsxs)("div",{style:Sa(p),children:[(0,f.jsx)(r.Y,{text:"Back to overview",iconProps:{iconName:"Back"},onClick:j,styles:Da(p)}),(0,f.jsx)("span",{style:Ca(p),children:"Management dashboard"})]}):"annualLeave"===b?(0,f.jsxs)("div",{style:Sa(p),children:[(0,f.jsx)(r.Y,{text:"Back to overview",iconProps:{iconName:"Back"},onClick:j,styles:Da(p)}),(0,f.jsx)("span",{style:Ca(p),children:"Annual leave report"})]}):"enquiries"===b?(0,f.jsxs)("div",{style:Sa(p),children:[(0,f.jsx)(r.Y,{text:"Back to overview",iconProps:{iconName:"Back"},onClick:j,styles:Da(p)}),(0,f.jsx)("span",{style:Ca(p),children:"Enquiries report"})]}):"seoReport"===b?(0,f.jsxs)("div",{style:Sa(p),children:[(0,f.jsx)(r.Y,{text:"Back to overview",iconProps:{iconName:"Back"},onClick:j,styles:Da(p)}),(0,f.jsx)("span",{style:Ca(p),children:"SEO report"})]}):null),()=>{h(null)}),[b,j,p,h]);const Y=(0,n.useCallback)(async()=>{(0,x.cY)("ReportingHome: fetchMetaMetrics called");try{const e="/api/marketing-metrics?daysBack=30";(0,x.cY)("ReportingHome: Fetching meta metrics from:",e);const t=await fetch(e);if(!t.ok)throw new Error(`Meta metrics fetch failed: ${t.status} ${t.statusText}`);const a=await t.json();if(!a.success)return(0,x.UT)("ReportingHome: Meta metrics API returned error:",a.error),[];const n=a.data;return Array.isArray(n)?((0,x.cY)("ReportingHome: Meta metrics fetched successfully. Days included:",n.length),(0,x.cY)("ReportingHome: Date range:",a.dataSource,a.dateRange),n):((0,x.UT)("ReportingHome: Expected array of daily metrics, got:",typeof n),[])}catch(R){return console.error("ReportingHome: Meta metrics fetch error:",R),(0,x.UT)("ReportingHome: Failed to fetch meta metrics:",R),[]}},[]),G=(0,n.useCallback)(async()=>{(0,x.cY)("ReportingHome: refreshDatasetsWithStreaming called"),z(!0),Pt(!0),_(!0),W(null),$(Date.now()),S(e=>{const t={...e};return Gt.forEach(a=>{var n;const r=e[a];t[a]={status:"loading",updatedAt:null!==(n=null===r||void 0===r?void 0:r.updatedAt)&&void 0!==n?n:null}}),t});try{var e,t,n,r,i;console.log("\ud83c\udf0a Starting streaming with datasets:",A),console.log("\ud83c\udf0a EntraID for streaming:",null===a||void 0===a||null===(e=a[0])||void 0===e?void 0:e.EntraID),H();const s=Date.now(),o=6e5,l=null!==(t=null===(n=M.annualLeave)||void 0===n?void 0:n.updatedAt)&&void 0!==t?t:0,d=null!==(r=null===(i=M.metaMetrics)||void 0===i?void 0:i.updatedAt)&&void 0!==r?r:0,c=!Ut.annualLeave||s-l>o,g=!Ut.metaMetrics||s-d>o;let u=Ut.annualLeave||[],p=Ut.metaMetrics||[];if(c||g){const[e,t]=await Promise.all([c?fetch("/api/attendance/annual-leave-all",{method:"GET",credentials:"include",headers:{Accept:"application/json"}}):Promise.resolve(null),g?Y():Promise.resolve(p)]);if(c&&e&&e.ok)try{const t=await e.json();t.success&&t.all_data&&(u=t.all_data.map(e=>({request_id:e.request_id,fe:e.person,start_date:e.start_date,end_date:e.end_date,reason:e.reason,status:e.status,days_taken:e.days_taken,leave_type:e.leave_type,rejection_notes:e.rejection_notes,hearing_confirmation:e.hearing_confirmation,hearing_details:e.hearing_details})))}catch{}g&&(p=Array.isArray(t)?t:[])}w(e=>({...e,annualLeave:u,metaMetrics:p})),S(e=>{var t,a,n,r;return{...e,annualLeave:{status:"ready",updatedAt:c?s:null!==(t=null===(a=e.annualLeave)||void 0===a?void 0:a.updatedAt)&&void 0!==t?t:s},metaMetrics:{status:"ready",updatedAt:g?s:null!==(n=null===(r=e.metaMetrics)||void 0===r?void 0:r.updatedAt)&&void 0!==n?n:s}}}),Ut={...Ut,annualLeave:u,metaMetrics:p},Vt=s,qt(s,D)}catch(s){(0,x.UT)("Failed to refresh non-streaming datasets:",s),W(s instanceof Error?s.message:"Unknown error")}},[H,Y,A]),U=(0,n.useCallback)(async()=>{_(!0),W(null),$(Date.now()),L(["annualLeave"],"loading");try{const e=await fetch("/api/attendance/annual-leave-all",{method:"GET",credentials:"include",headers:{Accept:"application/json"}});let t=[];if(e.ok){const a=await e.json();a.success&&a.all_data&&(t=a.all_data.map(e=>({request_id:e.request_id,fe:e.person,start_date:e.start_date,end_date:e.end_date,reason:e.reason,status:e.status,days_taken:e.days_taken,leave_type:e.leave_type,rejection_notes:e.rejection_notes,hearing_confirmation:e.hearing_confirmation,hearing_details:e.hearing_details})))}w(e=>({...e,annualLeave:t}));const a=Date.now();S(e=>({...e,annualLeave:{status:"ready",updatedAt:a}})),Ut={...Ut,annualLeave:t},Vt=a,qt(a,D)}catch(e){W(e instanceof Error?e.message:"Failed to refresh annual leave"),L(["annualLeave"],"error")}finally{_(!1),$(null)}},[L]),V=(0,n.useCallback)(async()=>{_(!0),W(null),$(Date.now()),L(["metaMetrics"],"loading");try{const e=await Y();w(t=>({...t,metaMetrics:e}));const t=Date.now();S(e=>({...e,metaMetrics:{status:"ready",updatedAt:t}})),Ut={...Ut,metaMetrics:e},Vt=t,qt(t,D)}catch(e){W(e instanceof Error?e.message:"Failed to refresh Meta metrics"),L(["metaMetrics"],"error")}finally{_(!1),$(null)}},[Y,L]),K=(0,n.useCallback)(async()=>{z(!0),Pt(!0),_(!0),W(null),$(Date.now());const e=["enquiries","teamData"];L(e,"loading");try{H({datasets:e,bypassCache:!0});const[t,a]=await Promise.all([fetch("/api/attendance/annual-leave-all",{method:"GET",credentials:"include",headers:{Accept:"application/json"}}).then(async e=>{if(!e.ok)return[];const t=await e.json();return t.success&&t.all_data?t.all_data.map(e=>({request_id:e.request_id,fe:e.person,start_date:e.start_date,end_date:e.end_date,reason:e.reason,status:e.status,days_taken:e.days_taken,leave_type:e.leave_type,rejection_notes:e.rejection_notes,hearing_confirmation:e.hearing_confirmation,hearing_details:e.hearing_details})):[]}),Y()]);w(e=>({...e,annualLeave:t,metaMetrics:a}));const n=Date.now();S(e=>({...e,annualLeave:{status:"ready",updatedAt:n},metaMetrics:{status:"ready",updatedAt:n}})),Ut={...Ut,annualLeave:t,metaMetrics:a},Vt=n,qt(n,D)}catch(t){W(t instanceof Error?t.message:"Failed to refresh datasets"),L(e,"error")}finally{_(!1),$(null)}},[Y,L,H]);(0,n.useEffect)(()=>{Object.entries(B).forEach(e=>{let[t,a]=e;if("ready"===a.status&&a.data){if("wip"===t){var n,r;const e=Array.isArray(a.data)?a.data:[],t=B.wipClioCurrentWeek,c=B.wipDbCurrentWeek,g=t&&"ready"===t.status?null===(n=t.data)||void 0===n||null===(r=n.current_week)||void 0===r?void 0:r.activities:void 0,u=c&&"ready"===c.status?c.data:void 0,p=g&&g.length>0?g:u&&u.length>0?u:[];if(p.length>0){const t=new Set(e.map(e=>{var t,a,n,r,i;return null!=e.id?`id:${e.id}`:`t:${e.created_at}|d:${e.date}|u:${null!==(t=null!==(a=e.user_id)&&void 0!==a?a:null===(n=e.user)||void 0===n?void 0:n.id)&&void 0!==t?t:""}|h:${null!==(r=e.quantity_in_hours)&&void 0!==r?r:""}|v:${null!==(i=e.total)&&void 0!==i?i:""}`})),a=e.slice();for(const e of p){var i,s,o,l,d;if(!e.date&&e.created_at&&"string"===typeof e.created_at){const t=e.created_at.match(/^(\d{4}-\d{2}-\d{2})/);t&&(e.date=t[1])}const n=null!=e.id?`id:${e.id}`:`t:${e.created_at}|d:${e.date}|u:${null!==(i=null!==(s=e.user_id)&&void 0!==s?s:null===(o=e.user)||void 0===o?void 0:o.id)&&void 0!==i?i:""}|h:${null!==(l=e.quantity_in_hours)&&void 0!==l?l:""}|v:${null!==(d=e.total)&&void 0!==d?d:""}`;t.has(n)||(a.push(e),t.add(n))}w(e=>({...e,wip:a}))}else w(t=>({...t,wip:e}))}else w(e=>({...e,[t]:a.data}));S(e=>({...e,[t]:{status:"ready",updatedAt:a.updatedAt||Date.now()}})),Ut={...Ut,[t]:a.data},a.updatedAt&&(Vt=a.updatedAt,D(a.updatedAt))}else"error"===a.status&&S(e=>({...e,[t]:{status:"error",updatedAt:a.updatedAt||Date.now()}}))})},[B]),(0,n.useEffect)(()=>{var e,t;const a=B.wip,n=B.wipClioCurrentWeek,r=B.wipDbCurrentWeek,i=a&&"ready"===a.status&&Array.isArray(a.data),s=n&&"ready"===n.status?null===(e=n.data)||void 0===e||null===(t=e.current_week)||void 0===t?void 0:t.activities:void 0,o=r&&"ready"===r.status?r.data:void 0,l=s&&s.length>0?s:o&&o.length>0?o:void 0;l&&0!==l.length&&w(e=>{var t;const n=i?a.data:e.wip||[],r=new Set(n.map(e=>{var t,a,n,r,i;return null!=e.id?`id:${e.id}`:`t:${e.created_at}|d:${e.date}|u:${null!==(t=null!==(a=e.user_id)&&void 0!==a?a:null===(n=e.user)||void 0===n?void 0:n.id)&&void 0!==t?t:""}|h:${null!==(r=e.quantity_in_hours)&&void 0!==r?r:""}|v:${null!==(i=e.total)&&void 0!==i?i:""}`})),s=n.slice();for(const a of l){var o,d,c,g,u;if(!a.date&&a.created_at&&"string"===typeof a.created_at){const e=a.created_at.match(/^(\d{4}-\d{2}-\d{2})/);e&&(a.date=e[1])}const e=null!=a.id?`id:${a.id}`:`t:${a.created_at}|d:${a.date}|u:${null!==(o=null!==(d=a.user_id)&&void 0!==d?d:null===(c=a.user)||void 0===c?void 0:c.id)&&void 0!==o?o:""}|h:${null!==(g=a.quantity_in_hours)&&void 0!==g?g:""}|v:${null!==(u=a.total)&&void 0!==u?u:""}`;r.has(e)||(s.push(a),r.add(e))}return((null===(t=e.wip)||void 0===t?void 0:t.length)||0)===s.length?e:(console.log("\ud83d\udd17 Merged current-week activities into WIP (streaming):",{base:n.length,added:s.length-n.length,total:s.length}),{...e,wip:s})})},[B.wip,B.wipClioCurrentWeek,B.wipDbCurrentWeek]),(0,n.useEffect)(()=>{N&&(_(!1),$(null),(0,x.cY)("ReportingHome: Streaming completed, clearing fetch state"),(0,x.cY)("ReportingHome: isStreamingConnected =",E,"isStreamingComplete =",N))},[N,E]);(0,n.useCallback)(async()=>{(0,x.cY)("ReportingHome: refreshDatasets called"),z(!0),Pt(!0),_(!0),W(null),$(Date.now()),S(e=>{const t={...e};return Gt.forEach(a=>{var n;const r=e[a];t[a]={status:"loading",updatedAt:null!==(n=null===r||void 0===r?void 0:r.updatedAt)&&void 0!==n?n:null}}),t});try{var e,t,n,r,i,s,o,l,d,c,g,u,p,h,f,m;(0,x.cY)("ReportingHome: Starting parallel fetch calls...");const[v,j,k]=await Promise.all([(async()=>{const e=new URL("/api/reporting/management-datasets",window.location.origin),t=[...Gt.filter(e=>"annualLeave"!==e&&"userData"!==e),"wipClioCurrentWeek"];return(0,x.cY)("ReportingHome: Requesting datasets:",t),e.searchParams.set("datasets",t.join(",")),e.searchParams.set("bypassCache","true"),fetch(e.toString(),{method:"GET",credentials:"include",headers:{Accept:"application/json"}})})(),fetch("/api/attendance/annual-leave-all",{method:"GET",credentials:"include",headers:{Accept:"application/json"}}),Y()]);if(!v.ok){const e=await v.text().catch(()=>"");throw new Error(`Failed to fetch datasets: ${v.status} ${v.statusText}${e?` \u2013 ${e.slice(0,160)}`:""}`)}const M=v.headers.get("content-type")||"";if(!M.toLowerCase().includes("application/json")){const e=await v.text().catch(()=>"");throw new Error(`Unexpected response (not JSON). Content-Type: ${M||"unknown"} \u2013 ${e.slice(0,160)}`)}const C=await v.json();let T=[];if(j.ok)try{const e=await j.json();e.success&&e.all_data&&(T=e.all_data.map(e=>({request_id:e.request_id,fe:e.person,start_date:e.start_date,end_date:e.end_date,reason:e.reason,status:e.status,days_taken:e.days_taken,leave_type:e.leave_type,rejection_notes:e.rejection_notes,hearing_confirmation:e.hearing_confirmation,hearing_details:e.hearing_details})))}catch(b){(0,x.UT)("Failed to parse annual leave data:",b)}let _=null!==(e=C.wip)&&void 0!==e?e:Ut.wip;const R=C.wipClioCurrentWeek,F=(null===(t=C.wipCurrentAndLastWeek)||void 0===t||null===(n=t.current_week)||void 0===n||null===(r=n.activities)||void 0===r?void 0:r.length)>0;if((0,x.cY)("\ud83d\udd0d Frontend merge debug:",{hasCurrentWeekMerged:F,currentWeekActivitiesCount:(null===(i=C.wipCurrentAndLastWeek)||void 0===i||null===(s=i.current_week)||void 0===s||null===(o=s.activities)||void 0===o?void 0:o.length)||0,clioCurrentWeekActivitiesCount:(null===R||void 0===R||null===(l=R.current_week)||void 0===l||null===(d=l.activities)||void 0===d?void 0:d.length)||0,historicalWipCount:(null===(c=_)||void 0===c?void 0:c.length)||0}),F){var y;const e=C.wipCurrentAndLastWeek.current_week.activities;(0,x.cY)("\ud83d\udcca Using backend-merged current week data:",{currentWeekEntries:e.length,historicalWip:(null===(y=_)||void 0===y?void 0:y.length)||0}),_=_&&Array.isArray(_)?[..._,...e]:e,(0,x.cY)("\ud83d\udcca Final merged WIP count:",_?_.length:0)}else if(null!==R&&void 0!==R&&null!==(g=R.current_week)&&void 0!==g&&g.activities&&Array.isArray(R.current_week.activities)&&_&&Array.isArray(_)){const e=R.current_week.activities;(0,x.cY)("\ud83d\udcca Fallback: Merging Clio current week into WIP:",{clioEntries:e.length,historicalWip:_.length,clioWipSample:e.slice(0,3).map(e=>({date:e.date,user_id:e.user_id,hours:e.quantity_in_hours}))}),_=[..._,...e]}const z={userData:null!==a&&void 0!==a?a:Ut.userData,teamData:null!==(u=C.teamData)&&void 0!==u?u:Ut.teamData,enquiries:null!==(p=C.enquiries)&&void 0!==p?p:Ut.enquiries,allMatters:null!==(h=C.allMatters)&&void 0!==h?h:Ut.allMatters,wip:_,recoveredFees:null!==(f=C.recoveredFees)&&void 0!==f?f:Ut.recoveredFees,poidData:null!==(m=C.poidData)&&void 0!==m?m:Ut.poidData,annualLeave:T,metaMetrics:k},I=Date.now();Ut=z,Vt=I,w(z),S(e=>{const t={...e};return Gt.forEach(e=>{const a=z[e];Array.isArray(a)?a.length:Boolean(a);t[e]={status:"ready",updatedAt:I}}),t}),qt(I,D),C.errors&&Object.keys(C.errors).length>0&&W("Some datasets were unavailable.")}catch(v){(0,x.UT)("Failed to refresh reporting datasets:",v),W(v instanceof Error?v.message:"Unknown error"),S(e=>{const t={...e};return Gt.forEach(a=>{var n;const r=e[a];t[a]={status:"error",updatedAt:null!==(n=null===r||void 0===r?void 0:r.updatedAt)&&void 0!==n?n:null}}),t})}finally{_(!1),$(null)}},[]);const J=(0,n.useCallback)(async()=>{const e=Ht(),t=Date.now()-3e5;if(!F||!e.lastCacheTime||e.lastCacheTime<t){const e=["teamData","userData","enquiries","allMatters"];(0,x.cY)("ReportingHome: Preloading common reporting datasets on tab access:",e);try{var n;await fetch("/api/cache-preheater/preheat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({datasets:e,entraId:null===a||void 0===a||null===(n=a[0])||void 0===n?void 0:n.EntraID})}),(0,x.cY)("ReportingHome: Cache preheating completed successfully")}catch(R){(0,x.UT)("Cache preload failed:",R)}}else(0,x.cY)("ReportingHome: Skipping cache preheat - recent data available")},[F,a]);(0,n.useEffect)(()=>{const e=setTimeout(()=>{J()},100);return()=>clearTimeout(e)},[J]);const X=(0,n.useCallback)(()=>{const e=Ht(),t=Date.now()-6e5;!(!F||!e.lastCacheTime||e.lastCacheTime<t)||T||E?(0,x.cY)("ReportingHome: Opening dashboard with cached data"):((0,x.cY)("ReportingHome: Opening dashboard with fresh data fetch"),G()),v("dashboard")},[F,T,E,G,v]);(0,n.useEffect)(()=>{void 0!==a&&w(e=>{if(e.userData===a)return e;const t={...e,userData:null!==a&&void 0!==a?a:null};return Ut={...Ut,userData:null!==a&&void 0!==a?a:null},t})},[a]),(0,n.useEffect)(()=>{void 0!==u&&w(e=>{if(e.teamData===u)return e;const t={...e,teamData:null!==u&&void 0!==u?u:null};return Ut={...Ut,teamData:null!==u&&void 0!==u?u:null},t})},[u]);const Q=(0,n.useMemo)(()=>Ot.map(e=>{const t=B[e.key],a=t&&(E||"idle"!==t.status),n=a?t.data:k[e.key],r=a?{status:t.status,updatedAt:t.updatedAt}:M[e.key],i=Array.isArray(n)?n.length>0:Boolean(n),s="loading"===r.status?"loading":i?"ready":r.status,o=a?t.count||0:Array.isArray(n)?n.length:i?1:0,l=!!a&&t.cached;return{definition:e,status:s,updatedAt:r.updatedAt,count:o,cached:l}}),[k,M,B,E]),Z=(0,n.useMemo)(()=>I?m.getTime()-I:0,[m,I]),ee=(0,n.useMemo)(()=>{var e;if(!T||!I)return null;const t=Ra.find(e=>Z<e.thresholdMs);return null!==(e=null===t||void 0===t?void 0:t.label)&&void 0!==e?e:"Finalising reporting data\u2026"},[T,Z,I]),te=Q.filter(e=>"ready"===e.status).length,ae=m.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),ne=m.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),re=T&&(E||null!==I);re!==(T&&(E||null!==I))&&(0,x.cY)("ReportingHome: Loading state debug:",{isActivelyLoading:re,isFetching:T,isStreamingConnected:E,refreshStartedAt:I,readyCount:te,total:Q.length});const ie=[`${ae} \u2022 ${ne}`,re?null!==ee&&void 0!==ee?ee:"Refreshing":C?`Updated ${(e=>{const t=Date.now()-e;if(t<6e4)return"just now";if(t<36e5){const e=Math.round(t/6e4);return`${e} min${e>1?"s":""} ago`}if(t<864e5){const e=Math.round(t/36e5);return`${e} hour${e>1?"s":""} ago`}return new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})(C)}`:"Not refreshed yet",`${te}/${Q.length} data feeds`];return(0,n.useEffect)(()=>{const e=Q.some(e=>"loading"===e.status);E||e||!T||((0,x.cY)("ReportingHome: Clearing fetching state (no active loads and stream closed)"),_(!1),$(null))},[E,Q,T]),"dashboard"===b?(0,f.jsx)("div",{style:ka(p),children:(0,f.jsx)(O,{enquiries:k.enquiries,allMatters:k.allMatters,wip:k.wip,recoveredFees:k.recoveredFees,teamData:k.teamData,userData:k.userData,poidData:k.poidData,annualLeave:k.annualLeave,triggerRefresh:G,lastRefreshTimestamp:null!==C&&void 0!==C?C:void 0,isFetching:T})}):"annualLeave"===b?(0,f.jsx)("div",{style:ka(p),children:(0,f.jsx)(le,{data:k.annualLeave||[],teamData:k.teamData||[],triggerRefresh:U,lastRefreshTimestamp:null!==C&&void 0!==C?C:void 0,isFetching:T})}):"enquiries"===b?(0,f.jsx)("div",{style:ka(p),children:(0,f.jsx)(At,{enquiries:k.enquiries,teamData:k.teamData,annualLeave:k.annualLeave,metaMetrics:k.metaMetrics,triggerRefresh:K,lastRefreshTimestamp:null!==C&&void 0!==C?C:void 0,isFetching:T})}):"metaMetrics"===b?(0,f.jsx)("div",{style:ka(p),children:(0,f.jsx)(Ce,{metaMetrics:k.metaMetrics,enquiries:k.enquiries,triggerRefresh:V,lastRefreshTimestamp:null!==C&&void 0!==C?C:void 0,isFetching:T})}):"seoReport"===b?(0,f.jsx)("div",{style:ka(p),children:(0,f.jsx)(We,{})}):(0,f.jsxs)("div",{className:"reporting-home-container",style:ea(p),children:[(0,f.jsxs)("section",{style:aa(p),children:[(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,f.jsx)("span",{style:{alignSelf:"flex-start",padding:"4px 10px",borderRadius:999,fontSize:11,letterSpacing:.4,textTransform:"uppercase",background:p?"rgba(148, 163, 184, 0.18)":"rgba(37, 99, 235, 0.12)",color:p?d.M.light.text:d.M.missedBlue,fontWeight:600,fontFamily:"Raleway, sans-serif"},children:"Restricted access"}),(0,f.jsx)("h1",{style:{margin:0,fontSize:24,fontWeight:700,fontFamily:"Raleway, sans-serif"},children:"Reporting workspace"})]}),(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:[(0,f.jsx)(i.j,{text:re?"Preparing\u2026":"Open management dashboard",onClick:X,styles:wa(),disabled:re}),(0,f.jsx)(r.Y,{text:re?"Refreshing\u2026":"Refresh data",onClick:G,styles:Ma(p),disabled:re})]}),(0,f.jsx)("div",{style:ja,children:ie.map(e=>(0,f.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"5px 10px",borderRadius:999,background:p?"rgba(30, 41, 59, 0.6)":"rgba(255, 255, 255, 0.9)",border:`1px solid ${Zt(p)}`,boxShadow:"none",color:p?"#E2E8F0":d.M.missedBlue},children:e},e))}),(re||E)&&(0,f.jsxs)("div",{style:ha(p),children:[(0,f.jsxs)("div",{style:xa(p),children:[(0,f.jsx)(s.y,{size:o.H.small}),(0,f.jsx)("span",{children:E?`Streaming datasets\u2026 (${q.completed}/${q.total})`:"Refreshing reporting datasets\u2026"})]}),(0,f.jsx)("span",{style:fa(p),children:I&&!E?`Elapsed ${Ta(Z)}${ee?` \u2022 ${ee}`:""}`:E?`Progress: ${Math.round(q.percentage)}% \u2022 Redis caching active`:"Preparing data sources\u2026"}),(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Q.map(e=>{let{definition:t,status:a}=e;const n=Xt[a],r=n.icon,i=B[t.key],d=null===i||void 0===i?void 0:i.elapsedMs,c=null===i||void 0===i?void 0:i.cached;return(0,f.jsxs)("div",{style:ma(p),children:[(0,f.jsxs)("span",{style:ya(p),children:["loading"===a?(0,f.jsx)(s.y,{size:o.H.xSmall,style:{width:16,height:16}}):r?(0,f.jsx)(l.l8,{iconName:r,style:pa(p)}):(0,f.jsx)("span",{style:ua(n.dot)}),t.name]}),(0,f.jsxs)("span",{style:ba(p),children:[c&&(0,f.jsx)(l.l8,{iconName:"Database",style:{...pa(p),marginRight:6},title:"Cached"}),n.label,"number"===typeof d&&d>=0&&(0,f.jsx)("span",{style:{marginLeft:8,opacity:.8},children:_a(d)})]})]},t.key)})})]}),R&&(0,f.jsx)("div",{style:{padding:"10px 14px",borderRadius:12,background:p?"rgba(248, 113, 113, 0.22)":"rgba(248, 113, 113, 0.18)",color:p?"#fecaca":"#b91c1c",fontSize:12,boxShadow:Qt(p),border:"1px solid rgba(248, 113, 113, 0.32)"},children:R})]}),(0,f.jsxs)("section",{style:ta(p),children:[(0,f.jsx)("h2",{style:va,children:"Available today"}),(0,f.jsx)("ul",{style:{listStyle:"none",margin:0,padding:0,display:"flex",flexDirection:"column",gap:10},children:Yt.map(e=>(0,f.jsxs)("li",{style:na(p),children:[(0,f.jsxs)("div",{style:ra(p),children:[(0,f.jsx)("span",{style:ia,children:e.name}),(0,f.jsx)("span",{style:sa(p),children:e.status})]}),"dashboard"===e.action&&(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:[(0,f.jsx)(i.j,{text:re?"Preparing\u2026":"Open dashboard",onClick:X,styles:wa(),disabled:re}),(0,f.jsx)(r.Y,{text:"Refresh data",onClick:G,styles:Ma(p),disabled:re,iconProps:{iconName:"Refresh"}})]}),"annualLeave"===e.action&&(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:[(0,f.jsx)(i.j,{text:re?"Preparing\u2026":"Open annual leave report",onClick:()=>v("annualLeave"),styles:wa(),disabled:re}),(0,f.jsx)(r.Y,{text:"Refresh leave data",onClick:U,styles:Ma(p),disabled:re,iconProps:{iconName:"Refresh"}})]}),"enquiries"===e.action&&(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:[(0,f.jsx)(i.j,{text:re?"Preparing\u2026":"Open enquiries report",onClick:()=>v("enquiries"),styles:wa(),disabled:re}),(0,f.jsx)(r.Y,{text:"Refresh enquiries data",onClick:K,styles:Ma(p),disabled:re,iconProps:{iconName:"Refresh"}})]}),"metaMetrics"===e.action&&(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:[(0,f.jsx)(i.j,{text:re?"Preparing\u2026":"Open Meta metrics",onClick:()=>v("metaMetrics"),styles:wa(),disabled:re}),(0,f.jsx)(r.Y,{text:"Refresh Meta data",onClick:V,styles:Ma(p),disabled:re,iconProps:{iconName:"Refresh"}})]}),"seoReport"===e.action&&(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:[(0,f.jsx)(i.j,{text:re?"Preparing\u2026":"Open SEO report",onClick:()=>v("seoReport"),styles:wa(),disabled:re}),(0,f.jsx)(r.Y,{text:"Refresh SEO data",onClick:V,styles:Ma(p),disabled:re,iconProps:{iconName:"Refresh"}})]})]},e.key))})]}),!re&&!E&&(0,f.jsxs)("section",{style:ta(p),children:[(0,f.jsx)("h2",{style:va,children:"Data feeds powering the dashboard"}),(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Q.map(e=>{let{definition:t,status:a,updatedAt:n,count:r,cached:i}=e;const d=Xt[a],c=[r>0?`${r.toLocaleString()} record${1===r?"":"s"}`:"No data"];return i&&c.push("cached"),n&&c.push(new Date(n).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit"})),(0,f.jsxs)("div",{style:oa(p),children:[(0,f.jsxs)("div",{style:la,children:[(0,f.jsx)("span",{style:da,children:t.name}),(0,f.jsx)("span",{style:ca,children:c.join(" \u2022 ")})]}),(0,f.jsxs)("span",{style:ga(d,p),children:["loading"===a?(0,f.jsx)(s.y,{size:o.H.xSmall,style:{width:14,height:14}}):d.icon?(0,f.jsx)(l.l8,{iconName:d.icon,style:pa(p)}):(0,f.jsx)("span",{style:ua(d.dot)}),i&&(0,f.jsx)(l.l8,{iconName:"Database",style:{...pa(p),marginLeft:6},title:"Cached"}),d.label]})]},t.key)})})]}),(0,f.jsxs)("section",{style:ta(p),children:[(0,f.jsx)("h2",{style:va,children:"Quick metrics snapshot"}),(0,f.jsx)(qe,{enquiries:k.enquiries,allMatters:k.allMatters,wip:k.wip,recoveredFees:k.recoveredFees})]})]})}}}]);
//# sourceMappingURL=796.91db2af3.chunk.js.map